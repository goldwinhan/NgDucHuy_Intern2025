//Copyright SequenceDiagram.org

var SEQ;(SEQ=SEQ||{}).menu=function(){const t="USER_SETTINGS",e=450;var i,a,n,r,o,s={presentationMode:!1,participantOverlay:!0,readOnlyPresentationMode:!1,shrinkToFit:!1};function c(t){s.presentationMode=t,t?s.readOnlyPresentationMode&&(SEQ.interactor.setReadOnly(!0),SEQ.main.getInteractionCanvas().style.cursor="grab"):(SEQ.interactor.setReadOnly(!1),SEQ.main.getInteractionCanvas().style.cursor="auto"),f();var e=document.getElementById("actions").style,i=document.getElementById("source").style,c=document.getElementById("diagramCanvas").style,l=document.getElementById("interactionCanvas").style,g=document.getElementById("participantCanvas").style,d=document.getElementById("scrollBox").style,E=document.getElementById("menuView").style,u=document.getElementById("menuButtonView").style;s.presentationMode?(a=c.cssText,n=l.cssText,r=g.cssText,o=d.cssText,d.display="none",e.display="none",i.display="none",E.right=0,u.margin=0,u.padding="6px 13px",u.opacity="0.5",p(!1),c.left="0",g.left="0",l.left="0",c.right="0",g.right="0",l.right="0",c.margin="0 auto",g.margin="0 auto",l.margin="0 auto"):(e.display="block",i.removeProperty("display"),E.removeProperty("right"),u.removeProperty("margin"),u.removeProperty("padding"),u.removeProperty("opacity"),p(!0),c.cssText=a,l.cssText=n,g.cssText=r,d.cssText=o),s.shrinkToFit&&m()}function l(t){s.readOnlyPresentationMode=t,s.presentationMode&&(SEQ.interactor.setReadOnly(t),s.readOnlyPresentationMode?SEQ.main.getInteractionCanvas().style.cursor="grab":SEQ.main.getInteractionCanvas().style.cursor="auto"),f()}function p(t){var e=document.getElementById("top"),i=document.getElementById("topRight"),a=document.getElementById("actions"),n=document.getElementById("source"),r=document.getElementById("diagramCanvas"),o=document.getElementById("interactionCanvas"),s=document.getElementById("participantCanvas"),c=document.getElementsByClassName("nonPresentation"),l=document.getElementById("scrollBox");if(t){e&&e.style.removeProperty("display"),i.style.removeProperty("top"),a.style.removeProperty("top"),n.style.removeProperty("top"),r.style.removeProperty("top"),o.style.removeProperty("top"),s.style.removeProperty("top"),l.style.removeProperty("top");for(var p=0;p<c.length;p++)c[p].style.removeProperty("display")}else{e&&(e.style.display="none"),a.style.top="10px",n.style.top="10px",r.style.top="0",o.style.top="0",s.style.top="0",l.style.top="0";for(var g=0;g<c.length;g++)c[g].style.display="none"}SEQ.interactor.onWindowScroll()}function g(t){var e=SEQ.main.getParticipantCanvas();e.style.display=t?"block":"none",SEQ.interactor.onWindowScroll()}function d(t){var e=SEQ.main.getDiagramCanvas().style,i=SEQ.main.getInteractionCanvas().style,a=SEQ.main.getParticipantCanvas().style,n=document.getElementById("scrollBox").style;t?m():(e.removeProperty("max-width"),i.removeProperty("max-width"),a.removeProperty("max-width"),n.removeProperty("max-width"))}function m(){var t=SEQ.main.getDiagramCanvas().style,e=SEQ.main.getInteractionCanvas().style,i=SEQ.main.getParticipantCanvas().style,a=document.getElementById("scrollBox").style;if(s.presentationMode)t.maxWidth="100%",i.maxWidth="100%",e.maxWidth="100%",a.maxWidth="100%";else{var n=document.getElementsByClassName("CodeMirror")[0],r=20;r+=SEQ.main.getSourceLeft(),r+=parseInt(n.style.width,10),document.getElementById("actions").style.left&&(r+=parseInt(document.getElementById("actions").style.left,10)),t.maxWidth="calc(100% - "+r+"px)",i.maxWidth="calc(100% - "+r+"px)",e.maxWidth="calc(100% - "+r+"px)",a.maxWidth="calc(100% - "+r+"px)"}}function E(){u(0),S(e),SEQ.main.resetWorkAreaLayout(0,e)}function u(t){var e=Q();e.workAreaPosition=t,y(e)}function S(t){var e=Q();e.sourceEditorWidth=t,y(e)}function f(){h(document.getElementById("presentationModeCheckbox"),s.presentationMode),h(document.getElementById("participantOverlayCheckbox"),s.participantOverlay),h(document.getElementById("readOnlyPresentationModeCheckbox"),s.readOnlyPresentationMode),h(document.getElementById("shrinkToFitCheckbox"),s.shrinkToFit);var t=Q();h(document.getElementById("alertForUnsavedChangesCheckbox"),t.alertForUnsavedChanges),h(document.getElementById("autosaveCheckbox"),t.autosave),h(document.getElementById("synchronizeFilenameWithTitleCheckbox"),t.synchronizeFilenameWithTitle),h(document.getElementById("wordWrapSourceTextCheckbox"),t.wordWrapSourceText);var e=t.defaultStorage;h(document.getElementById("defaultStorageRadioFileSystem"),SEQ.saveAndOpen.StorageProvider.FILE_SYSTEM==e),h(document.getElementById("defaultStorageRadioGoogleDrive"),SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE==e),h(document.getElementById("defaultStorageRadioGoogleDriveRootFolder"),SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE_ROOT_FOLDER==e),h(document.getElementById("defaultStorageRadioOneDrive"),SEQ.saveAndOpen.StorageProvider.ONE_DRIVE==e),h(document.getElementById("defaultStorageRadioWebStorage"),SEQ.saveAndOpen.StorageProvider.WEB_STORAGE==e),h(document.getElementById("defaultStorageRadioLocalDisk"),SEQ.saveAndOpen.StorageProvider.LOCAL_DISK==e)}function h(t,e){var i,a;t&&(-1!=t.id.indexOf("Radio")?(i="◉",a="○"):(i="☑",a="☐"),t.textContent=e?i:a)}function y(e){localStorage.setItem(t,JSON.stringify(e))}function Q(){var i={},a=localStorage.getItem(t);return a&&(i=JSON.parse(a)),i.defaultStorage!==SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE&&i.defaultStorage!==SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE_ROOT_FOLDER&&i.defaultStorage!==SEQ.saveAndOpen.StorageProvider.ONE_DRIVE&&i.defaultStorage!==SEQ.saveAndOpen.StorageProvider.FILE_SYSTEM&&i.defaultStorage!==SEQ.saveAndOpen.StorageProvider.LOCAL_DISK&&i.defaultStorage!==SEQ.saveAndOpen.StorageProvider.WEB_STORAGE&&(i.defaultStorage=SEQ.saveAndOpen.StorageProvider.LOCAL_DISK),"boolean"!=typeof i.alertForUnsavedChanges&&(i.alertForUnsavedChanges=!0),"boolean"!=typeof i.autosave&&(i.autosave=!0),"boolean"!=typeof i.synchronizeFilenameWithTitle&&(i.synchronizeFilenameWithTitle=!1),"boolean"!=typeof i.wordWrapSourceText&&(i.wordWrapSourceText=!0),("number"!=typeof i.workAreaPosition||i.workAreaPosition<0)&&(i.workAreaPosition=0),("number"!=typeof i.sourceEditorWidth||i.sourceEditorWidth<0)&&(i.sourceEditorWidth=e),i}function v(){SEQ.main.isIntellijIntegration()||(i&&clearInterval(i),document.getElementById("notification").style.display="none")}function T(){N("notificationCloseButton","mousedown",v)}function A(){N("addParticipant","mousedown",SEQ.interactor.prependParticipant),N("zoomIn","mousedown",function(){C()}),N("zoomOut","mousedown",function(){R()}),N("entryEditorTop","mousedown",function(t){SEQ.interactor.entryEditorMouseDown(t)}),N("entryEditorCloseIcon","click",SEQ.interactor.cancelAllInteraction),N("entryEditorTextArea","keydown",function(t){SEQ.interactor.onEntryEditorTextAreaKeyDown(t)}),N("participantAliasInput","keydown",function(t){SEQ.interactor.onEntryEditorTextAreaKeyDown(t)}),N("entryEditorCancel","click",SEQ.interactor.cancelAllInteraction),N("entryEditorUpdate","click",SEQ.interactor.saveEditEntryResult)}function P(){N("activeFileNameStatus","click",SEQ.saveAndOpen.showActiveFileNameChange),N("menuViewPresentationMode","mousedown",SEQ.menu.togglePresentationMode),N("menuViewParticipantOverlay","mousedown",SEQ.menu.toggleParticipantOverlay),N("menuViewReadOnlyPresentationMode","mousedown",SEQ.menu.toggleReadOnlyPresentationMode),N("menuViewShrinkToFit","mousedown",SEQ.menu.toggleShrinkToFit),N("menuSettingsDefaultStorageFileSystem","mousedown",function(){SEQ.menu.writeDefaultStorageLocation(SEQ.saveAndOpen.StorageProvider.FILE_SYSTEM)}),N("menuSettingsDefaultStorageGoogleDrive","mousedown",function(){SEQ.menu.writeDefaultStorageLocation(SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE)}),N("menuSettingsDefaultStorageGoogleDriveRootFolder","mousedown",function(){SEQ.menu.writeDefaultStorageLocation(SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE_ROOT_FOLDER)}),N("menuSettingsDefaultStorageOneDrive","mousedown",function(){SEQ.menu.writeDefaultStorageLocation(SEQ.saveAndOpen.StorageProvider.ONE_DRIVE)}),N("menuSettingsDefaultStorageWebStorage","mousedown",function(){SEQ.menu.writeDefaultStorageLocation(SEQ.saveAndOpen.StorageProvider.WEB_STORAGE)}),N("menuSettingsDefaultStorageLocalDisk","mousedown",function(){SEQ.menu.writeDefaultStorageLocation(SEQ.saveAndOpen.StorageProvider.LOCAL_DISK)}),N("menuSettingsAlertForUnsavedChanges","mousedown",SEQ.menu.writeAlertForUnsavedChanges),N("menuSettingsAutosave","mousedown",SEQ.menu.writeAutosave),N("menuSettingsSynchronizeFilenameWithTitle","mousedown",SEQ.menu.writeSynchronizeFilenameWithTitle),N("menuSettingsWordWrapSourceText","mousedown",SEQ.menu.writeWordWrapSourceText),N("menuSettingsResetWorkAreaLayout","mousedown",E),N("menuHelpAbout","mousedown",function(){SEQ.main.showPopup("infoPopup")}),N("menuHelpPlatformsAndApi","mousedown",function(){SEQ.main.showPopup("platformsAndApiPopup")}),N("menuHelpInstructionsModalPopup","mousedown",function(){SEQ.main.showIFramePopup("instructionsIFrame","instructions.html","instructionsPopup")}),N("menuHelpPrivacyPolicy","mousedown",function(){SEQ.main.showIFramePopup("privacyPolicyIFrame","privacypolicy.html","privacyPolicyPopup")}),N("menuHelpTermsOfService","mousedown",function(){SEQ.main.showIFramePopup("termsOfServiceIFrame","termsofservice.html","termsOfServicePopup")}),N("menuHelpInstructionsNewWindow","mousedown",function(){window.open("instructions.html")}),N("menuHelpReleaseNotesNewWindow","mousedown",function(){window.open("releasenotes.txt")}),N("menuHelpLicenseNewWindow","mousedown",function(){window.open("LICENSE.txt")}),N("newDiagram","mousedown",SEQ.saveAndOpen.newDiagram),N("openButton","mousedown",function(){SEQ.saveAndOpen.showOpenMenu(this)}),N("saveButton","mousedown",function(){SEQ.saveAndOpen.showSaveMenu(this)}),N("exportButton","mousedown",function(){SEQ.saveAndOpen.showExportMenu(this)}),N("exportButtonCopyPaste","click",SEQ.main.createCopyPasteDiagram),N("exportButtonUrl","click",SEQ.main.createShareUrl),N("downloadButtonSvg","click",SEQ.saveAndOpen.saveSvg),N("downloadButtonPng","click",SEQ.saveAndOpen.savePngHq),N("exportButtonSvg","click",SEQ.saveAndOpen.exportSvg),N("exportButtonPng","click",SEQ.saveAndOpen.exportPngHq),N("cover","mousedown",SEQ.main.closePopups),N("openButtonGoogleDrive","click",SEQ.saveAndOpen.openButtonGoogleDrive),N("openButtonOneDrive","click",SEQ.saveAndOpen.openButtonOneDrive),N("openButtonWebStorage","click",SEQ.saveAndOpen.openButtonWebStorage),N("openButtonFileSystem","click",SEQ.saveAndOpen.openButtonFileSystem),N("openButtonLocalDisk","change",function(){SEQ.saveAndOpen.openButtonLocalDisk(this)}),N("fileName","keyup",function(){var t=SEQ.main.validateName(this.value);SEQ.saveAndOpen.clearDiagramSaveStateAndSetNewName(t)}),N("saveButtonGoogleDrive","click",SEQ.saveAndOpen.saveButtonGoogleDrive),N("saveInRootButtonGoogleDrive","click",SEQ.saveAndOpen.saveInRootButtonGoogleDrive),N("saveButtonOneDrive","click",SEQ.saveAndOpen.saveButtonOneDrive),N("saveButtonWebStorage","click",SEQ.saveAndOpen.saveButtonWebStorage),N("saveButtonFileSystem","click",SEQ.saveAndOpen.saveButtonFileSystem),N("saveAsButtonFileSystem","click",SEQ.saveAndOpen.saveAsButtonFileSystem),N("saveButtonLocalDisk","click",SEQ.saveAndOpen.saveButtonLocalDisk),N("toggleWebStorageSelection","mousedown",function(){SEQ.webStorage.toggleWebStorageSelection(this)}),N("webStoragePopupCancel","click",SEQ.main.closePopups),N("webStorageDelete","click",SEQ.webStorage.deleteSelected),N("webStorageOpen","click",SEQ.webStorage.openSelected),N("menuButtonView","mousedown",function(){O("menuView")}),N("menuButtonSettings","mousedown",function(){O("menuSettings")}),N("menuButtonDonations","mousedown",function(){O("menuDonations")}),N("menuButtonHelp","mousedown",function(){O("menuHelp")}),N("menuView","click",function(){L()}),N("menuSettings","click",function(){L()}),N("menuDonations","click",function(){L()}),N("menuHelp","click",function(){L()}),function(){for(var t=document.getElementsByClassName("popupCloseIcon"),e=0;e<t.length;e++){var i=t[e];i.addEventListener("click",SEQ.main.closePopups)}}()}function x(t){var e=document.getElementById(t);e&&(e.disabled=!0,e.title="supported by chrome, edge, and opera browsers only")}function C(){SEQ.main.changeFontSize(SEQ.main.FontChange.INCREASE)}function R(){SEQ.main.changeFontSize(SEQ.main.FontChange.DECREASE)}function O(t){var e=document.getElementById(t);"block"==e.style.display?e.style.display="none":(L(),e.style.display="block")}function N(t,e,i){var a=document.getElementById(t);a&&a.addEventListener(e,i)}function M(){for(var t=document.getElementsByClassName("actionMenu"),e=0;e<t.length;e++)t[e].style.display="none"}function L(){for(var t=document.getElementsByClassName("menuContent"),e=0;e<t.length;e++)t[e].style.display="none"}return{init:function(){f(),P(),A(),window.showOpenFilePicker||(x("openButtonFileSystem"),x("saveButtonFileSystem"),x("saveAsButtonFileSystem"),x("exportButtonSvg"),x("exportButtonPng")),T()},initEditor:function(){f(),P(),A(),T()},initMaximizedViewer:function(){s.presentationMode=!0,l(!0),P(),A(),T()},initIntellij:function(){s.presentationMode=!0,P(),A(),T()},togglePresentationMode:function(){L(),c(!s.presentationMode)},toggleParticipantOverlay:function(){s.participantOverlay=!s.participantOverlay,f(),g(s.participantOverlay)},toggleReadOnlyPresentationMode:function(){l(!s.readOnlyPresentationMode)},toggleShrinkToFit:function(){s.shrinkToFit=!s.shrinkToFit,f(),d(s.shrinkToFit)},setReadOnlyPresentationMode:l,setPresentationMode:c,writeDefaultStorageLocation:function(t){var e=Q();e.defaultStorage=t,y(e),f()},readDefaultStorageLocation:function(){return Q().defaultStorage},writeAlertForUnsavedChanges:function(){var t=Q();t.alertForUnsavedChanges=!t.alertForUnsavedChanges,y(t),f()},readAlertForUnsavedChanges:function(){return Q().alertForUnsavedChanges},readAutosave:function(){return Q().autosave},writeAutosave:function(){var t=Q();t.autosave=!t.autosave,y(t),f()},writeSynchronizeFilenameWithTitle:function(){var t=Q();t.synchronizeFilenameWithTitle=!t.synchronizeFilenameWithTitle,y(t),f(),SEQ.saveAndOpen.synchronizeFileNameWithTitleIfEnabled()},readSynchronizeFilenameWithTitle:function(){return Q().synchronizeFilenameWithTitle},readWordWrapSourceText:function(){return Q().wordWrapSourceText},writeWordWrapSourceText:function(){var t=Q(),e=!t.wordWrapSourceText;t.wordWrapSourceText=e,y(t),f(),SEQ.main.setSourceTextWordWrapping(e)},displayNotification:function(t,e,a,n){if(SEQ.main.isIntellijIntegration())SEQ.javaBridge.displayNotification(t);else{a||(a="notificationInfo"),n||(n="notificationRight"),i&&clearInterval(i);var r=0,o=!0,s=document.getElementById("notification"),c=document.getElementById("notificationMessage"),l=document.getElementById("notificationSpinner"),p=document.getElementById("notificationCloseButton");s.className=a+" "+n,c.textContent=t,e?(l.style.display="block",p.style.display="none"):(l.style.display="none",p.style.display="block"),s.style.opacity=0,s.style.display="block";var g=t.length/5;i=setInterval(function(){if(o){(r+=.1)>g&&(o=!1,e&&clearInterval(i));var t=r;r>1&&(t=1),s.style.opacity=t}else(r-=.1)>0?s.style.opacity=r:(s.style.display="none",clearInterval(i))},50)}},clearNotification:v,isParticipantOverlay:function(){return s.participantOverlay},isShrinkToFit:function(){return s.shrinkToFit},isPresentationMode:function(){return s.presentationMode},onDocumentMouseDown:function(t){var e=t.target;e.classList.contains("actionButton")||function(t){for(var e=document.getElementsByClassName("actionMenu"),i=0;i<e.length;i++)if(e[i].id==t.id||e[i].contains(t))return!0}(e)||M(),e.classList.contains("menuButton")||function(t){for(var e=document.getElementsByClassName("menuContent"),i=0;i<e.length;i++)if(e[i].id==t.id||e[i].contains(t))return!0}(e)||L()},hideAllActionMenus:M,shrinkToFit:m,setShrinkToFit:function(t){s.shrinkToFit=t,d(s.shrinkToFit)},setShrinkToFitAndSyncMenu:function(t){s.shrinkToFit=t,f(),d(s.shrinkToFit)},setParticipantOverlay:function(t){s.participantOverlay=t,g(s.participantOverlay)},zoomIn:C,zoomOut:R,writeWorkAreaPosition:u,readWorkAreaPosition:function(){return Q().workAreaPosition},writeSourceEditorWidth:S,readSourceEditorWidth:function(){return Q().sourceEditorWidth}}}(),(SEQ=SEQ||{}).main=function(){const t=10,e=50;var i,a,n,r,o,s,c,l,p,g,d=0,m=11,E=m,u=.8,S=1.2,f=1.5,h=4,y={INCREASE:"+",DECREASE:"-"},Q=[],v=[],T=[],A=null,P=null,x=!1,C=!1,R=null,O=null,N=!1,M=!1,L=!1,I=null,D=!1,w=!1,F=null;function _(t,e){return lt()?(t&&e&&(O=C?R(t,e,"svg"):R(t,e)),O):(pt()?(I||(I=document.createElement("canvas")),i=I):i=document.getElementById("diagramCanvas"),t&&e&&(i.width=t,i.height=e),i);var i}function W(){return P||(P=lt()?R():document.createElement("canvas")),P}function B(){return gt()?_():document.getElementById("interactionCanvas")}function b(){return document.getElementById("participantCanvas")}function X(t){var e=s.getScrollInfo();s.setValue(t),s.scrollTo(e.left,e.top),D&&SEQ.javaBridge.updateSource(t)}function Y(t){return t+"pt "+SEQ.parser.diagram.fontFamily}function H(t){return t+"pt monospace"}function G(){var t={};return window.location.href.replace(/[?&#]([^=&#?]{1,100})=([^&?#]{0,512000})/gi,function(e,i,a){t[i]=a}),t}function k(){this.focus(),this.select()}function U(){var t=SEQ.main.getUrlVars();c=t.initialData;var e=G().presentationMode,i=G().shrinkToFit;if(!c&&window.location.hash){var a=window.location.hash.substring(1);a.indexOf("initialData=")>-1&&(c=a.replace("initialData=",""))}var n=t.googleDriveAction,r=t.oauth,o=t.access_token,s=t.id_token;if(r||o||s)SEQ.oneDrive.loadOneDrive();else if(n)SEQ.googleDrive.loadGoogleDrive();else if(c){if(c.indexOf("%")>0){var l=q(decodeURIComponent(c));SEQ.main.updateSource(l)}else{var p=q(LZString.decompressFromEncodedURIComponent(c));SEQ.main.updateSource(p)}"readOnly"===e&&(SEQ.menu.setReadOnlyPresentationMode(!0),SEQ.menu.setPresentationMode(!0)),"true"===i&&SEQ.menu.setShrinkToFitAndSyncMenu(!0)}else SEQ.main.updateSource(V())}function V(){return LZString.decompressFromEncodedURIComponent("C4S2BsFMAIBUAsQGdrOgQ2qCkBQuBBcEAY0gFoA+AIQHsAjALgGFiSBrDAOwBNoeATugDmWWtBIDI6YDExSAjgFdISYNFoCAOl2ABPAA4wwqLlngwktJQLIYpmYOOAXoUAGbBCbSAB5y5HRMgiJi0AC2tABueFy0shoxAtBBADQAItb0UBJsnE7QkDwmsgAewCx50AASkOAGEZBcStDumtAAVB0gXGoCSiSgtL1d3HxdkKXo4QZQSF24QVQAFADMAJSZStkwJFUFRSWTFXFc5D1q6LpXkNYo4apIIpBAA")}function z(){return E*h}function K(t,e){for(var i=[],a=t.split("\n"),n=0;n<a.length;n++){var r,o=a[n];o.indexOf(SEQ.entityParticipant.Type.FONT_AWESOME_5_BRANDS)>-1?r='400 10pt "Font Awesome 5 Brands"':o.indexOf(SEQ.entityParticipant.Type.FONT_AWESOME_5_REGULAR)>-1?r='400 10pt "Font Awesome 5 Free"':o.indexOf(SEQ.entityParticipant.Type.FONT_AWESOME_5_SOLID)>-1?r='900 10pt "Font Awesome 5 Free"':o.indexOf(SEQ.entityParticipant.Type.FONT_AWESOME_6_BRANDS)>-1?r='400 10pt "Font Awesome 6 Brands"':o.indexOf(SEQ.entityParticipant.Type.FONT_AWESOME_6_REGULAR)>-1?r='400 10pt "Font Awesome 6 Free"':o.indexOf(SEQ.entityParticipant.Type.FONT_AWESOME_6_SOLID)>-1?r='900 10pt "Font Awesome 6 Free"':o.indexOf(SEQ.entityParticipant.Type.FONT_AWESOME)>-1?r='10pt "FontAwesome"':o.indexOf(SEQ.entityParticipant.Type.MATERIAL_DESIGN_ICONS)>-1&&(r='10pt "Material Design Icons"'),r&&-1==i.indexOf(r)&&-1==Q.indexOf(r)&&i.push(r)}if(i.length>0){var s=[];i.forEach(function(t){s.push(document.fonts.load(t))}),Promise.all(s).then(function(){i.forEach(function(t){Q.push(t)}),e()})}else e()}function j(t,e){if(SEQ.main.isRunningNode())return SEQ.parser.parse(null,t);SEQ.interactor.editEntryTextAreaActive()||(r&&clearTimeout(r),t||(t=$()),K(t,e?function(){SEQ.parser.parse(null,t)}:function(){r=setTimeout(function(){o&&(o.loadingImage=!1,o=null),SEQ.parser.parse(null,t)},50)}))}function $(){return q(s.getValue())}function q(t){if(/^[\p{L}\p{M}\p{N}\p{P}\p{Z}\p{S}\r\n\s]{0,512000}$/u.test(t))return t;var e="Illegal chars in diagram source (or above 500KB), please use printable unicode chars only.";throw SEQ.menu.displayNotification(e,!1,"notificationError","notificationCenter"),new Error(e)}function J(){var t=document.getElementsByClassName("CodeMirror")[0];return parseInt(t.style.width,10)}function Z(t){document.getElementsByClassName("CodeMirror")[0].style.width=t+"px"}function tt(t){i=t.clientX,a=J(),n=document.getElementById("diagramCanvas").getBoundingClientRect().left,document.addEventListener("mousemove",et),document.addEventListener("mouseup",at),t.preventDefault()}function et(t){var e=t.clientX-i,r=a+e;if(r>=0){var o=document.documentElement;it(n+e+o.scrollLeft),Z(r)}SEQ.menu.isShrinkToFit()&&SEQ.menu.shrinkToFit(),t.preventDefault()}function it(t){document.getElementById("diagramCanvas").style.left=t+"px",document.getElementById("participantCanvas").style.left=t+"px",document.getElementById("interactionCanvas").style.left=t+"px",document.getElementById("scrollBox").style.left=t+"px"}function at(t){document.removeEventListener("mousemove",et),document.removeEventListener("mouseup",at),a=J(),SEQ.menu.writeSourceEditorWidth(a),t.preventDefault()}function nt(t){i=t.clientX,d=document.getElementById("actions").getBoundingClientRect().left,a=J(),document.addEventListener("mousemove",ot),document.addEventListener("mouseup",st),t.preventDefault()}function rt(i,a){var n=i+a+e+t;document.getElementById("actions").style.left=i+"px",document.getElementById("source").style.left=i+e+"px",it(n)}function ot(t){var n=t.clientX-i,r=d+n;r>=0&&r+e<=window.innerWidth&&(!function(t){rt(t,a)}(r),SEQ.menu.isShrinkToFit()&&SEQ.menu.shrinkToFit()),t.preventDefault()}function st(t){document.removeEventListener("mousemove",ot),document.removeEventListener("mouseup",st);var e=t.clientX-i,a=d+e;SEQ.menu.writeWorkAreaPosition(a),t.preventDefault()}function ct(){CodeMirror.commands.autocomplete=function(t){t.showHint({hint:CodeMirror.hint.seqdiahint,completeSingle:!1})},s=CodeMirror(document.getElementById("source"),{value:"# Loading...",styleActiveLine:{nonEmpty:!0},lineNumbers:!0,lineWrapping:SEQ.menu.readWordWrapSourceText(),indentUnit:2,tabSize:2,extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-F":"findPersistent","Cmd-F":"findPersistent",Tab:function(t){t.somethingSelected()?t.execCommand("indentMore"):t.execCommand("insertSoftTab")},"Shift-Tab":function(t){t.execCommand("indentLess")}},gutters:["CodeMirror-linenumbers","errors"],undoDepth:0,maxHighlightLength:52200}),F=s.annotateScrollbar({className:"CodeMirror-error-scrollbar"}),s.on("change",function(t,e){j(q(s.getValue()))}),s.on("inputRead",function(t,e){"cut"!=e.origin&&"paste"!=e.origin&&CodeMirror.commands.autocomplete(t)}),document.getElementById("handleRight").addEventListener("mousedown",tt),document.getElementsByClassName("CodeMirror")[0].style.width=SEQ.menu.readSourceEditorWidth()+"px"}function lt(){return x}function pt(){return N}function gt(){return M}function dt(){return D}function mt(t){var e=m*t;e<2&&(e=2),E=parseInt(e)}function Et(t){document.getElementById("cover").style.display="flex",document.getElementById(t).style.display="block"}function ut(){navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function St(){document.getElementById("dragToMove").addEventListener("mousedown",nt),document.getElementById("actions").style.display="block"}return{initEditor:function(){L=!0,ut(),SEQ.seqDiaHint.init(),SEQ.seqDiaMode.init(),ct(),SEQ.interactor.init(),SEQ.contextMenu.init(),rt(SEQ.menu.readWorkAreaPosition(),SEQ.menu.readSourceEditorWidth()),St(),U()},initRenderPngImage:function(){N=!0},initRenderInteractiveCanvas:function(){M=!0,ut(),ct(),SEQ.interactor.setReadOnly(!0),SEQ.interactor.init()},initIntellij:function(t,e,i,a){D=!0,a&&(E=10,SEQ.interactor.setIntellijGeneratorMode(a)),l=t,p=e,g=i,ct(),SEQ.interactor.init(),SEQ.contextMenu.initIntellij()},initOffice:function(){w=!0,ut(),SEQ.seqDiaHint.init(),SEQ.seqDiaMode.init(),ct(),SEQ.interactor.init(),SEQ.contextMenu.init(),SEQ.menu.init()},initBackend:function(t){x=!0,R=t},exportNodeDiagram:function(t,e,i,a,n){switch(O=R(),e){case"image/png":C=!1,mt(i),j(t),O.toDataURL(e,n);break;case"image/jpeg":C=!1,mt(i),j(t),O.toDataURL(e,a,n);break;case"image/svg+xml":C=!0,mt(i),j(t),n(null,"data:image/svg+xml;base64,"+O.toBuffer().toString("base64"));break;default:n("Unsupported MIME type: "+e)}E=m},init:function(){ut(),SEQ.seqDiaHint.init(),SEQ.seqDiaMode.init(),ct(),SEQ.interactor.init(),SEQ.contextMenu.init(),SEQ.menu.init(),SEQ.webStorage.init(),SEQ.saveAndOpen.init(),rt(SEQ.menu.readWorkAreaPosition(),SEQ.menu.readSourceEditorWidth()),St(),U(),j()},parse:j,getDiagramContext:function(){return A||_().getContext("2d")},getDiagramCanvas:_,getSourceValue:$,selectInSource:function(t,e,i){s.setSelection({line:t,ch:e},{line:t,ch:i})},blurEditor:function(){return s.getInputField().blur()},focusEditor:function(){return s.getInputField().focus()},getInteractionCanvas:B,getInteractionContext:function(){return B().getContext("2d")},getMeasurementCanvas:W,getMeasurementContext:function(){return W().getContext("2d")},getLineWeightParticipantGroup:function(t){return SEQ.metrics.data.participantGroupLineWeight*t},getMetricsCanvas:function(){return lt()?R():document.createElement("canvas")},createRBush:function(){if(!lt()&&!pt())return new RBush},getParticipantCanvas:b,getParticipantContext:function(){var t=b();if(t)return t.getContext("2d")},FontChange:y,changeFontSize:function(t){y.INCREASE===t?E<72&&(E++,SEQ.parser.parse()):y.DECREASE===t&&E>4&&(E--,SEQ.parser.parse())},createCopyPasteDiagram:function(){SEQ.menu.hideAllActionMenus();var t=_(),e=t.toDataURL(),i=document.getElementById("imageDiv"),a=document.getElementById("diagramImage");a&&i.removeChild(a);var n=800/t.width,r=600/t.height,o=n<r?n:r,s=document.createElement("img");s.src=e,s.style.width=o*t.width+"px",s.style.height=o*t.height+"px",s.id="diagramImage",i.appendChild(s),document.getElementById("cover").style.display="flex",document.getElementById("imageSavePopup").style.display="block"},closePopups:function(t){if(!t||t&&"cover"==t.target.id||"popupCloseIcon"==t.target.className){document.getElementById("cover")&&(document.getElementById("cover").style.display="none");for(var e=document.getElementsByClassName("popupDialog"),i=0;i<e.length;i++)e[i].style.display="none"}},getFontSize:function(){return E},getFontSansSerifNormal:function(){return E+"pt sans-serif"},getFontNormal:function(){return Y(E)},getFontSmall:function(){return Y(E*u)},getFontBig:function(){return Y(E*S)},getFontMonoNormal:function(){return H(E)},getFontMonoSmall:function(){return H(E*u)},getFontMonoBig:function(){return H(E*S)},getFontNumeric:function(t){return Y(E*(t/m))},getFontRatio:function(t){return Y(E*t)},getFontMonoNumeric:function(t){return H(E*(t/m))},getLineHeightFontNumeric:function(t){return SEQ.metrics.data.textLineHeight*(t/m)},getLineHeightFontSmall:function(){return SEQ.metrics.data.textLineHeight*u},getLineHeightFontBig:function(){return SEQ.metrics.data.textLineHeight*S},getTitleFontSize:function(){return m*f},getFontFontAwesome:function(){return z()+'pt "FontAwesome"'},getFontMaterialDesignIcons:function(){return z()+'pt "Material Design Icons"'},getFontFontAwesome5Brands:function(){return"400 "+z()+'pt "Font Awesome 5 Brands"'},getFontFontAwesome5Regular:function(){return"400 "+z()+'pt "Font Awesome 5 Free"'},getFontFontAwesome5Solid:function(){return"900 "+z()+'pt "Font Awesome 5 Free"'},getFontFontAwesome6Brands:function(){return"400 "+z()+'pt "Font Awesome 6 Brands"'},getFontFontAwesome6Regular:function(){return"400 "+z()+'pt "Font Awesome 6 Free"'},getFontFontAwesome6Solid:function(){return"900 "+z()+'pt "Font Awesome 6 Free"'},getFontIconSize:z,getTextStrokeWeight:function(t){return SEQ.metrics.data.textStrokeWeight*t},getLineWeightParticipantBoxLineWeight:function(t){return SEQ.metrics.data.participantBoxLineWeight*t},getLineWeightParticipantType:function(t){return SEQ.metrics.data.participantTypeLineWeight*t},createShareUrl:function(){SEQ.menu.hideAllActionMenus();var t,e=$(),i=LZString.compressToEncodedURIComponent(e),a=encodeURIComponent(e);L?t="https://sequencediagram.org/":((t=window.location.href).indexOf("index.html")>-1&&(t=t.substring(0,t.indexOf("index.html"))),t.indexOf("#")>-1&&(t=t.substring(0,t.indexOf("#"))),"/"!==t.substring(t.length-1,t.length)&&(t+="/"));var n=t+"index.html#initialData="+i,r=document.getElementById("rawLinkCompressed");r.value=n,r.addEventListener("click",k);var o=t+"index.html#initialData="+a,s=document.getElementById("rawLinkUriEncoded");s.value=o,s.addEventListener("click",k);var c=t+"index.html?presentationMode=readOnly#initialData="+i,l=document.getElementById("rawLinkPresentationModeReadOnlyCompressed");l.value=c,l.addEventListener("click",k);var p=t+"index.html?presentationMode=readOnly&shrinkToFit=true#initialData="+i,g=document.getElementById("rawLinkPresentationModeReadOnlyShrinkToFitCompressed");g.value=p,g.addEventListener("click",k),document.getElementById("cover").style.display="flex",document.getElementById("shareUrlPopup").style.display="block"},updateSyntaxErrors:function(t){if(dt()){var e=[];t.forEach(function(t){e.push(t.lineNumber)});var i=e.join(",");SEQ.javaBridge.receiveSyntaxErrors(i)}else{s.clearGutter("errors");var a=[];t.forEach(function(t){var e;s.setGutterMarker(t.lineNumber,"errors",((e=document.createElement("div")).style.color="red",e.textContent="⊠",e)),a.push({from:{line:t.lineNumber,ch:0},to:{line:t.lineNumber,ch:0}})}),F.update(a)}},updateSource:X,updateSourceFromUriEncodedAndParse:function(t){var e=q(decodeURIComponent(t));s.setValue(e),j()},pushUndoChange:function(t,e){if(v.length>0)var i=v[v.length-1];t!=i&&(e||(T=[]),v.push(t)),v.length>=200&&v.shift()},undoChange:function(){if(v.length>=2){var t=s.getCursor();!function(t){if(T.length>0)var e=T[T.length-1];t!=e&&T.push(t),T.length>=200&&T.shift()}(v.pop()),X(v.pop()),s.setCursor(t),SEQ.parser.parse(!0)}},redoChange:function(){if(T.length>0){var t=s.getCursor();X(T.pop()),s.setCursor(t),SEQ.parser.parse(!0)}},setCanvasToSvgContext:function(t){A=t},isRunningNode:lt,getDefaultData:V,currentDataIsSameAsInitialDataInUrl:function(){var t=$(),e=LZString.compressToEncodedURIComponent(t),i=encodeURIComponent(t);return t===V()||c===e||c===i},getUrlVars:G,showPopup:Et,showIFramePopup:function(t,e,i){var a=document.getElementById(t);a.src||(a.src=L?"https://sequencediagram.org/"+e:e),Et(i)},clone:function(t){var e=[],i=JSON.stringify(t,function(t,i){if("object"==typeof i&&null!==i){if(e.indexOf(i)>-1)try{return JSON.parse(JSON.stringify(i))}catch(t){return}e.push(i)}return i});return JSON.parse(i)},createPngDataUrl:function(t){return j(t),_().toDataURL()},isRenderPngImageOnly:pt,isRenderInteractiveCanvasOnly:gt,isEditorOnly:function(){return L},isIntellijIntegration:dt,parseAndCreateDataUrl:function(t){return K(t,function(){SEQ.parser.parse(null,t)}),_().toDataURL()},parseAndRenderInteractiveCanvas:function(t){SEQ.main.updateSource(t),j(null,!0)},getSourceLeft:function(){return e},setSourceTextWordWrapping:function(t){s.setOption("lineWrapping",t)},validateSource:q,validateName:function(t){if(/^[\p{L}\p{N} ._\-\(\)\[\]&!,]{1,255}$/u.test(t))return t;var e="Illegal chars or length in diagram name, please use any unicode letters, numbers, and . _ - ( ) [ ] & ! , only. Max length is 255.";throw SEQ.menu.displayNotification(e,!1,"notificationError","notificationCenter"),new Error(e)},validateTimeStamp:function(t){if(/^[\p{L}\p{N} ._\-/:,]{1,255}$/u.test(t))return t;throw SEQ.menu.displayNotification("Illegal chars in diagram time stamp.",!1,"notificationError","notificationCenter"),new Error("Illegal chars in diagram time stamp.")},validateParticipantAlias:function(t){if(/^[\p{L}\p{M}\p{N}\p{P}\p{Z}\p{S}]{1,100}$/u.test(t))return t;var e="Illegal chars in participant alias or length, please use printable unicode chars only.";throw SEQ.menu.displayNotification(e,!1,"notificationError","notificationCenter"),new Error(e)},getForegroundColor:function(){return l||"black"},getBackgroundColor:function(){return p||"white"},getHighlightColor:function(){return g||"red"},setForegroundColor:function(t){l="black"==t?null:t},setBackgroundColor:function(t){p="white"==t?null:t},setHighlightColor:function(t){g="red"==t?null:t},loadCompressedData:function(t){var e=q(LZString.decompressFromEncodedURIComponent(t));SEQ.main.updateSource(e)},isOfficeIntegration:function(){return w},setLoadingImageEntry:function(t){o=t},resetWorkAreaLayout:function(t,e){Z(e),rt(t,e)},require:function(t){return new Promise((e,i)=>{var a=document.getElementsByTagName("head")[0],n=document.createElement("script");n.src=t,n.type="text/javascript",n.onload=(()=>e()),n.onerror=(()=>i(new Error("Failed to load script: "+t))),a.appendChild(n)})}}}(),(SEQ=SEQ||{}).metrics=function(){var t={},e={entrySpacingRatio:1,spacingRation:1.5},i=null;function a(t){return n(t,"Pp",SEQ.main.getFontSize())}function n(t,e,i){var a=SEQ.main.getMetricsCanvas(),n=2*i,r=2*i;a.height=n,a.width=r;var o=a.getContext("2d");o.fillStyle="black",o.fillRect(0,0,r,n),o.textBaseline="top",o.fillStyle="white",o.font=t,o.fillText(e,0,0);var s=o.getImageData(0,0,r,n).data;return function(){for(var t=n-1;t>0;t--)for(var e=0;e<r;e++){var i=4*(t*r+e);if(0!=s[i])return t}return n}()-function(){for(var t=0;t<n;t++)for(var e=0;e<r;e++){var i=4*(t*r+e);if(0!=s[i])return t}return 0}()}return{setupAllMetrics:function(){var i=SEQ.main.getFontNormal(),n=1.2565541*a(i);SEQ.main.isRunningNode()||SEQ.main.isRenderPngImageOnly()||(SEQ.main.getInteractionContext().font=i),SEQ.main.getDiagramContext().font=i,t.textLineHeight=n,t.textStrokeWeight=n/4,t.textBackgroundPadding=.15*n;var r=1.2565541*a(SEQ.main.getFontSansSerifNormal());t.baseSpaceMetric=r,t.textTopBottomPadding=.3*r,t.fragmentTextPosYOffset=.4*r,t.entityMarginTop=r*e.spacingRation*SEQ.parser.diagram.entrySpacingRatio,t.textPadding=r/2,t.boxBleed=.9*r,t.entryMarginSide=r/2,t.diagramMarginTop=r/2,t.diagramMarginBottom=3.5*r,t.diagramLifeLineDashSize=r/1.3,t.diagramLifeLineSpaceSize=r/3,t.diagramLifeLineWeight=r/12,t.diagramLineWeight=r/12,t.participantMarginTop=r/2,t.participantMarginSide=r/2,t.participantMarginBottom=r/2,t.participantPadding=r,t.participantTopBottomPadding=.7*r,t.participantImageHeight=3.88*r,t.participantTypeLineWeight=.17*r,t.participantBoxLineWeight=.16*r,t.participantDestroySize=1.8*r,t.participantDestroyLineWeight=.16*r,t.participantSpecialCollisionSpace=r,t.participantGroupLineWeight=r/12,t.messageSelfRefHeight=1.3*r,t.messageSelfRefWidth=4*r,t.messageSelfRefSideMargin=r/2,t.messageSelfRefMessageCreatorThreshold=r,t.messageArrowWidth=r/1.2,t.messageArrowLineNegativeMargin=.01*r,t.messageLineDashWidth=r/2.5,t.messageInteractionMargin=.2*r,t.messageCollisionBleed=.15*r,t.messageHeadAndEndCollisionSize=.8*r,t.messageCreatorInteractionMargin=.1*r,t.messageCreatorPosDiffThreshold=.2*r,t.messageFailureSize=r,t.messageFailurePadding=r/2,t.dragAndDropInteractionMargin=3*r,t.dividerMinimumLineWidth=r,t.dividerLineSpacing=r/3,t.fragmentLineWeight=r/7,t.fragmentBleed=3.5*r,t.fragmentMarginSide=r,t.fragmentOperandLineDashWidth=r/4,t.fragmentLabelEdgeLength=.6*r,t.fragmentLabelSmallHeight=.6*r,t.fragmentLabelSidePadding=r,t.fragmentHeight=1.2*r,t.fragmentTextSideMargin=r,t.collisionBleed=r/3,t.fragmentCollisionLineCompensation=r/2,t.entryMoverXCollisionWidth=1.18*r,t.entryMoverThreshold=r/3,t.activationSideWidth=r/2,t.activationAfterHeight=.7*r,t.participantGroupPadding=r/2,t.frameMargin=1.6*r,t.frameMarginCanvas=r/2,t.frameHeight=1.4*r,t.frameLabelSidePadding=r,t.frameLabelEdgeLength=.7*r,t.frameLabelSmallHeight=.7*r,t.frameTextPosYOffset=.45*r},calcWidth:function(t,e){var i,a=SEQ.main.getDiagramContext();return e?(a.save(),a.font=e,i=a.measureText(t),a.restore()):i=a.measureText(t),i.width},calcHeight:n,calcCanvasSize:function(){i={width:0,height:0,heightParticipant:0,heightBottomParticipant:0};var t=SEQ.parser.diagram;if(t.participants.length>0){var e=t.entries[t.entries.length-1].position.posY;0===e&&(e=SEQ.parser.diagram.participantMaxHeight+SEQ.metrics.data.participantMarginTop),i.height=e+SEQ.metrics.data.diagramMarginBottom;var a=t.participants[t.participants.length-1],n=Math.max(a.width/2+SEQ.metrics.data.participantMarginSide,a.entityRightWidth+a.timelineRightWidth),r=a.posX+n+a.outerRightWidth;if(t.entries.forEach(function(t){SEQ.entityDivider.isType(t.type)&&t.totalWidth>r&&(r=t.totalWidth)}),i.width=r,i.heightParticipant=SEQ.parser.diagram.participantMaxHeight+SEQ.metrics.data.participantMarginTop+SEQ.metrics.data.participantBoxLineWeight,t.frame&&(i.height+=SEQ.metrics.data.frameMargin,i.width+=SEQ.metrics.data.frameMargin),t.bottomParticipants){var o=SEQ.parser.diagram.participantMaxHeight;SEQ.parser.diagram.participants.forEach(function(t){t.height>o&&(o=t.height)}),i.heightBottomParticipant=i.heightParticipant+o-SEQ.parser.diagram.participantMaxHeight,i.height+=i.heightBottomParticipant}}else t.title&&(i.height=t.title.totalHeight,i.width=t.title.textData.width+2*SEQ.metrics.data.textPadding)},getCanvasSize:function(){return i},data:t,constants:e}}(),(SEQ=SEQ||{}).parser=function(){var t={ongoing:!1},e=new RegExp("^\\s{0,100}$"),i=new RegExp("^\\s{0,100}((:?#|//).{0,20000})$"),a={},n={},r=null;function o(t){t.type&&t.type!=SEQ.entityParticipant.Type.PARTICIPANT&&(SEQ.entityFragment.populateEnclosingCollapsedFragment(t),t.enclosingCollapsedFragment||(t.fromParticipantName&&SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.fromParticipantName),t.toParticipantName&&SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.toParticipantName)),t.snapshot={numberOfOngoingActivationsPerParticipant:function(){var t={};for(var e in a.ongoingActivations)a.ongoingActivations.hasOwnProperty(e)&&(t[e]=a.ongoingActivations[e].length);return t}(),ongoingFragments:a.ongoingFragments.slice()}),a.entries.push(t)}function s(t){var e=a.participants,i=t>0?e[t-1]:null,n=e[t],r=(i?i.width/2+SEQ.metrics.data.participantMarginSide+i.outerRightWidth:0)+n.width/2+SEQ.metrics.data.participantMarginSide+n.outerLeftWidth,o=0;if(i&&(i.outerRightWidth||n.outerLeftWidth)){var s=i.entityRightWidth+n.width/2+n.outerLeftWidth,c=n.entityLeftWidth+i.width/2+i.outerRightWidth;o=s>c?s:c}else o+=i&&i.entityRightWidth>n.entityLeftWidth?i.entityRightWidth:n.entityLeftWidth,i&&(o+=i.timelineRightWidth),o+=n.timelineLeftWidth;return{participantsWidth:r,entitiesWidth:o,largestSideWidth:Math.max(r,o)}}return{parse:function(c,l,p){SEQ.main.isRunningNode()||SEQ.interactor.cancelAllInteraction(),a.entrySpacingRatio=SEQ.metrics.constants.entrySpacingRatio,a.fontFamily="sans-serif",SEQ.metrics.setupAllMetrics(),t.ongoing=!0,a.entries=[],a.errors=[],a.participantsByName={},a.participants=[],a.ongoingFragments=[],a.fragments=[],a.ongoingActivations={},a.title=null,a.frame=null,a.createdParticipantNames={},a.ongoingParticipantGroups=[],a.participantGroups=[],a.entityStyles={},a.participantSpacing=0,a.participantMaxHeight=SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantTypeLineWeight,a.participantActiveColor=null,a.participantLifeLineColor=null,a.participantLifeLineWeight=null,a.maxParticipantGroupHeight=0,a.bottomParticipants=!1,a.collisionTypeAreas=SEQ.main.createRBush();var g=!1,d=1,m=!1,E=!1,u=!1;for(var S in n)n.hasOwnProperty(S)&&(n[S].inUse=!1);SEQ.main.isRunningNode()||SEQ.main.isRenderPngImageOnly()||(l=SEQ.main.getSourceValue()),SEQ.main.pushUndoChange(l,c);var f=l.split("\n");!function(t){t.forEach(function(t){var e=SEQ.entityCreateDestroy.createdParticipant(t);e?a.createdParticipantNames[e]=!0:(e=SEQ.entityMessage.createdParticipant(t))&&(a.createdParticipantNames[e]=!0)})}(f),function c(l){for(var S=l;S<f.length;S++){var h,y=f[S];if(h=SEQ.entityTitle.parse(y))a.title=h,o(h);else if(h=SEQ.entityFontFamily.parse(y))a.fontFamily=h.fontFamily,SEQ.metrics.setupAllMetrics(),o(h);else if(h=SEQ.entityEntrySpacing.parse(y))a.entrySpacingRatio=h.entrySpacing,SEQ.metrics.setupAllMetrics(),o(h);else if(h=SEQ.entityParticipantSpacing.parse(y))a.participantSpacing=h.participantSpacing,o(h);else if(h=SEQ.entityMessage.parse(y,E,g,d,m))o(h),g&&d++,u&&(h.type.indexOf("--")>-1?h.create||SEQ.entityActivation.deactivate(h.fromParticipantName):SEQ.entityActivation.activate(h.toParticipantName));else if(h=SEQ.entityAutoNumber.parse(y))(g=h.enabled)&&(isNaN(h.value)||(d=h.value)),o(h);else if(h=SEQ.entityAutoActivation.parse(y))u=h.enabled,o(h);else if(h=SEQ.entityLinear.parse(y))m=h.enabled,o(h);else if(h=SEQ.entityParallel.parse(y))E=h.enabled,o(h);else if(h=SEQ.entityNoteBoxLeftRight.parse(y,E))o(h);else if(h=SEQ.entityNoteBoxOver.parse(y,E))o(h);else if(h=SEQ.entityParticipant.parse(y,S,c,p)){if(o(h),h.loadingImage)return}else(h=SEQ.entityDivider.parse(y))?o(h):(h=SEQ.entityFragment.parse(y,S))?o(h):(h=SEQ.entityActivation.parse(y))?o(h):(h=SEQ.entitySpace.parse(y))?o(h):(h=SEQ.entityCreateDestroy.parse(y))?o(h):(h=SEQ.entityActiveColor.parse(y))?o(h):(h=SEQ.entityLifeLineStyle.parse(y))?o(h):(h=SEQ.entityBottomParticipants.parse(y))?o(h):(h=SEQ.entityParticipantGroup.parse(y))?o(h):(h=SEQ.entityFrame.parse(y))?(a.frame=h,o(h)):(h=SEQ.entityStyle.parse(y))?(SEQ.parser.diagram.entityStyles[h.entityTypeStyle]=h.style,o(h)):(o({raw:y}),e.exec(y)||i.exec(y)||a.errors.push({lineNumber:S}))}var Q,v,T;for(var A in function(){if(a.participants.length>0){var t=a.participantsByName[SEQ.entityParticipant.specialParticipant.LEFT_PARTICIPANT];if(t){var e=a.participants.indexOf(t);a.participants.splice(e,1),a.participants.unshift(t)}var i=a.participantsByName[SEQ.entityParticipant.specialParticipant.RIGHT_PARTICIPANT];i&&(a.participants.splice(a.participants.indexOf(i),1),a.participants.push(i))}}(),T=[],a.entries.forEach(function(t){t.type&&t.type!=SEQ.entityParticipant.Type.PARTICIPANT&&T.push(t)}),T.forEach(function(t,e){e>0&&!T[e-1].activation&&(Q=T[e-1]),v=e<T.length-1?T[e+1]:null,t.updateParticipantWidths&&!t.enclosingCollapsedFragment&&t.updateParticipantWidths(t),t.updateActivationPosDiff&&t.updateActivationPosDiff(t,null,v),t.updateEnclosingFragments&&t.updateEnclosingFragments(t),t.enclosingCollapsedFragment||Q&&t.type===SEQ.entityActivation.Type.ACTIVATE&&Q.message&&(t.fromParticipantName==Q.fromParticipantName||t.fromParticipantName==Q.toParticipantName)&&(Q.updateActivationPosDiff&&Q.updateActivationPosDiff(Q,t,v),Q.updateEnclosingFragments&&Q.updateEnclosingFragments(Q),Q.updateParticipantWidths&&Q.updateParticipantWidths(Q))}),a.participants.length>0?(SEQ.entityFragment.updateParticipantWidths(),function(){var t=0,e=a.participants;if(a.frame&&(t+=SEQ.metrics.data.frameMargin),a.participantSpacing==SEQ.entityParticipantSpacing.equal){for(var i=0,n=0;n<e.length;n++){var r=s(n);r.largestSideWidth>i&&(i=r.largestSideWidth)}for(var o=0;o<e.length;o++)o>0?(t+=i,e[o].posX=t):(t+=s(o).largestSideWidth,e[o].posX=t)}else for(var c=0;c<e.length;c++){var l=c>0?e[c-1]:null,p=e[c],g=s(c),d=g.largestSideWidth,m=g.participantsWidth-SEQ.metrics.data.participantMarginSide,E=d-m;l&&a.participantSpacing*SEQ.metrics.constants.spacingRation>E/SEQ.metrics.data.baseSpaceMetric&&(d=a.participantSpacing*SEQ.metrics.data.baseSpaceMetric*SEQ.metrics.constants.spacingRation+m),t+=d,p.posX=t}a.participants.forEach(function(t){t.entry&&(t.entry.posX=t.posX)})}()):a.title||(SEQ.main.isIntellijIntegration()?a.title=SEQ.entityTitle.parse("title Empty, click ? for instructions and examples"):SEQ.main.isOfficeIntegration()?a.title=SEQ.entityTitle.parse("title Empty"):a.title=SEQ.entityTitle.parse("title Empty, click Help menu for instructions and examples")),a.entries.forEach(function(t){t.reCalcTotalHeight&&t.reCalcTotalHeight()}),function(){for(var t,e=0,i=[],n=a.entries.length-1;n>=0;n--){var r=a.entries[n];if(r.type)if(r.fromParticipantName===r.toParticipantName?r.totalHeight-SEQ.metrics.data.messageSelfRefHeight>e&&(e=r.totalHeight-SEQ.metrics.data.messageSelfRefHeight):r.totalHeight>e&&(e=r.totalHeight),r.linearWithPrevious)i.push(r);else{t&&t.linearWithPrevious&&i.push(r);var o={maxHeight:e,selfRefHeight:0};i.length>0&&i.forEach(function(t){t.fromParticipantName===t.toParticipantName&&(o.selfRefHeight=SEQ.metrics.data.messageSelfRefHeight),t.linearData=o}),e=0,i=[]}t=r}}(),function(){var t,e=SEQ.metrics.data.diagramMarginTop+a.participantMaxHeight+SEQ.metrics.data.participantMarginTop,i=0;a.participantGroups.forEach(function(t){var e=t.calcHeight();e>i&&(i=e)}),e+=i,a.maxParticipantGroupHeight=i,a.entries.forEach(function(i){!1===i.parallelEnabled&&(t.parallel=!1),i.enclosingCollapsedFragment||function(t,i){t.type&&t.type!=SEQ.entityParticipant.Type.PARTICIPANT?t.parallel&&i&&i.parallel?t.position.posY=e:t.linearData?(t.linearWithPrevious||(e+=t.topMargin+t.linearData.maxHeight+t.linearData.selfRefHeight),t.fromParticipantName===t.toParticipantName?t.position.posY=e:t.position.posY=e-t.linearData.selfRefHeight):(e+=t.topMargin+t.totalHeight,t.position.posY=e,i&&(t.type===SEQ.entityActivation.Type.ACTIVATE&&i.delayHeight&&i.fromParticipantName===t.fromParticipantName&&(t.position.posY-=i.delayHeight),t.type===SEQ.entityActivation.Type.ACTIVATE&&i.participantToCreate&&i.fromParticipantName===t.fromParticipantName&&(t.position.posY-=i.participantToCreate.height/2),t.type!==SEQ.entityActivation.Type.DEACTIVATE&&t.type!==SEQ.entityActivation.Type.DEACTIVATE_AFTER||!i.delayHeight||i.fromParticipantName!==t.fromParticipantName||(t.position.posY-=i.delayHeight),t.type!==SEQ.entityActivation.Type.DEACTIVATE&&t.type!==SEQ.entityActivation.Type.DEACTIVATE_AFTER||!i.participantToCreate||i.fromParticipantName!==t.fromParticipantName||(t.position.posY-=i.participantToCreate.height/2),(t.type===SEQ.entityActivation.Type.DEACTIVATE||t.type===SEQ.entityActivation.Type.DEACTIVATE_AFTER)&&SEQ.entityMessage.isType(i.type)&&i.type.indexOf("--")>-1&&i.fromParticipantName===i.toParticipantName&&(t.position.posY-=SEQ.metrics.data.messageSelfRefHeight))):(t.position||(t.position={}),t.position.posY=e)}(i,t),i.type&&!i.activation&&(t=i)})}(),SEQ.metrics.calcCanvasSize(),SEQ.main.isRunningNode()||SEQ.main.isRenderPngImageOnly()||(a.entries.forEach(function(t){if(t.collisionTypeAreas&&!t.enclosingCollapsedFragment&&(!t.fragment||t.fragment&&t.fragment.endPosition)){var e=t.collisionTypeAreas();if(e)try{a.collisionTypeAreas.load(e)}catch(t){console.log("Failed to load entry collision area",t)}}}),a.participants.forEach(function(t){try{a.collisionTypeAreas.load(t.collisionTypeAreas())}catch(t){console.log("Failed to load participant collision area",t)}}),a.ongoingFragments.forEach(function(t){a.errors.push({lineNumber:t.lineNumber})}),SEQ.main.isRenderInteractiveCanvasOnly()||SEQ.main.updateSyntaxErrors(a.errors)),n)if(n.hasOwnProperty(A)){var P=n[A];P.inUse||delete n[A]}if(SEQ.main.isRunningNode()||SEQ.main.isRenderPngImageOnly()||SEQ.main.isRenderInteractiveCanvasOnly()||SEQ.saveAndOpen.synchronizeFileNameWithTitleIfEnabled(),function(){if(SEQ.main.isIntellijIntegration()){var t=[];a.participants.forEach(function(e){t.push(e.name)}),SEQ.javaBridge.receiveParticipants(t.join(","))}}(),SEQ.painter.paint(),t.ongoing=!1,r){var x=r;r=null,x()}}(0)},diagram:a,participantExists:function(t){return t in SEQ.parser.diagram.participantsByName},storeEntry:o,parsingState:t,imageCache:n,regExpComment:i,registerParseCompletionCallback:function(t){r=t}}}(),(SEQ=SEQ||{}).textUtil=function(){var t=.3,e=.1,i="bold ",a="italic ",n={normal:"normal",small:"small",big:"big",subAndSup:"subOrSup"},r='\\*\\*|\\/\\/|\\+\\+|--|""|~~|<(?:color|link|align|position|size|stroke|background|wordwrap|meta)(?:\\s|:)[^>]{1,20000}>|<difference>|<meta>|<sub>|<sup>',o=new RegExp("(\\\\n|<\\/(?:color|link|align|position|size|stroke|background|difference|wordwrap|meta|sub|sup)>|"+r+")"),s=new RegExp("^<color(?:\\s|:)(.{3,20})>$"),c=new RegExp("^(?:\\s?(#[a-fA-F0-9]{6})|(?:\\s?#)([a-zA-Z]{3,20}))$"),l=new RegExp("^<link(?:\\s|:)(.{1,20000})>$"),p=new RegExp("^<align(?:\\s|:)(left|right|center)>$"),g=new RegExp("^<position(?:\\s|:)(left|right|center)>$"),d=new RegExp("^<size(?:\\s|:)([0-9]{1,2})>$"),m=new RegExp("^<stroke(?:\\s|:)([0-9]{1}(?:\\.[0-9]{1})?)(?:\\s|:)(?:(#[a-fA-F0-9]{6})|#([a-zA-Z]{3,20}))>$"),E=new RegExp("^<background(?:\\s|:)(?:(#[a-fA-F0-9]{6})|#([a-zA-Z]{3,20}))>$"),u=new RegExp("^<wordwrap(?:\\s|:)([0-9]{1,3})>$"),S=new RegExp("^<meta[^>]{0,2000}>$");function f(t){return t.replace(/\x00(n|r|t)\x00/g,"\\\\$1")}function h(t,e,i,a,n,r,o,s,c,l,p){return{text:"",font:t.font,color:e,width:0,height:t.height,link:i,align:a,position:n,strikeThrough:r,stroke:o,background:s,difference:c,sub:l,sup:p,words:0}}function y(t,e,r,o){var s,c,l=null;if(t.length>0&&(l=t[t.length-1]),n.subAndSup===l)if(t.length>=2){var p=t[t.length-2],g=parseFloat(p);s=SEQ.main.getFontNumeric(.7*g),c=SEQ.main.getLineHeightFontNumeric(g)}else s=SEQ.main.getFontRatio(.7),c=SEQ.metrics.data.textLineHeight;else if(n.small==l)s=e?SEQ.main.getFontMonoSmall():SEQ.main.getFontSmall(),c=SEQ.main.getLineHeightFontSmall();else if(n.big==l)s=e?SEQ.main.getFontMonoBig():SEQ.main.getFontBig(),c=SEQ.main.getLineHeightFontBig();else if(l){var d=parseFloat(l);s=e?SEQ.main.getFontMonoNumeric(d):SEQ.main.getFontNumeric(d),c=SEQ.main.getLineHeightFontNumeric(d)}else s=e?SEQ.main.getFontMonoNormal():SEQ.main.getFontNormal(),c=SEQ.metrics.data.textLineHeight;return r&&(s=i+s),o&&(s=a+s),{font:s,height:c}}function Q(t){return t.replace(/\\\\n/g,"\\n").replace(/\\\\r/g,"\\r").replace(/\\\\t/g,"\\t")}function v(t,e,i,a,n,r,o){return"left"===t?"center"===e?i+a/2-n/2:"right"===e?i+a-n:i:"right"===t?"center"===e?r-a/2-n/2:"right"===e?r-n:r-a:"center"===e?o+a/2-n/2:"right"===e?o+a-n:o}function T(t,e,i,a,n,r){t.forEach(function(t){if(e.font=t.font,t.link)if(e.__root)e.__fontHref=t.link,e.__fontUnderline="underline";else{e.beginPath();var o=i+e.lineWidth;e.moveTo(a,o),e.lineTo(a+t.width,o),e.stroke(),SEQ.parser.diagram.collisionTypeAreas&&SEQ.parser.diagram.collisionTypeAreas.insert({minX:a,maxX:a+t.width,minY:i-.7*n.lineMaxHeight,maxY:i,type:"pointer",link:t.link})}if(r||(e.fillStyle=t.color,e.strokeStyle=t.color),t.background){var s=e.fillStyle;e.fillStyle=t.background,e.fillRect(a,i-n.lineMaxHeight+.26*n.lineMaxHeight,t.width,n.lineMaxHeight+.01*n.lineMaxHeight),e.fillStyle=s}var c=Q(t.text);if(t.stroke){var l=e.miterLimit,p=e.strokeStyle,g=e.lineWidth;e.miterLimit=2,e.strokeStyle=t.stroke.color,e.lineWidth=SEQ.main.getTextStrokeWeight(t.stroke.weight),e.strokeText(c,a,i),e.strokeStyle=p,e.lineWidth=g,e.miterLimit=l}if(t.difference){var d=e.globalCompositeOperation;e.globalCompositeOperation="difference"}var m=i;if(t.sub?i+=.15*t.height:t.sup&&(i-=.38*t.height),e.fillText(c,a,i),i=m,t.link&&e.__root&&(e.__fontHref=null,e.__fontUnderline=null),t.strikeThrough){e.beginPath();var E=i-.26*t.height;e.moveTo(a,E),e.lineTo(a+t.width,E),e.stroke()}t.difference&&(e.globalCompositeOperation=d),a+=t.width})}return{parseTextData:function(e,i,a){var r=function(t){return t.replace(/\\\\(n|r|t)/g,"\0$1\0")}(i?i+e:e);r=r.replace(/\\(\+|\-|\/|\*|\")/g,"\0$1\0");for(var v,T=[],A=new Set,P=0,x=0,C=!1,R=!1,O=[],N=SEQ.main.getForegroundColor(),M=!1,L=null,I=null,D=null,w=!1,F=null,_=null,W=!1,B=null,b=!1,X=!1,Y=[],H=0,G=r.split(o),k=0;k<G.length;k++)G[k]=f(G[k]);var U,V,z=[],K=0;return G.forEach(function(t){var e;if(""===t&&G.length>1);else if("**"===t)C=!C;else if("~~"===t)w=!w;else if("//"===t&&function(t){return!(t&&(t.indexOf("http:")>-1||t.indexOf("https:")>-1||t.indexOf("ftp:")>-1||t.indexOf("gopher:")>-1||t.indexOf("file:")>-1))}(U))R=!R;else if("--"===t)O[O.length-1]===n.small?O.pop():O.push(n.small);else if("++"===t)O[O.length-1]===n.big?O.pop():O.push(n.big);else if('""'===t)M=!1===M;else if((e=s.exec(t))&&e.length>0){var i=c.exec(e[1]);i&&(i[1]?N=i[1]:i[2]&&(N=i[2]))}else if("</color>"===t)N=SEQ.main.getForegroundColor();else if((e=l.exec(t))&&e.length>0)L=e[1];else if("</link>"===t)L=null;else if((e=p.exec(t))&&e.length>0)I=e[1];else if("</align>"===t)I=null;else if((e=g.exec(t))&&e.length>0)D=e[1];else if("</position>"===t)D=null;else if((e=d.exec(t))&&e.length>0)O.push(e[1]);else if("</size>"===t)O.pop();else if((e=m.exec(t))&&e.length>0)F={weight:e[1],color:e[2]?e[2]:e[3]};else if("</stroke>"===t)F=null;else if((e=E.exec(t))&&e.length>0)_=e[1]?e[1]:e[2];else if("</background>"===t)_=null;else if("<difference>"===t)W=!0;else if("</difference>"===t)W=!1;else if((e=u.exec(t))&&e.length>0)Y.push(e[1]);else if("</wordwrap>"===t)Y.pop();else if((e=S.exec(t))&&e.length>0)B=e[0];else if("</meta>"===t)v=B+t,B=null;else if("<sub>"===t)O.push(n.subAndSup),b=!0;else if("</sub>"===t)O.pop(),b=!1;else if("<sup>"===t)O.push(n.subAndSup),X=!0;else if("</sup>"===t)O.pop(),X=!1;else if("\\n"===t)0===K&&(K=y(O,M,C,R).height),x+=K,H>P&&(P=H),T.push({textElements:z,lineMaxHeight:K,lineWidth:H}),z=[],K=0,H=0;else if(B);else{t=Q(t=t.replace(/\x00(.)\x00/g,"$1"));var a=y(O,M,C,R);z.push(h(a,N,L,I,D,w,F,_,W,b,X));var r=D;null===r&&(r="center"),A.add(r),t.split(" ").forEach(function(t,e){var i;i=0===e?t:" "+t;var n=z[z.length-1];1==z.length&&0==n.words||function(t,e,i){var a=null;return i.length>0&&(a=i[i.length-1]),!!a&&function(t){var e=0;return t.forEach(function(t){e+=t.text.length}),e}(t)+e.length>a}(z,i,Y)&&(x+=K,H>P&&(P=H),T.push({textElements:z,lineMaxHeight:K,lineWidth:H}),K=0,H=0,(z=[]).push(h(a,N,L,I,D,w,F,_,W,b,X)));var r=z[z.length-1];1==z.length&&0==r.words?(r.text+=t,r.words+=1,H+=SEQ.metrics.calcWidth(t,a.font)):(r.text+=i,r.words+=1,H+=SEQ.metrics.calcWidth(i,a.font)),r.width=SEQ.metrics.calcWidth(r.text,a.font),a.height>K&&(K=a.height)})}U=t}),0===K&&(K=y(O,M,C,R).height),x+=K,H>P&&(P=H),T.push({textElements:z,lineMaxHeight:K,lineWidth:H}),a&&(V=SEQ.metrics.calcWidth(a+" ","bold "+SEQ.main.getFontNormal()),P+=V),{parsedLines:T,lines:function(t){for(var e=t.replace(/\\\\(n|r|t)/g,"\0$1\0").split("\\n"),i=0;i<e.length;i++)e[i]=f(e[i]);return e}(e),width:P,height:x+T[T.length-1].lineMaxHeight*t,autoNumberWidth:V,positionTypes:A,meta:v}},buildInputBoxText:function(t){var e="",i=0;return t.lines.forEach(function(a){e+=a,i<t.lines.length-1&&(e+="\n"),i++}),e},buildSourceText:function(t){var e="",i=0;return t.lines.forEach(function(a){e+=a,i<t.lines.length-1&&(e+="\\n"),i++}),e},fillText:function(t,i,a,n,r,o,s,c,l,p){t.save(),p&&!i&&function(t,i,a,n,r,o,s,c,l){s&&c&&(a+=c,n+=c);var p=o-i[0].lineMaxHeight*e,g=0;i.forEach(function(e){var i=0;e.textElements.forEach(function(e){t.font=e.font,i+=e.width}),i>g&&(g=i)}),i.forEach(function(e){var i=e.textElements,o=null,s=null;i.length>0&&i[0].align===i[i.length-1].align&&(o=i[0].align),i.length>0&&i[0].position===i[i.length-1].position&&(s=i[0].position);var c=0;i.forEach(function(e){t.font=e.font,c+=e.width}),p+=e.lineMaxHeight;var d=v(s,o,n,g,c,r,a);!function(t,e,i,a,n,r){t.forEach(function(t){e.font=t.font;var o=e.fillStyle;e.fillStyle=r,e.fillRect(a-SEQ.metrics.data.textBackgroundPadding,i-n.lineMaxHeight+.1*n.lineMaxHeight,t.width+2*SEQ.metrics.data.textBackgroundPadding,n.lineMaxHeight+.3*n.lineMaxHeight),e.fillStyle=o})}(i,t,p,d,e,l)})}(t,a,n,r,o,s,c,l,p),function(t,i,a,n,r,o,s,c,l){c&&l&&(n+=l,r+=l);var p=s-a[0].lineMaxHeight*e,g=0;a.forEach(function(e){var i=0;e.textElements.forEach(function(e){t.font=e.font,i+=e.width}),i>g&&(g=i)});var d=!0;a.forEach(function(e){var a=e.textElements,s=null,m=null;a.length>0&&a[0].align===a[a.length-1].align&&(s=a[0].align),a.length>0&&a[0].position===a[a.length-1].position&&(m=a[0].position);var E=0;a.forEach(function(e){t.font=e.font,E+=e.width}),p+=e.lineMaxHeight;var u=v(m,s,r,g,E,o,n);if(T(a,t,p,u,e,i),c&&d){t.save(),t.font="bold "+SEQ.main.getFontNormal();var S=c+" ";t.fillText(S,u-l,p),t.restore(),d=!1}})}(t,i,a,n,r,o,s,c,l),t.restore()},fillTextParticipant:function(t,e,i,a,n){var r=n;i.forEach(function(i){var n=i.textElements;r+=i.lineMaxHeight;var o=0;n.forEach(function(e){t.font=e.font,o+=e.width}),T(n,t,r,a-o/2,i,e)})},stripEscaping:Q,textStyleRegExpStr:r}}(),(SEQ=SEQ||{}).entityParticipant=function(){const t="libs/fontawesome/css/fontawesome.min.css",e="libs/fontawesome/css/brands.min.css",i="libs/fontawesome/svgs/brands",a="libs/fontawesome/svgs/regular",n="libs/fontawesome/svgs/solid",r="libs/materialdesign/css/materialdesignicons.min.css",o="libs/materialdesign/svg";var s,c,l,p="((?:[^\\*#<>\\-:\\,\\=\\s]{1,100}?)|(?:[^\\*#<>\\-:\\,\\=\\s]{1}[^#<>\\,:]{0,98}?[^\\*#<>\\-:\\,\\=\\s]{1}))",g="(?:\\s?(#[a-fA-F0-9]{6})|(?:\\s?#)([a-zA-Z]{3,20}))?",d=new RegExp("^\\s{0,100}(?:(participant|rparticipant|actor|boundary|control|entity|database)"+g+'(?:\\s?:([0-9]{1}(?:\\.[0-9]{1})?))?|(fontawesome|materialdesignicons|fontawesome5brands|fontawesome5regular|fontawesome5solid|fontawesome6brands|fontawesome6regular|fontawesome6solid)\\s([a-fA-F0-9]{4,5})|(image)\\s(data:image/png;base64,[A-Za-z0-9\\+/]{1,51200}={0,2}))\\s(?:(")(.{1,500})(")\\s(as)\\s)?'+p+g+"$"),m={LEFT_PARTICIPANT:"[",RIGHT_PARTICIPANT:"]"},E={TYPE:1,LINE_COLOR_HEX:2,LINE_COLOR_NAME:3,LINE_WEIGHT:4,ICON_FONT_TYPE:5,ICON_UNICODE:6,IMAGE_TYPE:7,IMAGE_DATA_URL:8,QUOTE_1:9,LONG_NAME:10,QUOTE_2:11,AS:12,ALIAS:13,FILL_COLOR_HEX:14,FILL_COLOR_NAME:15},u={PARTICIPANT:"participant",RPARTICIPANT:"rparticipant",ACTOR:"actor",BOUNDARY:"boundary",CONTROL:"control",ENTITY:"entity",DATABASE:"database",FONT_AWESOME_6_BRANDS:"fontawesome6brands",FONT_AWESOME_6_REGULAR:"fontawesome6regular",FONT_AWESOME_6_SOLID:"fontawesome6solid",FONT_AWESOME:"fontawesome",MATERIAL_DESIGN_ICONS:"materialdesignicons",FONT_AWESOME_5_BRANDS:"fontawesome5brands",FONT_AWESOME_5_REGULAR:"fontawesome5regular",FONT_AWESOME_5_SOLID:"fontawesome5solid",IMAGE:"image"};function S(t,e,i){var a=new RegExp('(?:\\.fa-|\\.mdi-)([a-z0-9\\-]{1,100}):{1,2}before\\s?{\\s{0,5}content:\\s?"\\\\'+t+'"',"i").exec(e);if(a&&a.length>0)return i+"/"+a[1]+".svg"}function f(t,e,i,a,n,r,o,s,c){var l=new Image;l.onerror=function(){var o=SEQ.textUtil.parseTextData("Error loading image!");h(!0,e,0,0,t,o,i,null,null,null,a),t.loadingImage&&n(r+1)},l.onload=function(){SEQ.parser.imageCache[o]={image:l,inUse:!0},h(!0,e,0,0,t,s,i,l,null,null,a),t.loadingImage&&n(r+1)},l.src=c}function h(t,e,i,a,n,r,o,s,c,l,p){SEQ.parser.participantExists(e)||Q(t,e,n,r,o,s,c,l,p);var g=SEQ.parser.diagram.participantsByName[e];return(i||a)&&P(g,i,a),g}function y(t){return m.LEFT_PARTICIPANT===t||m.RIGHT_PARTICIPANT===t}function Q(t,e,i,a,n,r,o,s,c){var l,p;if(s)var g=String.fromCodePoint(parseInt(s,16));if(r){var d,m=SEQ.metrics.data.participantImageHeight/r.height*r.width,E=SEQ.metrics.data.participantImageHeight;a?(d=a.width,p=E+a.height):(d=SEQ.metrics.calcWidth(e),p=E+SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding),l=m>d?m:d}else o?(l=o.width(g,e,a),p=o.height(g,e,a)):a?(l=a.width+2*SEQ.metrics.data.participantPadding+SEQ.metrics.data.participantTypeLineWeight,p=a.height+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantBoxLineWeight):(l=y(e)?0:T(e),p=A());var u={type:SEQ.entityParticipant.Type.PARTICIPANT,name:e,font:SEQ.main.getFontNormal(),width:l,height:p,entityLeftWidth:0,entityRightWidth:0,timelineLeftWidth:0,timelineRightWidth:0,outerLeftWidth:0,outerRightWidth:0,longNameTextData:a,image:r,participantType:o,iconUnicode:g,iconUnicodeString:s,styling:n||{},entry:i,createPositions:[],destroyPositions:[],collisionTypeAreas:N,originalLongName:c,declared:t,updatePos:v,paint:x,imageWidth:m,imageHeight:E};!SEQ.parser.diagram.createdParticipantNames[e]&&p>SEQ.parser.diagram.participantMaxHeight&&(SEQ.parser.diagram.participantMaxHeight=p),SEQ.parser.diagram.participantsByName[e]=u,SEQ.parser.diagram.participants.push(u),SEQ.parser.diagram.ongoingParticipantGroups.forEach(function(t){t.enclosedParticipants.push(u)})}function v(t,e){t.posX=e}function T(t){return SEQ.metrics.calcWidth(t)+2*SEQ.metrics.data.participantPadding+SEQ.metrics.data.participantTypeLineWeight}function A(){return SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantTypeLineWeight}function P(t,e,i){t.entityLeftWidth<e&&(t.entityLeftWidth=e),t.entityRightWidth<i&&(t.entityRightWidth=i)}function x(t,e){C(t,e,!1,!1)}function C(t,e,i,a,n){if(!t.createPositions.length||n){var r=SEQ.metrics.data.participantMarginTop;i||(SEQ.parser.diagram.title&&(r+=SEQ.parser.diagram.title.totalHeight),SEQ.parser.diagram.frame&&(r+=SEQ.parser.diagram.frame.totalHeight),r+=SEQ.parser.diagram.maxParticipantGroupHeight),R(t,e,r,a,n)}}function R(t,e,i,a,n){if(t.image){var r,o=t.longNameTextData?t.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;r=n?n+o:SEQ.parser.diagram.participantMaxHeight+i-o-t.imageHeight;var s=t.posX-t.imageWidth/2;e.drawImage(t.image,s,r,t.imageWidth,t.imageHeight),n+=t.longNameTextData?t.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,O(t,e,SEQ.parser.diagram.participantMaxHeight,i,a,n)}else t.participantType?(t.participantType.paint(e,t,SEQ.parser.diagram.participantMaxHeight,i,n),t.participantType.rparticipant?(i-=SEQ.metrics.data.participantTopBottomPadding,n+=t.height-SEQ.metrics.data.participantTypeLineWeight-SEQ.metrics.data.participantTopBottomPadding):n+=t.longNameTextData?t.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,O(t,e,SEQ.parser.diagram.participantMaxHeight,i,a,n)):SEQ.entityParticipant.isSpecialParticipantName(t.name)||(!function(t,e,i,a,n){var r;r=n||a+i-t.height+SEQ.metrics.data.participantTypeLineWeight;var o=t.width;e.beginPath(),e.save(),e.rect(t.posX-o/2,r,o,t.height-SEQ.metrics.data.participantTypeLineWeight),t.styling.fillColor?e.fillStyle=t.styling.fillColor:e.fillStyle=SEQ.main.getBackgroundColor();e.fill(),t.styling.lineWeight?e.lineWidth=SEQ.main.getLineWeightParticipantBoxLineWeight(t.styling.lineWeight):e.lineWidth=SEQ.metrics.data.participantBoxLineWeight;t.styling.lineColor&&(e.strokeStyle=t.styling.lineColor);0!=t.styling.lineWeight&&e.stroke();e.restore()}(t,e,SEQ.parser.diagram.participantMaxHeight,i,n),i-=SEQ.metrics.data.participantTopBottomPadding,n+=t.height-SEQ.metrics.data.participantTypeLineWeight-SEQ.metrics.data.participantTopBottomPadding,O(t,e,SEQ.parser.diagram.participantMaxHeight,i,a,n))}function O(t,e,i,a,n,r){var o;if(e.save(),t.longNameTextData)o=r?r-t.longNameTextData.height:a+i-t.longNameTextData.height,SEQ.textUtil.fillTextParticipant(e,n,t.longNameTextData.parsedLines,t.posX,o);else{var s=SEQ.metrics.calcWidth(t.name,t.font);e.font=t.font,o=r?r-SEQ.metrics.data.textTopBottomPadding:a+i-SEQ.metrics.data.textTopBottomPadding,e.fillText(t.name,t.posX-s/2,o)}e.restore()}function N(){var t=(SEQ.parser.diagram.title?SEQ.parser.diagram.title.totalHeight:0)+(SEQ.parser.diagram.frame?SEQ.parser.diagram.frame.totalHeight:0)+SEQ.metrics.data.participantMarginTop+SEQ.parser.diagram.participantMaxHeight+SEQ.parser.diagram.maxParticipantGroupHeight,e=[];return e.push({minX:this.posX-this.width/2,maxX:this.posX+this.width/2,minY:t-this.height,maxY:t,type:"move"}),e}function M(t){return-1==t.indexOf("#")?"#"+t:t}return{parse:function(p,g,m,y){var Q=d.exec(p);if(null!=Q&&Q.length>E.ALIAS){var v=Q[E.TYPE];v||(v=Q[E.ICON_FONT_TYPE]),v||(v=Q[E.IMAGE_TYPE]);var T=Q[E.ALIAS],A=Q[E.LONG_NAME],P=Q[E.LINE_COLOR_NAME],x=Q[E.LINE_COLOR_HEX],C=Q[E.LINE_WEIGHT],R=Q[E.FILL_COLOR_NAME],O=Q[E.FILL_COLOR_HEX],N=Q[E.IMAGE_DATA_URL],M={lineColor:P||x,lineWeight:C,fillColor:R||O};if(A)var L=SEQ.entityStyle.lookUpStyle(u.PARTICIPANT),I=SEQ.textUtil.parseTextData(A,L.text);var D={type:u.PARTICIPANT,participantType:v,fromParticipantName:T,longName:A,textData:I,raw:p};if(v===u.IMAGE){var w=SEQ.saveAndOpen.createHash(N),F=SEQ.parser.imageCache[w];F?(F.inUse=!0,h(!0,T,0,0,D,I,M,F.image,null,null,A)):(D.loadingImage=!0,SEQ.main.setLoadingImageEntry(D),f(D,T,M,A,m,g,w,I,N))}else if(v===u.ACTOR||v===u.BOUNDARY||v===u.CONTROL||v===u.ENTITY||v===u.DATABASE)h(!0,T,0,0,D,I,M,null,SEQ.participantTypes[v],null,A);else if(v!==u.PARTICIPANT){var _=Q[E.ICON_UNICODE];if(v===u.MATERIAL_DESIGN_ICONS&&4===_.length&&(_=_.substr(0,1)+"0"+_.substr(1,_.length-1)),y){D.loadingImage=!0,SEQ.main.setLoadingImageEntry(D);var W=_.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),B=v+"-"+W;(async function(p,g){return u.FONT_AWESOME_6_BRANDS===p?(c||(c=await fetch(e).then(t=>t.text())),S(g,c,i)):u.FONT_AWESOME_6_REGULAR===p?(s||(s=await fetch(t).then(t=>t.text())),S(g,s,a)):u.FONT_AWESOME_6_SOLID===p?(s||(s=await fetch(t).then(t=>t.text())),S(g,s,n)):u.MATERIAL_DESIGN_ICONS===p?(l||(l=await fetch(r).then(t=>t.text())),S(g,l,o)):void 0})(v,W).then(t=>{if(t)!function(t,e,i,a){fetch(t).then(t=>t.text()).then(t=>{const n=DOMPurify.sanitize(t,{USE_PROFILES:{svg:!0}}),r=new DOMParser,o=r.parseFromString(n,"image/svg+xml"),s=o.querySelector("path");e?s.setAttribute("fill",e):i&&s.setAttribute("fill",i);const c=(new XMLSerializer).serializeToString(o);var l="data:image/svg+xml,"+encodeURIComponent(c);a(l)}).catch(t=>{console.error("Error fetching the SVG:",t)})}(t,R,O,function(t){f(D,T,M,A,m,g,B,I,t)});else{var e=SEQ.textUtil.parseTextData("Error finding SVG URL");h(!0,T,0,0,D,e,M,null,null,null,A),D.loadingImage&&m(g+1)}})}else h(!0,T,0,0,D,I,M,null,SEQ.participantTypes[v],_,A)}else h(!0,T,0,0,D,I,M,null,null,null,A);return D}},paint:C,paintParticipant:R,findParticipantXCollision:function(t,e){for(var i=SEQ.parser.diagram.participants,a=0;a<i.length;a++){var n=i[a],r=[];SEQ.parser.diagram.entries.forEach(function(t){t.activation&&t.fromParticipantName===n.name&&t.position.posY<=e&&(t.endPosY>=e||!t.endPosY)&&r.push(t)});var o,s=r.length?SEQ.metrics.data.activationSideWidth:0,c=r.length?SEQ.entityActivation.calcActivationCenterDiff(r.length)+SEQ.metrics.data.activationSideWidth:0;o=SEQ.entityParticipant.isSpecialParticipantName(n.name)?SEQ.metrics.data.participantSpecialCollisionSpace:n.width/2;var l=(SEQ.parser.diagram.title?SEQ.parser.diagram.title.totalHeight:0)+(SEQ.parser.diagram.frame?SEQ.parser.diagram.frame.totalHeight:0)+SEQ.metrics.data.participantMarginTop+SEQ.parser.diagram.participantMaxHeight+SEQ.parser.diagram.maxParticipantGroupHeight,p=n.posX-o-s,g=n.posX+o+c,d=l-n.height;if(t>p&&t<g&&(!e||e>d))return n}},storeParticipantWithDefinedWidths:h,storeParticipantWithTimelineWidths:function(t,e,i,a){SEQ.parser.participantExists(e)||Q(t,e);var n=SEQ.parser.diagram.participantsByName[e];n.timelineLeftWidth<i&&(n.timelineLeftWidth=i),n.timelineRightWidth<a&&(n.timelineRightWidth=a)},storeParticipantsAndCalcWidths:function(t,e,i,a){SEQ.parser.participantExists(e)||Q(t,e),SEQ.parser.participantExists(i)||Q(t,i);var n,r=SEQ.parser.diagram.participantsByName[e],o=SEQ.parser.diagram.participantsByName[i],s=SEQ.parser.diagram.participants.indexOf(r),c=SEQ.parser.diagram.participants.indexOf(o),l=Math.abs(s-c);n=l>2?(a-function(t,e){for(var i=t<e?{low:t,high:e}:{low:e,high:t},a=0,n=i.low+1;n<=i.high;n++){var r=SEQ.parser.diagram.participants[n-1],o=SEQ.parser.diagram.participants[n];if(n!=i.low+1&&n!=i.high){var s=(r?r.width/2+SEQ.metrics.data.participantMarginSide:0)+o.width/2+SEQ.metrics.data.participantMarginSide,c=r&&r.entityRightWidth>o.entityLeftWidth?r.entityRightWidth:o.entityLeftWidth;a+=Math.max(s,c)}}return a}(s,c,SEQ.parser.diagram.participants))/2:2===l?a/2:a,n>0&&(s<c?(P(r,0,n),P(o,n,0)):(P(r,n,0),P(o,0,n)))},updateParticipantEntityWidths:P,updateParticipantOuterWidths:function(t,e,i){t.outerLeftWidth+=e,t.outerRightWidth+=i},isType:function(t){return u.PARTICIPANT===t},isSpecialParticipantName:y,isSpecialParticipantLeftName:function(t){return m.LEFT_PARTICIPANT===t},isSpecialParticipantRightName:function(t){return m.RIGHT_PARTICIPANT===t},calcBasicParticipantWidth:T,calcBasicParticipantHeight:A,build:function(t,e,i,a,n,r){var o=t;return n?o+=" "+n:r&&(o+=" "+r),a&&(a.lineColor?(o+=" "+M(a.lineColor),a.lineWeight&&(o+=":"+a.lineWeight)):a.lineWeight&&(o+=" :"+a.lineWeight)),i&&(o+=' "'+i+'" as'),o+=" "+e,a&&a.fillColor&&(o+=" "+M(a.fillColor)),o},Type:u,nameGroup:p,colorGroup:g,colorGroupMandatory:"(?:\\s?(#[a-fA-F0-9]{6})|(?:\\s?#)([a-zA-Z]{3,20}))",regExp:d,groups:E,specialParticipant:m}}(),(SEQ=SEQ||{}).entityDivider=function(){var t=new RegExp("^\\s{0,100}(==)(.{0,20000})(==)"+SEQ.entityParticipant.colorGroup+"$"),e={EQUALS_1:1,TEXT:2,EQUALS_2:3,COLOR_HEX:4,COLOR_NAME:5},i={DIVIDER:"=="};function a(t,e){t.position.posY=e}function n(t,e,i,a){var n=SEQ.metrics.data.entryMarginSide,r=SEQ.main.getDiagramCanvas().width,o=r-SEQ.metrics.data.entryMarginSide,s=SEQ.metrics.data.dividerLineSpacing,c=t.position.posY-t.totalHeight/2;if(e.beginPath(),e.moveTo(n,c-s),e.lineTo(o,c-s),e.moveTo(n,c),e.lineTo(o,c),e.moveTo(n,c+s),e.lineTo(o,c+s),e.stroke(),1!==t.textData.lines.length||""!==t.textData.lines[0]){var l=t.totalWidth-2*SEQ.metrics.data.dividerMinimumLineWidth-2*SEQ.metrics.data.entryMarginSide,p=t.position.posY-t.totalHeight,g=r/2-l/2;e.beginPath(),e.moveTo(g,p),e.lineTo(g+l,p),e.lineTo(g+l,p+t.totalHeight),e.lineTo(g,p+t.totalHeight),e.closePath();var d=e.fillStyle;t.color?e.fillStyle=t.color:e.fillStyle=SEQ.main.getBackgroundColor(),e.fill(),e.fillStyle=d,e.stroke();var m=r/2-t.textData.width/2,E=r/2-t.textData.width/2,u=r/2+t.textData.width/2;SEQ.textUtil.fillText(e,i,t.textData.parsedLines,m,E,u,t.position.posY-t.totalHeight/2-t.textData.height/2)}}function r(t){return{main:{startX:SEQ.metrics.data.entryMarginSide,endX:SEQ.metrics.getCanvasSize().width-SEQ.metrics.data.entryMarginSide,startY:t.position.posY,endY:t.position.posY-t.totalHeight}}}function o(){var t=this.collision(this).main;return[{minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"move"}]}return{parse:function(s){var c=t.exec(s);if(null!=c&&c.length>e.TEXT){var l=SEQ.entityStyle.lookUpStyle("divider"),p=SEQ.textUtil.parseTextData(c[e.TEXT],l.text),g=c[e.COLOR_NAME],d=c[e.COLOR_HEX],m=g||d;return{type:i.DIVIDER,textData:p,color:m,totalHeight:p.height+2*SEQ.metrics.data.textPadding,totalWidth:p.width+2*SEQ.metrics.data.textPadding+2*SEQ.metrics.data.dividerMinimumLineWidth+2*SEQ.metrics.data.entryMarginSide+2*SEQ.metrics.data.boxBleed,topMargin:SEQ.metrics.data.entityMarginTop,position:{},raw:s,paint:n,updatePos:a,collision:r,collisionTypeAreas:o}}},paint:n,collision:r,build:function(t){return i.DIVIDER+t.replace(/\n/g,"\\n")+i.DIVIDER},isType:function(t){return i.DIVIDER===t},Type:i,groups:e,regExp:t}}(),(SEQ=SEQ||{}).entityTitle=function(){var t=new RegExp("^\\s{0,100}(title) (.{1,500})$","i"),e={TITLE:1,VALUE:2},i={TITLE:"title"};function a(t){var e=SEQ.metrics.getCanvasSize().width,i=e-t.textData.width,a=0,n=SEQ.parser.diagram.frame;return n&&(a+=n.totalHeight),{main:{startX:i/2,endX:e-i/2,startY:a+t.totalHeight-.6*SEQ.metrics.data.baseSpaceMetric,endY:a+.4*SEQ.metrics.data.baseSpaceMetric}}}function n(){var t=this.collision(this).main;return[{minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"pointer"}]}function r(){var t="",e=!0;return this.textData.parsedLines.forEach(function(i){e?e=!1:t+=" ",i.textElements.forEach(function(e){t+=SEQ.textUtil.stripEscaping(e.text)})}),t}function o(t,e,i){var a=SEQ.parser.diagram,n=SEQ.main.getDiagramCanvas().width,r=t.totalHeight/2-t.textData.height/2-.1*SEQ.metrics.data.baseSpaceMetric;a.frame&&(r+=a.frame.totalHeight);var o=n/2-t.textData.width/2,s=n/2-t.textData.width/2,c=n/2+t.textData.width/2;SEQ.textUtil.fillText(e,i,t.textData.parsedLines,o,s,c,r)}function s(t){return i.TITLE+" "+t.replace(/\n/g,"\\n")}return{parse:function(c){var l=t.exec(c);if(null!=l&&l.length>e.VALUE){var p=SEQ.textUtil.parseTextData(l[e.VALUE],"<size:16><align:center>");return{type:i.TITLE,textData:p,totalHeight:p.height+.6*SEQ.metrics.data.baseSpaceMetric,topMargin:0,position:{},buildFileName:r,raw:c,collision:a,collisionTypeAreas:n,paint:o,build:s}}},paint:o,isType:function(t){return t===i.TITLE},Type:i,regExp:t,groups:e}}(),(SEQ=SEQ||{}).entityFontFamily=function(){var t=new RegExp("^\\s{0,100}(fontfamily)\\s(.{1,100})$"),e={FONT_FAMILY:1,NAME:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.NAME)return{raw:i,fontFamily:a[e.NAME]}},regExp:t,groups:e,Type:{FONT_FAMILY:"fontfamily"}}}(),(SEQ=SEQ||{}).entityMessage=function(){var t="(?::([0-9]{1}(?:\\.[0-9]{1})?))?",e="(?:\\s{0,100}(--?"+SEQ.entityParticipant.colorGroup+t+"(?:>?>|x))(?:\\(([0-9]{1,2})\\))?\\s?(\\*?)\\s?|\\s?(\\*?)\\s?(?:\\(([0-9]{1,2})\\))?((?:x|<<?)"+SEQ.entityParticipant.colorGroup+t+"-?-)\\s?|\\s?(\\*?)\\s?(<<?-?-"+SEQ.entityParticipant.colorGroup+t+">?>)\\s?(\\*?)\\s?)",i=new RegExp("^"+e+"$"),a=new RegExp("^\\s{0,100}"+SEQ.entityParticipant.nameGroup+e+SEQ.entityParticipant.nameGroup+"\\s?:\\s?(.{0,20000})$"),n=new RegExp(SEQ.entityParticipant.colorGroupMandatory);const r=46.15;var o={PARTICIPANT_1:1,TYPE_RIGHT:2,COLOR_HEX_1:3,COLOR_NAME_1:4,WEIGHT_1:5,DELAY_RIGHT:6,CREATE_RIGHT:7,CREATE_LEFT:8,DELAY_LEFT:9,TYPE_LEFT:10,COLOR_HEX_2:11,COLOR_NAME_2:12,WEIGHT_2:13,CREATE_DUAL_LEFT:14,TYPE_DUAL:15,COLOR_HEX_3:16,COLOR_NAME_3:17,WEIGHT_3:18,CREATE_DUAL_RIGHT:19,PARTICIPANT_2:20,TEXT:21};function s(){if(this.delayHeight&&this.fromParticipantName!=this.toParticipantName){var t=c(this).availableHeight,e=this.textData.height-t;this.totalHeight-=e<0?this.textData.height:t}}function c(t){var e;if(t.fromParticipantName===t.toParticipantName)e=SEQ.metrics.data.messageSelfRefWidth;else{var i=E(t);e=Math.abs(i.toX-i.fromX)}var a=Math.atan2(t.delayHeight,e);return{angle:a,availableHeight:(e-t.textData.width)/2*Math.tan(a)}}function l(t,e,i,a){t.position.posY=e,t.fromPosX=i,t.toPosX=a}function p(t){if(t.create&&!t.participantToCreate){var e=SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.toParticipantName,0,0);e.createPositions.push(t.position),t.participantToCreate=e}if(t.fromParticipantName===t.toParticipantName)SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.fromParticipantName,0,t.totalWidth);else{SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[t.fromParticipantName]),SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[t.toParticipantName]);SEQ.entityParticipant.storeParticipantsAndCalcWidths(null,t.fromParticipantName,t.toParticipantName,t.totalWidth)}}function g(t){if(t.fromParticipantName===t.toParticipantName)SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,0,t.totalWidth,0,t.fromActivationXDiff,t.snapshot.ongoingFragments);else{var e=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[t.fromParticipantName]),i=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[t.toParticipantName]),a=0;t.participantToCreate&&(a=t.participantToCreate.width/2+SEQ.metrics.data.entryMarginSide),e<i?(SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,0,0,0,0,t.snapshot.ongoingFragments),SEQ.entityFragment.storeEnclosedEntriesData(t.toParticipantName,a,a,0,t.toActivationXDiff,t.snapshot.ongoingFragments)):(SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,0,0,0,0,t.snapshot.ongoingFragments),SEQ.entityFragment.storeEnclosedEntriesData(t.toParticipantName,a,a,t.toActivationXDiff,0,t.snapshot.ongoingFragments))}}function d(t,e,i){var a;a=e?e.snapshot.numberOfOngoingActivationsPerParticipant:t.snapshot.numberOfOngoingActivationsPerParticipant;var n=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[t.fromParticipantName]),r=SEQ.parser.diagram.participants.indexOf(SEQ.parser.diagram.participantsByName[t.toParticipantName]),o=0,s=0,c=a[t.fromParticipantName]||0,l=a[t.toParticipantName]||0;t.fromParticipantName===t.toParticipantName?(c&&(o+=SEQ.entityActivation.calcActivationCenterDiff(c)+SEQ.metrics.data.activationSideWidth,s+=SEQ.entityActivation.calcActivationCenterDiff(l)+SEQ.metrics.data.activationSideWidth,t.type.indexOf("--")>-1&&l>0&&i&&i.activation&&(i.type===SEQ.entityActivation.Type.DEACTIVATE||i.type===SEQ.entityActivation.Type.DEACTIVATE_AFTER)&&(t.deactivateResponse=!0)),void 0===t.fromActivationXDiffOriginal&&(t.fromActivationXDiffOriginal=t.fromActivationXDiff)):n<r?(c&&(o+=SEQ.entityActivation.calcActivationCenterDiff(c)+SEQ.metrics.data.activationSideWidth),l&&(s+=SEQ.entityActivation.calcActivationCenterDiff(l)-SEQ.metrics.data.activationSideWidth)):(c&&(o+=SEQ.entityActivation.calcActivationCenterDiff(c)-SEQ.metrics.data.activationSideWidth),l&&(s+=SEQ.entityActivation.calcActivationCenterDiff(l)+SEQ.metrics.data.activationSideWidth)),e?(e.fromParticipantName===t.fromParticipantName&&(t.fromActivationXDiff=o),e.fromParticipantName===t.toParticipantName&&(t.toActivationXDiff=s)):(t.fromActivationXDiff=o,t.toActivationXDiff=s)}function m(t){for(var e=0;e<t.length;e++){var i=t[e];if(i)return i}}function E(t){var e=SEQ.parser.diagram.participantsByName[t.fromParticipantName].posX,i=SEQ.parser.diagram.participantsByName[t.toParticipantName].posX;return t.fromParticipantName===t.toParticipantName?void 0===t.fromActivationXDiffOriginal?e+=t.fromActivationXDiff:e+=t.fromActivationXDiffOriginal:(e+=t.fromActivationXDiff,t.type.indexOf("x")>-1&&(i>e?i-=SEQ.metrics.data.messageFailurePadding:i+=SEQ.metrics.data.messageFailurePadding)),t.participantToCreate?i>e?i-=t.participantToCreate.width/2:i+=t.participantToCreate.width/2:i+=t.toActivationXDiff,{fromX:e,toX:i}}function u(t,e,i,a){var n,r;if(a)n=t.fromPosX,r=t.toPosX;else{var o=E(t);n=o.fromX,r=o.toX}var s,l,p,g,d,m=n>r?r:n,u=t.fromParticipantName===t.toParticipantName&&Math.abs(n-r)<SEQ.metrics.data.messageCreatorInteractionMargin+t.fromActivationXDiff;if(u){if(s=r+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding,l=t.position.posY-t.totalHeight,p=t.position.posY,d=s+t.textData.width+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding,t.delayHeight)g=c(t).angle}else{var S=Math.abs(n-r);if(t.participantToCreate){p=t.position.posY-t.participantToCreate.height/2,l=t.delayHeight?t.position.posY-t.totalHeight+SEQ.metrics.data.participantBoxLineWeight/2:p-t.textData.height;var h=p-SEQ.parser.diagram.participantMaxHeight+t.participantToCreate.height/2-SEQ.metrics.data.participantTypeLineWeight/2;SEQ.entityParticipant.paintParticipant(t.participantToCreate,e,h)}else l=t.position.posY-t.totalHeight,p=t.position.posY;if(t.delayHeight){var y=c(t);g=y.angle,y.availableHeight>t.textData.height&&(l+=y.availableHeight-t.textData.height)}s=m+S/2-t.textData.width/2,d=m+S}var Q=SEQ.main.getBackgroundColor();SEQ.parser.diagram.participantGroups.length?Q=!!t.enclosingFragmentColor&&(t.enclosingFragmentColor?t.enclosingFragmentColor:SEQ.main.getBackgroundColor()):t.enclosingFragmentColor?Q=t.enclosingFragmentColor?t.enclosingFragmentColor:SEQ.main.getBackgroundColor():SEQ.parser.diagram.frame&&SEQ.parser.diagram.frame.backgroundColor&&(Q=SEQ.parser.diagram.frame.backgroundColor);var v=SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding;SEQ.textUtil.fillText(e,i,t.textData.parsedLines,s,m+v,d-v,l,t.autoNumber,t.textData.autoNumberWidth,Q),SEQ.parser.diagram.frame&&(SEQ.entityParticipant.isSpecialParticipantLeftName(t.fromParticipantName)&&(n-=SEQ.metrics.data.frameMargin),SEQ.entityParticipant.isSpecialParticipantLeftName(t.toParticipantName)&&(r-=SEQ.metrics.data.frameMargin),SEQ.entityParticipant.isSpecialParticipantRightName(t.toParticipantName)&&(r+=SEQ.metrics.data.frameMargin),SEQ.entityParticipant.isSpecialParticipantRightName(t.fromParticipantName)&&(n+=SEQ.metrics.data.frameMargin)),i?f(e,t.type,p,n,r,u,t.deactivateResponse,t.delayHeight,g,t.weight):f(e,t.type,p,n,r,u,t.deactivateResponse,t.delayHeight,g,t.weight,t.color)}function S(t){return t.indexOf(">")>-1&&t.indexOf("<")>-1}function f(t,e,i,a,n,r,o,s,c,l,p){t.save(),p&&(t.strokeStyle=p,t.fillStyle=p),l||(l=1),t.lineWidth=SEQ.metrics.data.diagramLineWeight*l,t.beginPath(),e.indexOf("--")>-1&&void 0!==t.setLineDash&&t.setLineDash([SEQ.metrics.data.messageLineDashWidth]);var g,d=a<n&&!r,m=e.indexOf("x")>-1,E=e.indexOf(">>")>-1||e.indexOf("<<")>-1;if(g=E?1.5*t.lineWidth:SEQ.metrics.data.messageArrowWidth-SEQ.metrics.data.messageArrowLineNegativeMargin,c&&(g=Math.cos(c)*g),r){var u=SEQ.metrics.data.messageSelfRefHeight,f=SEQ.metrics.data.messageSelfRefWidth+Math.abs(a-n),y=i-u,Q=0;c&&(Q=s),t.moveTo(a,y-Q),t.lineTo(a+f,y-Q),t.lineTo(a+f,i-Q);var v=i;o&&(n-=SEQ.metrics.data.activationSideWidth),m?t.lineTo(n+SEQ.metrics.data.messageFailureSize/2+SEQ.metrics.data.messageFailurePadding,v):(c&&(v-=g*Math.tan(c)),t.lineTo(n+g,v)),t.stroke()}else{var T=a;S(e)&&(T=n>a?a+g:a-g);var A=i;c?(t.moveTo(T,i-s),m||(A-=g*Math.tan(c))):t.moveTo(T,i),m?d?t.lineTo(n-SEQ.metrics.data.messageFailureSize/2,A):t.lineTo(n+SEQ.metrics.data.messageFailureSize/2,A):d?t.lineTo(n-g,A):t.lineTo(n+g,A),t.stroke()}m?function(t,e,i,a,n){i.setLineDash([]);var r=SEQ.metrics.data.messageFailureSize/2;a?e+=SEQ.metrics.data.messageFailureSize/2+SEQ.metrics.data.messageFailurePadding:n?e-=SEQ.metrics.data.messageFailureSize/2:e+=SEQ.metrics.data.messageFailureSize/2;i.beginPath(),i.moveTo(e-r,t-r),i.lineTo(e+r,t+r),i.moveTo(e-r,t+r),i.lineTo(e+r,t-r),i.stroke()}(i,n,t,r,d):(h(i,d,n,t,E,c),S(e)&&h(i,n<a,a,t,E,c)),t.restore()}function h(t,e,i,a,n,o){a.setLineDash([]);var s=SEQ.metrics.data.messageArrowWidth,c=i;a.translate(c,t),o&&(e||(o=-o),a.rotate(o)),a.translate(-c,-t),a.beginPath();var l=0,p=0;n&&(l=-Math.cos(r)*a.lineWidth*2,p=Math.tan(r)*(l/4)),e?(a.moveTo(i-s-l/4,t-s/2-p),a.lineTo(i-l,t),a.lineTo(i-s-l/4,t+s/2+p)):(a.moveTo(i+s+l/4,t-s/2-p),a.lineTo(i+l,t),a.lineTo(i+s+l/4,t+s/2+p)),n?a.stroke():(a.closePath(),a.fill()),o&&a.rotate(-o)}function y(t,e){for(var i=this.collisionTypeAreas(),a=0;a<i.length;a++){var n=i[a];if(t>=n.minX&&t<=n.maxX&&e>=n.minY&&e<=n.maxY)return{participantToCreate:n.participantToCreate}}}function Q(t){var e,i,a,n,r,o,s=E(t),c=s.fromX,l=s.toX;return t.participantToCreate?(c<l?(r=l,o=l+t.participantToCreate.width,l+=t.participantToCreate.width):(r=l-t.participantToCreate.width,o=l,l-=t.participantToCreate.width),c<l?(e=c,i=l):(e=l,i=c),{main:{startX:e,endX:i,startY:a=t.position.posY,endY:n=t.position.posY-t.totalHeight,forward:l>c},participantToCreate:{startX:r,endX:o,startY:a,endY:n}}):(t.fromParticipantName===t.toParticipantName?(e=c,i=l+t.totalWidth-SEQ.metrics.data.messageSelfRefSideMargin):c<l?(e=c,i=l):(e=l,i=c),{main:{startX:e,endX:i,startY:a=t.position.posY+SEQ.metrics.data.collisionBleed,endY:n=t.position.posY-t.totalHeight,forward:l>c}})}function v(t){return t.has("center")||t.has("centerright")||t.has("centerleft")}function T(t,e,i,a,n){return t.has("left")?i:v(t)?a:n-e}function A(t,e,i,a,n){return t.has("right")?n:v(t)?a:i+e}function P(){var t=this.collision(this),e=t.main,i=t.participantToCreate,a=[],n=0;if(this.delayHeight){var r=c(this);r.availableHeight>this.textData.height&&(n=r.availableHeight-this.textData.height)}var o=E(this);if(i){var s=0,l=e.startY-this.participantToCreate.height/2-this.textData.height,p=e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric;if(this.delayHeight&&(s=this.delayHeight,l=e.endY+n,p=e.endY+this.textData.height+SEQ.metrics.data.messageCollisionBleed+n),e.forward){var g=e.startX+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding,d=i.startX-SEQ.metrics.data.messageArrowWidth-SEQ.metrics.data.textPadding,m=e.startX+(i.startX-e.startX)/2-this.textData.width/2-SEQ.metrics.data.messageCollisionBleed,u=i.startX-(i.startX-e.startX)/2+this.textData.width/2+SEQ.metrics.data.messageCollisionBleed,S=T(this.textData.positionTypes,this.textData.width,g,m,d),f=A(this.textData.positionTypes,this.textData.width,g,u,d);a.push({minX:e.startX,maxX:e.startX+SEQ.metrics.data.entryMoverXCollisionWidth,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,type:"pointer"},{minX:S,maxX:f,minY:l,maxY:p,type:"pointer"},{minX:i.startX-SEQ.metrics.data.entryMoverXCollisionWidth,maxX:i.startX,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,type:"pointer"},{minX:i.startX,maxX:i.endX,minY:e.startY-this.participantToCreate.height,maxY:e.startY,type:"pointer",participantToCreate:!0}),this.delayHeight||a.push({minX:e.startX+SEQ.metrics.data.entryMoverXCollisionWidth,maxX:S,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,type:"pointer"},{minX:f,maxX:i.startX-SEQ.metrics.data.entryMoverXCollisionWidth,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,type:"pointer"})}else{var h=i.endX+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding,y=e.endX-SEQ.metrics.data.messageArrowWidth-SEQ.metrics.data.textPadding,Q=i.endX+(e.endX-i.endX)/2-this.textData.width/2-SEQ.metrics.data.messageCollisionBleed,v=i.endX+(e.endX-i.endX)/2+this.textData.width/2+SEQ.metrics.data.messageCollisionBleed,P=T(this.textData.positionTypes,this.textData.width,h,Q,y),x=A(this.textData.positionTypes,this.textData.width,h,v,y);a.push({minX:e.endX-SEQ.metrics.data.entryMoverXCollisionWidth,maxX:e.endX,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,type:"pointer"},{minX:P,maxX:x,minY:l,maxY:p,type:"pointer"},{minX:i.endX,maxX:i.endX+SEQ.metrics.data.entryMoverXCollisionWidth,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,type:"pointer"},{minX:i.startX,maxX:i.endX,minY:e.startY-this.participantToCreate.height,maxY:e.startY,type:"pointer",participantToCreate:!0}),this.delayHeight||a.push({minX:x,maxX:e.endX-SEQ.metrics.data.entryMoverXCollisionWidth,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric-s,type:"pointer"},{minX:i.endX+SEQ.metrics.data.entryMoverXCollisionWidth,maxX:P,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,maxY:e.startY-this.participantToCreate.height/2+.3*SEQ.metrics.data.baseSpaceMetric,type:"pointer"})}}else{var C,R=e.startX+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding,O=e.endX-SEQ.metrics.data.messageArrowWidth-SEQ.metrics.data.textPadding,N=e.startX+(e.endX-e.startX)/2-this.textData.width/2-SEQ.metrics.data.messageCollisionBleed,M=e.endX-(e.endX-e.startX)/2+this.textData.width/2+SEQ.metrics.data.messageCollisionBleed,L=T(this.textData.positionTypes,this.textData.width,R,N,O);C=this.fromParticipantName===this.toParticipantName?M:A(this.textData.positionTypes,this.textData.width,R,M,O);var I=0,D=0;if(this.delayHeight&&(e.forward?I=.3*SEQ.metrics.data.baseSpaceMetric:D=.3*SEQ.metrics.data.baseSpaceMetric),this.fromParticipantName===this.toParticipantName)a.push({minX:o.toX,maxX:o.toX+SEQ.metrics.data.entryMoverXCollisionWidth,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-D-I,maxY:e.startY,type:"pointer"},{minX:o.toX+SEQ.metrics.data.entryMoverXCollisionWidth,maxX:C+.5*SEQ.metrics.data.baseSpaceMetric,minY:e.endY,maxY:e.endY+this.textData.height,type:"pointer"},{minX:o.toX+SEQ.metrics.data.entryMoverXCollisionWidth,maxX:o.toX+SEQ.metrics.data.messageSelfRefWidth,minY:e.endY+this.textData.height,maxY:e.startY,type:"pointer"});else{var w=0,F=0;this.delayHeight&&(e.forward?F=this.delayHeight:w=this.delayHeight),a.push({minX:e.startX,maxX:e.startX+SEQ.metrics.data.entryMoverXCollisionWidth,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-F-D,maxY:e.startY-F,type:"pointer"},{minX:L,maxX:C,minY:e.endY+n,maxY:e.endY+this.textData.height+SEQ.metrics.data.messageCollisionBleed+n+.2*SEQ.metrics.data.baseSpaceMetric,type:"pointer"},{minX:e.endX-SEQ.metrics.data.entryMoverXCollisionWidth,maxX:e.endX,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-w-I,maxY:e.startY-w,type:"pointer"}),this.delayHeight||a.push({minX:e.startX+SEQ.metrics.data.entryMoverXCollisionWidth,maxX:L,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-F-D,maxY:e.startY-F,type:"pointer"},{minX:C,maxX:e.endX-SEQ.metrics.data.entryMoverXCollisionWidth,minY:e.startY-SEQ.metrics.data.baseSpaceMetric-w-I,maxY:e.startY-w,type:"pointer"})}}return a}function x(t){var e=C(t.match,o.DELAY_RIGHT);e=e?"("+e+")":e;var i=C(t.match,o.CREATE_RIGHT),a=C(t.match,o.CREATE_LEFT),n=C(t.match,o.DELAY_LEFT);n=n?"("+n+")":n;var r=C(t.match,o.CREATE_DUAL_LEFT),s=C(t.match,o.CREATE_DUAL_LEFT);return R(t.type)&&!r?t.fromParticipantName+t.type+e+i+s+t.toParticipantName+":"+SEQ.textUtil.buildSourceText(t.textData):t.toParticipantName+r+a+n+t.type+t.fromParticipantName+":"+SEQ.textUtil.buildSourceText(t.textData)}function C(t,e){return t[e]?t[e]:""}function R(t){return/>|-.{0,100}x/.exec(t)}function O(t){return t[o.CREATE_LEFT]||t[o.CREATE_RIGHT]||t[o.CREATE_DUAL_LEFT]||t[o.CREATE_DUAL_RIGHT]}return{parse:function(t,e,r,c,S){var f=a.exec(t);if(null!=f&&f.length>o.TEXT){var h,v,T=m([f[o.TYPE_RIGHT],f[o.TYPE_LEFT],f[o.TYPE_DUAL]]);if(f[o.CREATE_DUAL_LEFT]&&f[o.CREATE_DUAL_RIGHT])return;var A=R(T)&&!f[o.CREATE_DUAL_LEFT];A?(h=f[o.PARTICIPANT_1],v=f[o.PARTICIPANT_2]):(h=f[o.PARTICIPANT_2],v=f[o.PARTICIPANT_1]);var C,N,M=m([f[o.COLOR_HEX_1],f[o.COLOR_NAME_1],f[o.COLOR_HEX_2],f[o.COLOR_NAME_2],f[o.COLOR_HEX_3],f[o.COLOR_NAME_3]]),L=m([f[o.WEIGHT_1],f[o.WEIGHT_2],f[o.WEIGHT_3]]),I=r?c:null,D=SEQ.entityStyle.lookUpStyle("message"),w=SEQ.textUtil.parseTextData(f[o.TEXT],D.text,I),F=w.height,_=f[o.DELAY_LEFT]?f[o.DELAY_LEFT]:f[o.DELAY_RIGHT];if(_&&(F+=C=SEQ.metrics.data.baseSpaceMetric*_),h===v){N=w.width+SEQ.metrics.data.messageArrowWidth+SEQ.metrics.data.textPadding+SEQ.metrics.data.messageSelfRefSideMargin;var W=SEQ.metrics.data.messageSelfRefWidth,B=SEQ.metrics.data.messageSelfRefSideMargin;N=N>W+B?N:W+B,F+=SEQ.metrics.data.messageSelfRefHeight}else N=w.width+2*SEQ.metrics.data.messageArrowWidth+2*SEQ.metrics.data.textPadding,T.indexOf("x")>-1&&(N+=SEQ.metrics.data.messageFailureSize/2+SEQ.metrics.data.messageFailurePadding);if(S)var b=function(t,e,a){var r,o,s=SEQ.parser.diagram;if(s.entries.length>0)for(var c=s.entries.length-1;c>=0;c--){var l=s.entries[c];if(l&&l.type){o=(r=l).type.trim().replace(n,"");break}}var p=t.trim().replace(n,"");if(r&&r.linearEnabled&&i.exec(o)&&o===p&&r.toParticipantName===e){var g=s.participantsByName,d=s.participants,m=g[r.fromParticipantName],E=g[r.toParticipantName],u=g[e],S=g[a],f=d.indexOf(m),h=d.indexOf(E),y=d.indexOf(u),Q=d.indexOf(S);if(f<h&&(y<=Q||!S)||f>h&&y>=Q)return!0}return!1}(T,h,v);var X={};if(O(f)){var Y=SEQ.parser.diagram.participantsByName[v];if(Y){var H=F-Y.height/2;F=Y.height,H>0&&(F+=H),Y.createPositions.push(X),N+=Y.width/2}else{var G=F-SEQ.entityParticipant.calcBasicParticipantHeight()/2;F=SEQ.entityParticipant.calcBasicParticipantHeight(),G>0&&(F+=G),N+=SEQ.entityParticipant.calcBasicParticipantWidth(v)/2}}var k=SEQ.parser.diagram.ongoingFragments;if(k.length)var U=k[k.length-1].backgroundColor;return{type:T,directionForward:A,fromParticipantName:h,toParticipantName:v,participantToCreate:Y,textData:w,color:M,enclosingFragmentColor:U,totalHeight:F,delayHeight:C,totalWidth:N,weight:L,topMargin:SEQ.metrics.data.entityMarginTop,position:X,autoNumber:I,parallel:e,linearWithPrevious:b,linearEnabled:S,create:O(f),match:f,raw:t,message:!0,paint:u,updatePos:l,reCalcTotalHeight:s,collision:Q,collisionV2:y,collisionTypeAreas:P,buildRaw:x,calcPosX:E,updateActivationPosDiff:d,updateEnclosingFragments:g,updateParticipantWidths:p}}},paint:u,build:function(t,e,i,a){return R(t)?e+t+i+":"+a.replace(/\n/g,"\\n"):i+t+e+":"+a.replace(/\n/g,"\\n")},paintArrowHead:h,isType:function(t){return null!=i.exec(t)},createdParticipant:function(t){var e=a.exec(t);if(null!=e&&O(e))return function(t){return m([t[o.TYPE_RIGHT],t[o.TYPE_LEFT],t[o.TYPE_DUAL]])}(e).indexOf(">")>-1?e[o.PARTICIPANT_2]:e[o.PARTICIPANT_1]},lineWeightGroup:t,Type:{REQ_FORWARD_SYNC:"->",RESP_FORWARD_SYNC:"--\x3e",REQ_FORWARD_ASYNC:"->>",RESP_FORWARD_ASYNC:"--\x3e>",REQ_BACKWARD_SYNC:"<-",RESP_BACKWARD_SYNC:"<--",REQ_BACKWARD_ASYNC:"<<-",RESP_BACKWARD_ASYNC:"<<--"},regExpArrow:i,regExp:a,groups:o}}(),(SEQ=SEQ||{}).entityNoteBoxLeftRight=function(){var t=new RegExp("^\\s{0,100}(note|box|rbox|abox|aboxleft|aboxright)\\s(left\\sof|right\\sof)\\s"+SEQ.entityParticipant.nameGroup+"\\s?"+SEQ.entityParticipant.colorGroup+"\\s?:\\s?(.{0,20000})$"),e={TYPE:1,SIDE:2,PARTICIPANT_FROM:3,COLOR_HEX:4,COLOR_NAME:5,TEXT:6},i={NOTE:"note",BOX:"box",RBOX:"rbox",ABOX:"abox",ABOX_LEFT:"aboxleft",ABOX_RIGHT:"aboxright"},a={LEFT:"left of",RIGHT:"right of"};function n(t,e,i){t.position.posY=e,t.fromPosX=i}function r(t){a.LEFT===t.side?SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.fromParticipantName,t.totalWidth,0):SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.fromParticipantName,0,t.totalWidth)}function o(t){a.LEFT===t.side?SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,t.totalWidth,0,Math.abs(t.fromActivationXDiff),0,t.snapshot.ongoingFragments):SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,0,t.totalWidth,0,t.fromActivationXDiff,t.snapshot.ongoingFragments)}function s(t){var e=0,i=t.snapshot.numberOfOngoingActivationsPerParticipant[t.fromParticipantName]||0;t.side===SEQ.entityNoteBoxLeftRight.NotePosition.LEFT&&i?e-=SEQ.metrics.data.activationSideWidth:t.side===SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT&&i&&(e+=SEQ.entityActivation.calcActivationCenterDiff(i)+SEQ.metrics.data.activationSideWidth),t.fromActivationXDiff=e}function c(t){var e=SEQ.parser.diagram.participantsByName[t.fromParticipantName].posX;return t.fromActivationXDiff&&(e+=t.fromActivationXDiff),{fromX:e}}function l(t,e,i,a){var n;a?n=t.fromPosX:n=c(t).fromX;e.beginPath();var r,o=SEQ.metrics.data.entryMarginSide;t.side===SEQ.entityNoteBoxLeftRight.NotePosition.LEFT?(r=n-t.totalWidth+o,e.moveTo(n,t.position.posY-t.totalHeight/2),e.lineTo(n-o,t.position.posY-t.totalHeight/2)):t.side===SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT&&(r=n+o,e.moveTo(n,t.position.posY-t.totalHeight/2),e.lineTo(n+o,t.position.posY-t.totalHeight/2)),SEQ.entityNoteBoxOver.paintNoteOrBox(t,e,r,t.totalWidth-2*o);var s=r-o+t.totalWidth/2-t.textData.width/2,l=t.position.posY-t.totalHeight/2-t.textData.height/2,p=SEQ.metrics.data.textPadding+SEQ.metrics.data.boxBleed+SEQ.metrics.data.entryMarginSide;SEQ.textUtil.fillText(e,i,t.textData.parsedLines,s,r+p-o,r+t.totalWidth-p-o,l)}function p(t){var e,i,a=c(t).fromX,n=SEQ.metrics.data.entryMarginSide;return t.side===SEQ.entityNoteBoxLeftRight.NotePosition.LEFT?(e=a-t.totalWidth,i=a):t.side===SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT&&(e=a,i=a+t.totalWidth),{main:{startX:e+=n,endX:i-=n,startY:t.position.posY,endY:t.position.posY-t.totalHeight}}}function g(){var t=this.collision(this).main,e=[];return e.push({minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"pointer"}),e}function d(t){var e="";return t.color&&(e=t.color.indexOf("#")>-1?" "+t.color:" #"+t.color),t.type+" "+t.side+" "+t.fromParticipantName+e+":"+SEQ.textUtil.buildSourceText(t.textData)}return{parse:function(i,a){var m=t.exec(i);if(null!=m&&m.length>e.TEXT){var E=m[e.TYPE],u=SEQ.entityStyle.lookUpStyle(E),S=SEQ.textUtil.parseTextData(m[e.TEXT],u.text),f=m[e.PARTICIPANT_FROM],h=m[e.COLOR_NAME],y=m[e.COLOR_HEX],Q=h||y,v=S.width+2*SEQ.metrics.data.textPadding+2*SEQ.metrics.data.boxBleed+2*SEQ.metrics.data.entryMarginSide;return{type:E,fromParticipantName:f,side:m[e.SIDE],textData:S,color:Q,parallel:a,totalHeight:S.height+2*SEQ.metrics.data.textPadding,totalWidth:v,topMargin:SEQ.metrics.data.entityMarginTop,position:{},raw:i,paint:l,updatePos:n,collision:p,collisionTypeAreas:g,buildRaw:d,calcPosX:c,updateActivationPosDiff:s,updateEnclosingFragments:o,updateParticipantWidths:r}}},paint:l,collision:p,build:function(t,e,i,a){return t+" "+e+" "+i+":"+a.replace(/\n/g,"\\n")},regExp:t,Type:i,isType:function(t){return i.NOTE===t||i.BOX===t||i.ABOX===t||i.RBOX===t||i.ABOX_LEFT===t||i.ABOX_RIGHT===t||SEQ.entityNoteBoxOver.Type.REF===t},NotePosition:a,groups:e}}(),(SEQ=SEQ||{}).entityNoteBoxOver=function(){var t=new RegExp("^\\s{0,100}(note|box|rbox|abox|ref|aboxleft|aboxright)\\s(over)\\s"+SEQ.entityParticipant.nameGroup+"(?:,\\s?"+SEQ.entityParticipant.nameGroup+")?\\s?"+SEQ.entityParticipant.colorGroup+"\\s?:\\s?(.{0,20000})$"),e={TYPE:1,SIDE:2,PARTICIPANT_FROM:3,PARTICIPANT_TO:4,COLOR_HEX:5,COLOR_NAME:6,TEXT:7},i={NOTE:"note",BOX:"box",RBOX:"rbox",ABOX:"abox",ABOX_LEFT:"aboxleft",ABOX_RIGHT:"aboxright",REF:"ref"},a={OVER:"over"};function n(t,e,i,a){t.position.posY=e,t.fromPosX=i,t.toPosX=a}function r(t){if(t.toParticipantName)SEQ.entityParticipant.storeParticipantsAndCalcWidths(null,t.fromParticipantName,t.toParticipantName,t.totalWidth);else{var e=t.totalWidth/2;SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.fromParticipantName,e,e)}}function o(t){if(t.toParticipantName)SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,0,0,0,0,t.snapshot.ongoingFragments),SEQ.entityFragment.storeEnclosedEntriesData(t.toParticipantName,0,0,0,0,t.snapshot.ongoingFragments);else{var e=t.totalWidth/2;SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,e,e,0,0,t.snapshot.ongoingFragments)}}function s(t){var e=SEQ.parser.diagram.participantsByName[t.fromParticipantName].posX,i=null;return t.toParticipantName&&(i=SEQ.parser.diagram.participantsByName[t.toParticipantName].posX),{fromX:e,toX:i}}function c(t,e,a,n){var r,o;if(n)r=t.fromPosX,t.toParticipantName&&(o=t.toPosX);else{var c=s(t);r=c.fromX,o=c.toX}e.beginPath();var p,g,d,m,E=SEQ.metrics.data.boxBleed;o?(g=(p=(o>r?r:o)-E)+(m=Math.abs(r-o)+2*E)/2-t.textData.width/2,d=t.position.posY-t.totalHeight/2-t.textData.height/2):(p=r-t.totalWidth/2+SEQ.metrics.data.entryMarginSide,m=t.totalWidth-2*SEQ.metrics.data.entryMarginSide,g=r-t.textData.width/2,d=t.position.posY-t.totalHeight/2-t.textData.height/2);i.REF===t.type?(e.save(),e.lineWidth=SEQ.metrics.data.fragmentLineWeight,e.font="bold "+SEQ.main.getFontSmall(),SEQ.entityFragment.paintFragment(e,e.font,p,t.position.posY-t.totalHeight,SEQ.metrics.data.fragmentHeight,t.position.posY,p+m,t.type,t.color,null,!0),e.restore(),d+=SEQ.metrics.data.fragmentHeight/2-SEQ.metrics.data.fragmentLineWeight/2):l(t,e,p,m);var u=SEQ.metrics.data.boxBleed+SEQ.metrics.data.textPadding;SEQ.textUtil.fillText(e,a,t.textData.parsedLines,g,p+u,p+m-u,d)}function l(t,e,a,n){i.NOTE==t.type?function(t,e,i,a,n,r){var o=SEQ.metrics.data.boxBleed;t.moveTo(e,i-a),t.lineTo(e+n-o,i-a),t.lineTo(e+n,i-a+o),t.lineTo(e+n,i),t.lineTo(e,i),t.lineTo(e,i-a);var s=t.fillStyle;t.fillStyle=r||SEQ.main.getBackgroundColor();t.fill(),t.moveTo(e+n-o,i-a),t.lineTo(e+n-o,i-a+o),t.lineTo(e+n,i-a+o),t.fillStyle=s,t.stroke()}(e,a,t.position.posY,t.totalHeight,n,t.color):i.BOX==t.type?function(t,e,i,a,n,r){t.moveTo(e,i-a),t.lineTo(e+n,i-a),t.lineTo(e+n,i),t.lineTo(e,i),t.lineTo(e,i-a);var o=t.fillStyle;t.fillStyle=r||SEQ.main.getBackgroundColor();t.fill(),t.fillStyle=o,t.stroke()}(e,a,t.position.posY,t.totalHeight,n,t.color):i.RBOX==t.type?function(t,e,i,a,n,r){var o=SEQ.metrics.data.boxBleed;t.moveTo(e,i-a+o),t.arc(e+o,i-a+o,o,Math.PI,-Math.PI/2),t.lineTo(e+n-o,i-a),t.arc(e+n-o,i-a+o,o,-Math.PI/2,0),t.lineTo(e+n,i-o),t.arc(e+n-o,i-o,o,0,Math.PI/2),t.lineTo(e+o,i),t.arc(e+o,i-o,o,Math.PI/2,Math.PI),t.lineTo(e,i-a+o);var s=t.fillStyle;t.fillStyle=r||SEQ.main.getBackgroundColor();t.fill(),t.fillStyle=s,t.stroke()}(e,a,t.position.posY,t.totalHeight,n,t.color):i.ABOX==t.type?function(t,e,i,a,n,r){var o=SEQ.metrics.data.boxBleed;t.moveTo(e+o,i-a),t.lineTo(e+n-o,i-a),t.lineTo(e+n,i-a/2),t.lineTo(e+n-o,i),t.lineTo(e+o,i),t.lineTo(e,i-a/2),t.lineTo(e+o,i-a);var s=t.fillStyle;t.fillStyle=r||SEQ.main.getBackgroundColor();t.fill(),t.fillStyle=s,t.stroke()}(e,a,t.position.posY,t.totalHeight,n,t.color):i.ABOX_LEFT==t.type?function(t,e,i,a,n,r){var o=SEQ.metrics.data.boxBleed;t.moveTo(e+o,i-a),t.lineTo(e+n,i-a),t.lineTo(e+n,i),t.lineTo(e+o,i),t.lineTo(e,i-a/2),t.lineTo(e+o,i-a);var s=t.fillStyle;t.fillStyle=r||SEQ.main.getBackgroundColor();t.fill(),t.fillStyle=s,t.stroke()}(e,a,t.position.posY,t.totalHeight,n,t.color):i.ABOX_RIGHT==t.type&&function(t,e,i,a,n,r){var o=SEQ.metrics.data.boxBleed;t.moveTo(e,i-a),t.lineTo(e+n-o,i-a),t.lineTo(e+n,i-a/2),t.lineTo(e+n-o,i),t.lineTo(e,i),t.lineTo(e,i-a);var s=t.fillStyle;t.fillStyle=r||SEQ.main.getBackgroundColor();t.fill(),t.fillStyle=s,t.stroke()}(e,a,t.position.posY,t.totalHeight,n,t.color)}function p(t){var e,i,a=s(t),n=a.fromX,r=a.toX;return r?(n<r?(e=n,i=r):(e=r,i=n),e-=SEQ.metrics.data.boxBleed,i+=SEQ.metrics.data.boxBleed):(e=n-t.totalWidth/2+SEQ.metrics.data.entryMarginSide,i=n+t.totalWidth/2-SEQ.metrics.data.entryMarginSide),{main:{startX:e,endX:i,startY:t.position.posY,endY:t.position.posY-t.totalHeight}}}function g(){var t=this.collision(this).main,e=[];return this.toParticipantName?e.push({minX:t.startX,maxX:t.startX+SEQ.metrics.data.entryMoverXCollisionWidth+SEQ.metrics.data.boxBleed,minY:t.endY,maxY:t.startY,type:"pointer"},{minX:t.endX-SEQ.metrics.data.entryMoverXCollisionWidth-SEQ.metrics.data.boxBleed,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"pointer"},{minX:t.startX+SEQ.metrics.data.entryMoverXCollisionWidth+SEQ.metrics.data.boxBleed,maxX:t.endX-SEQ.metrics.data.entryMoverXCollisionWidth-SEQ.metrics.data.boxBleed,minY:t.endY,maxY:t.startY,type:"pointer"}):e.push({minX:t.startX,maxX:t.startX+SEQ.metrics.data.entryMoverXCollisionWidth,minY:t.endY,maxY:t.startY,type:"pointer"},{minX:t.endX-SEQ.metrics.data.entryMoverXCollisionWidth,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"pointer"},{minX:t.startX+SEQ.metrics.data.entryMoverXCollisionWidth,maxX:t.endX-SEQ.metrics.data.entryMoverXCollisionWidth,minY:t.endY,maxY:t.startY,type:"pointer"}),e}function d(t){var e="";t.color&&(e=t.color.indexOf("#")>-1?" "+t.color:" #"+t.color);var i=t.toParticipantName?","+t.toParticipantName:"";return t.type+" "+t.side+" "+t.fromParticipantName+i+e+":"+SEQ.textUtil.buildSourceText(t.textData)}return{parse:function(l,m){var E=t.exec(l);if(null!=E&&E.length>e.TEXT){var u,S=E[e.TYPE],f=SEQ.entityStyle.lookUpStyle(S),h=SEQ.textUtil.parseTextData(E[e.TEXT],f.text),y=E[e.PARTICIPANT_TO],Q=E[e.PARTICIPANT_FROM],v=E[e.COLOR_NAME],T=E[e.COLOR_HEX],A=v||T;u=y?h.width+2*SEQ.metrics.data.textPadding:h.width+2*SEQ.metrics.data.textPadding+2*SEQ.metrics.data.boxBleed+2*SEQ.metrics.data.entryMarginSide;var P=h.height+2*SEQ.metrics.data.textPadding;return i.REF===S&&(P+=SEQ.metrics.data.fragmentHeight),{type:S,notePosition:a.OVER,fromParticipantName:Q,toParticipantName:y,side:E[e.SIDE],textData:h,color:A,parallel:m,totalHeight:P,totalWidth:u,topMargin:SEQ.metrics.data.entityMarginTop,position:{},raw:l,paint:c,updatePos:n,collision:p,collisionTypeAreas:g,buildRaw:d,calcPosX:s,updateEnclosingFragments:o,updateParticipantWidths:r}}},paint:c,collision:p,build:function(t,e,i){return t+" "+a.OVER+" "+e+":"+i.replace(/\n/g,"\\n")},paintNoteOrBox:l,Type:i,NotePosition:a,regExp:t,groups:e}}(),(SEQ=SEQ||{}).entityAutoNumber=function(){var t=new RegExp("^\\s{0,100}(autonumber)\\s?(on|off|[0-9]{1,5})?$"),e={AUTO_NUMBER:1,STATUS:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.STATUS){var n,r=a[e.STATUS];if("on"===r)var o=!0;else"off"===r?o=!1:isNaN(r)?o=!0:(o=!0,n=r);return{raw:i,enabled:o,value:n}}},regExp:t,groups:e,Type:{AUTO_NUMBER:"autonumber"}}}(),(SEQ=SEQ||{}).entityLinear=function(){var t=new RegExp("^\\s{0,100}(linear)\\s?(on|off|end)?$"),e={LINEAR:1,STATUS:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.STATUS){var n=a[e.STATUS];if("on"===n)var r=!0;else r="off"!==n&&"end"!==n;return{raw:i,enabled:r}}},regExp:t,groups:e,Type:{LINEAR:"linear"}}}(),(SEQ=SEQ||{}).entityFragment=function(){var t=new RegExp("^\\s{0,100}(alt|else|thread|opt|loop|par|break|critical|seq|strict|neg|ignore|consider|assert|region|end|expandable\\-|expandable\\−|expandable\\+)"+SEQ.entityParticipant.colorGroup+SEQ.entityParticipant.colorGroup+"(?:$|\\s(.{0,100}))|\\s?(?:\\s|^)(group)"+SEQ.entityParticipant.colorGroup+"\\s?([^\\[#]{1,100})"+SEQ.entityParticipant.colorGroup+"\\s?(?:(\\[)(.{0,100})(\\]))?$"),e={OPERATOR:1,COLOR_HEX_FRAGMENT:2,COLOR_NAME_FRAGMENT:3,COLOR_HEX_LABEL:4,COLOR_NAME_LABEL:5,TEXT:6,GROUP:7,COLOR_HEX_FRAGMENT_GROUP:8,COLOR_NAME_FRAGMENT_GROUP:9,GROUP_LABEL:10,COLOR_HEX_LABEL_GROUP:11,COLOR_NAME_LABEL_GROUP:12,GROUP_CONDITION_LEFT_BRACKET:13,GROUP_CONDITION:14,GROUP_CONDITION_RIGHT_BRACKET:15},i={ALT:"alt",ELSE:"else",THREAD:"thread",OPT:"opt",LOOP:"loop",PAR:"par",BREAK:"break",CRITICAL:"critical",EXPANDABLE_DASH:"expandable-",EXPANDABLE_MINUS:"expandable−",EXPANDABLE_PLUS:"expandable+",SEQ:"seq",STRICT:"strict",NEG:"neg",IGNORE:"ignore",CONSIDER:"consider",ASSERT:"assert",END:"end",GROUP:"group"},a={TOGGLE:"toggle"};const n=.9,r=1.3;function o(t,e){return t||e}function s(t){if(t.toParticipantName)SEQ.entityParticipant.storeParticipantsAndCalcWidths(null,t.fromParticipantName,t.toParticipantName,t.totalWidth);else{var e=t.totalWidth/2;SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.fromParticipantName,e,e)}}function c(t,e,i){for(var a=0,n=0,r=0;r<t.length;r++){var o,s,c=t[r];c.type===SEQ.entityFragment.Type.EXPANDABLE_PLUS?c.startEntry.toParticipantName?(o=0,s=0):(o=c.startEntry.totalWidth/2,s=c.startEntry.totalWidth/2):(o=c.leftWidth,s=c.rightWidth),c.participantDataMin.participantName==e.participantName&&o>a&&(a=o),c.participantDataMax.participantName==i.participantName&&s>n&&(n=s)}return{leftWidth:a+SEQ.metrics.data.fragmentMarginSide,rightWidth:n+SEQ.metrics.data.fragmentMarginSide}}function l(t,e){return t+2*SEQ.metrics.data.fragmentLabelSidePadding+e+SEQ.metrics.data.fragmentLabelEdgeLength}function p(t){var e=SEQ.parser.diagram.participantsByName[t.fromParticipantName].posX,i=null;return t.toParticipantName&&(i=SEQ.parser.diagram.participantsByName[t.toParticipantName].posX),{fromX:e,toX:i}}function g(t,e,i){if(t.fragment.endPosition){var a,n,r,o=p(t),s=o.fromX,c=o.toX,l=SEQ.metrics.data.boxBleed,g=t.position.posY-t.totalHeight/2-t.textData.height/2-SEQ.metrics.data.fragmentLineWeight/2;if(c)n=(a=(c>s?s:c)-l)+(r=Math.abs(s-c)+2*l)/2-t.textData.width/2;else a=s-t.totalWidth/2+SEQ.metrics.data.entryMarginSide,r=t.totalWidth-2*SEQ.metrics.data.entryMarginSide,n=s-t.textData.width/2;e.save(),e.lineWidth=SEQ.metrics.data.fragmentLineWeight,e.font="bold "+SEQ.main.getFontSmall(),u(e,e.font,a,t.position.posY-t.totalHeight,SEQ.metrics.data.fragmentHeight,t.position.posY,a+r,t.type,t.fragment.colorFragment,t.fragment.backgroundColor,!0,t.fragment.colorLabel),e.restore(),g+=SEQ.metrics.data.fragmentHeight/2,SEQ.textUtil.fillText(e,i,t.textData.parsedLines,n,a+SEQ.metrics.data.textPadding,a+r-SEQ.metrics.data.textPadding,g)}}function d(t,e,a,n){var r=t.fragment;if(t.type!=i.END&&r.endPosition||a||n){var o=Q(r),s=o.minX,c=o.maxX,p=r.startPosition.posY-r.totalHeight;if(e.save(),e.lineWidth=SEQ.metrics.data.fragmentLineWeight,e.font=r.font,i.ELSE==t.type)(a||n)&&d(t.elseGuard);else if(i.THREAD==t.type)(a||n)&&d(t.thread);else{var g=r.type;r.groupLabel&&(g=r.groupLabel),u(e,r.font,s,p,r.totalHeight,r.endPosition.posY,c,g,r.colorFragment,r.backgroundColor,!1,r.text,r.colorLabel),r.elseGuards.forEach(function(t){d(t)}),r.threads.forEach(function(t){d(t)})}e.restore()}function d(i){e.save(),e.setLineDash([SEQ.metrics.data.fragmentOperandLineDashWidth]),e.beginPath(),e.moveTo(s,i.position.posY-i.totalHeight),e.lineTo(c,i.position.posY-i.totalHeight),e.stroke(),e.restore();var a=l(s,SEQ.metrics.calcWidth(r.type,r.font)),n=i.position.posY-SEQ.metrics.data.fragmentTextPosYOffset;E(i.text,a,e,t.fragment.backgroundColor,n)}}function m(t,e){if(t.fragment.backgroundColor&&t.type!=i.END&&t.type!=i.ELSE&&t.type!=i.THREAD){var a=t.fragment,n=Q(a),r=n.minX,o=n.maxX,s=a.startPosition.posY-a.totalHeight,c=e.fillStyle;e.fillStyle=t.fragment.backgroundColor,e.fillRect(r,s,o-r,a.endPosition.posY-s),e.fillStyle=c}}function E(t,e,i,a,o){if(t){var s="["+t+"]",c=e+SEQ.metrics.data.fragmentTextSideMargin,l=c-SEQ.metrics.data.textBackgroundPadding,p=SEQ.metrics.calcWidth(s)+2*SEQ.metrics.data.textBackgroundPadding;i.save(),i.fillStyle=a||SEQ.main.getBackgroundColor(),i.fillRect(l,o-SEQ.main.getLineHeightFontSmall()*n,p,SEQ.main.getLineHeightFontSmall()*r),i.restore(),i.fillText(s,c,o)}}function u(t,e,i,a,n,r,o,s,c,p,g,d,m){var u=SEQ.metrics.calcWidth(s,e),S=l(i,u),f=t.fillStyle;if(t.fillStyle=c||SEQ.main.getBackgroundColor(),t.beginPath(),t.rect(i,a,o-i,r-a),g){var h=t.fillStyle;p&&(t.fillStyle=p),t.fill(),t.fillStyle=h}t.stroke(),t.beginPath(),t.moveTo(i,a),t.lineTo(i,a+n),t.lineTo(i+2*SEQ.metrics.data.fragmentLabelSidePadding+u,a+n),t.lineTo(S,a+SEQ.metrics.data.fragmentLabelSmallHeight),t.lineTo(S,a),t.lineTo(i,a),t.fill(),t.stroke(),t.fillStyle=m||f;var y=a+n-SEQ.metrics.data.fragmentTextPosYOffset;t.fillText(s,i+SEQ.metrics.data.fragmentLabelSidePadding,y),t.fillStyle=f,E(d,S,t,p,y)}function S(t){return t.indexOf("expandable")>-1}function f(t,e,n){var r=t.fragment;if(!r.participantDataMin||!r.participantDataMax)return{main:{startX:0,endX:0,startY:0,endY:0}};if(S(t.type)&&A(t,e,n,!1))return a.TOGGLE;var o=Q(r);return t.type===i.END?{main:{startX:o.minX,endX:o.maxX,startY:t.position.posY+SEQ.metrics.data.collisionBleed/2,endY:t.position.posY-SEQ.metrics.data.collisionBleed/2}}:{main:{startX:o.minX,endX:o.maxX,startY:t.position.posY,endY:t.position.posY-t.totalHeight}}}function h(){var t=this.collision(this).main,e=[];if(S(this.type)){var a=T(this,!1);e.push({minX:a.startX,maxX:a.endX,minY:a.endY,maxY:a.startY,type:"pointer"},{minX:a.endX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"move"})}else{var n;n=this.type===i.END?"move":"pointer",e.push({minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:n})}return e}function y(){if(this.fromParticipantName){var t=this.collision(this).main,e=T(this,!0),i=[];return i.push({minX:e.startX,maxX:e.endX,minY:e.endY,maxY:e.startY,type:"pointer"},{minX:t.startX,maxX:e.endX,minY:e.startY,maxY:t.startY,type:"move"},{minX:e.endX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"move"}),i}}function Q(t){var e=SEQ.parser.diagram.participantsByName;return{minX:e[t.participantDataMin.participantName].posX-t.leftWidth-t.participantDataMin.timelineLeftWidth,maxX:e[t.participantDataMax.participantName].posX+t.rightWidth+t.participantDataMax.timelineRightWidth}}function v(t,e,i){if(S(t.type)&&A(t,e,i,!0))return a.TOGGLE;var n,r,o=p(t),s=o.fromX,c=o.toX;return c?(s<c?(n=s,r=c):(n=c,r=s),n-=SEQ.metrics.data.boxBleed,r+=SEQ.metrics.data.boxBleed):(n=s-t.totalWidth/2+SEQ.metrics.data.entryMarginSide,r=s+t.totalWidth/2-SEQ.metrics.data.entryMarginSide),{main:{startX:n,endX:r,startY:t.position.posY,endY:t.position.posY-t.totalHeight}}}function T(t,e){var i,a=t.fragment,n=SEQ.metrics.calcWidth(a.type,a.font);if(e){var r=p(t),o=r.fromX,s=r.toX;if(s)i=(s>o?o:s)-SEQ.metrics.data.boxBleed;else i=o-t.totalWidth/2+SEQ.metrics.data.entryMarginSide}else i=Q(a).minX;var c=l(i,n),g=t.position.posY-t.totalHeight;return{startX:i,endX:c,startY:g+SEQ.metrics.data.fragmentHeight,endY:g}}function A(t,e,i,a){var n=T(t,a);if(i<n.startY&&i>n.endY&&e>n.startX&&e<n.endX)return!0}return{parse:function(a,n){var r,s,c=SEQ.parser.diagram.ongoingFragments,l=t.exec(a);if(null!=l&&l.length>e.OPERATOR){var p=l[e.TEXT],E=l[e.OPERATOR],u=l[e.GROUP_LABEL];u&&(u=u.trim(),E=i.GROUP,p=l[e.GROUP_CONDITION]);var S=o(l[e.COLOR_NAME_FRAGMENT],l[e.COLOR_HEX_FRAGMENT]);S||(S=o(l[e.COLOR_NAME_FRAGMENT_GROUP],l[e.COLOR_HEX_FRAGMENT_GROUP]));var Q=o(l[e.COLOR_NAME_LABEL],l[e.COLOR_HEX_LABEL]);if(Q||(Q=o(l[e.COLOR_NAME_LABEL_GROUP],l[e.COLOR_HEX_LABEL_GROUP])),i.END!==E){if(i.ELSE===E){for(var T={},A=!1,P=c.length-1;P>=0;P--){var x=c[P];if(x.type==i.ALT){var C={position:T,totalHeight:SEQ.metrics.data.fragmentHeight,text:p};x.elseGuards.push(C),A=!0;break}}return A?{type:E,fragment:x,elseGuard:C,totalHeight:SEQ.metrics.data.fragmentHeight,topMargin:SEQ.metrics.data.entityMarginTop,position:T,raw:a,paint:d,updatePos:function(t,e){t.elseGuard.position.posY=e},collision:f,collisionTypeAreas:h}:{raw:a}}if(i.THREAD===E){for(var R={},O=!1,N=c.length-1;N>=0;N--){var M=c[N];if(M.type==i.PAR){var L={position:R,totalHeight:SEQ.metrics.data.fragmentHeight,text:p};M.threads.push(L),O=!0;break}}return O?{type:E,fragment:M,thread:L,totalHeight:SEQ.metrics.data.fragmentHeight,topMargin:SEQ.metrics.data.entityMarginTop,position:R,raw:a,paint:d,updatePos:function(t,e){t.thread.position.posY=e},collision:f,collisionTypeAreas:h}:{raw:a}}if(S){var I=SEQ.main.getMeasurementContext(),D=I.fillStyle;I.fillStyle=S;var w=function(t,e){var i=e<0?0:255,a=e<0?-1*e:e,n=parseInt(t[0]),r=parseInt(t[1]),o=parseInt(t[2]);return"rgb("+(Math.round((i-n)*a)+n)+","+(Math.round((i-r)*a)+r)+","+(Math.round((i-o)*a)+o)+")"}((r=I.fillStyle,[(16711680&(s=parseInt(r.substring(1),16)))>>16,(65280&s)>>8,255&s]),.8);I.fillStyle=D}for(var F={},_={type:E,groupLabel:u,text:p,colorFragment:S,colorLabel:Q,backgroundColor:w,font:"bold "+SEQ.main.getFontSmall(),enclosedEntitiesData:[],subFragments:[],elseGuards:[],threads:[],lineNumber:n,leftWidth:0,rightWidth:0,topMargin:SEQ.metrics.data.entityMarginTop,startPosition:F,totalHeight:SEQ.metrics.data.fragmentHeight,raw:a},W=0;W<c.length;W++)c[W].subFragments.push(_);if(c.push(_),i.EXPANDABLE_PLUS===E){p||(p="");var B=SEQ.textUtil.parseTextData(p),b={type:E,fragment:_,textData:B,totalHeight:B.height+2*SEQ.metrics.data.textPadding+SEQ.metrics.data.fragmentHeight,topMargin:SEQ.metrics.data.entityMarginTop,position:F,raw:a,collision:v,collisionTypeAreas:y,paint:g};return _.startEntry=b,b}return{type:E,fragment:_,totalHeight:_.totalHeight,topMargin:_.topMargin,position:F,raw:a,paint:d,paintLayer2:m,updatePos:function(t,e){t.fragment.startPosition.posY=e},collision:f,collisionTypeAreas:h}}if(c.length>0){var X=c.pop();SEQ.parser.diagram.fragments.push(X);var Y={};return X.endPosition=Y,X.type===SEQ.entityFragment.Type.EXPANDABLE_PLUS?{type:E,fragment:X,totalHeight:0,topMargin:0,position:Y,raw:a}:{type:E,fragment:X,totalHeight:0,topMargin:SEQ.metrics.data.entityMarginTop,position:Y,raw:a,paint:d,updatePos:function(t,e){t.fragment.endPosition.posY=e},collision:f,collisionTypeAreas:h}}}},paint:d,regExp:t,build:function(t,e){var a=t+" "+e;return i.ELSE!=t&&i.THREAD!=t&&(a+="\nend"),a},storeEnclosedEntriesData:function(t,e,i,a,n,r){for(var o=0;o<r.length;o++){var s=r[o],c=l(t);c?(e>c.entityLeftWidth&&(c.entityLeftWidth=e),i>c.entityRightWidth&&(c.entityRightWidth=i),a>c.timelineLeftWidth&&(c.timelineLeftWidth=a),n>c.timelineRightWidth&&(c.timelineRightWidth=n)):s.enclosedEntitiesData.push({participantName:t,entityLeftWidth:e,entityRightWidth:i,timelineLeftWidth:a,timelineRightWidth:n})}function l(t){for(var e=0;e<s.enclosedEntitiesData.length;e++){var i=s.enclosedEntitiesData[e];if(t==i.participantName)return i}}},updateParticipantWidths:function(){for(var t=function(){for(var t=SEQ.parser.diagram.participants,e=[],i=0;i<t.length;i++)e[t[i].name]=i;return e}(),e=SEQ.parser.diagram.fragments,i=0;i<e.length;i++){for(var a=e[i],n=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,o=null,l=null,p=0;p<a.enclosedEntitiesData.length;p++){var g=a.enclosedEntitiesData[p],d=t[g.participantName];d<n&&(n=d,o=g),d>r&&(r=d,l=g)}if(!o){var m=SEQ.parser.diagram.participants[0];o={participantName:m.name,entityLeftWidth:m.entityLeftWidth,entityRightWidth:m.entityRightWidth,timelineLeftWidth:m.timelineLeftWidth,timelineRightWidth:m.timelineRightWidth}}if(!l){var E=SEQ.parser.diagram.participants[SEQ.parser.diagram.participants.length-1];l={participantName:E.name,entityLeftWidth:E.entityLeftWidth,entityRightWidth:E.entityRightWidth,timelineLeftWidth:m.timelineLeftWidth,timelineRightWidth:m.timelineRightWidth}}if(a.participantDataMin=o,a.participantDataMax=l,a.type===SEQ.entityFragment.Type.EXPANDABLE_PLUS){var u=a.startEntry.textData.width,S=SEQ.metrics.calcWidth(a.type,a.font);S>u&&(u=S),o.participantName!=l.participantName?(a.startEntry.totalWidth=u+2*SEQ.metrics.data.textPadding,a.startEntry.fromParticipantName=o.participantName,a.startEntry.toParticipantName=l.participantName):(a.startEntry.totalWidth=u+2*SEQ.metrics.data.textPadding+2*SEQ.metrics.data.boxBleed+2*SEQ.metrics.data.entryMarginSide,a.startEntry.fromParticipantName=o.participantName),s(a.startEntry)}var f=c(a.subFragments,o,l),h=SEQ.metrics.data.fragmentBleed,y=SEQ.metrics.data.fragmentBleed;SEQ.entityParticipant.isSpecialParticipantLeftName(o.participantName)&&(h=0);var Q=Math.max(h,o.entityLeftWidth);f.leftWidth>Q&&(Q=f.leftWidth),SEQ.entityParticipant.isSpecialParticipantRightName(l.participantName)&&(y=0);var v=Math.max(y,l.entityRightWidth);f.rightWidth>v&&(v=f.rightWidth),a.leftWidth=Q,a.rightWidth=v;var T=SEQ.parser.diagram.participantsByName[o.participantName],A=SEQ.parser.diagram.participantsByName[l.participantName];SEQ.entityParticipant.updateParticipantEntityWidths(T,Q+SEQ.metrics.data.fragmentMarginSide,0),SEQ.entityParticipant.updateParticipantEntityWidths(A,0,v+SEQ.metrics.data.fragmentMarginSide)}},populateEnclosingCollapsedFragment:function(t){for(var e=SEQ.parser.diagram.ongoingFragments,i=0;i<e.length;i++){var a=e[i];a.type===SEQ.entityFragment.Type.EXPANDABLE_PLUS&&t.fragment!=a&&(t.enclosingCollapsedFragment=a)}},isOngoingCollapsedFragment:function(){for(var t=SEQ.parser.diagram.ongoingFragments,e=0;e<t.length;e++)if(t[e].type===SEQ.entityFragment.Type.EXPANDABLE_PLUS)return!0;return!1},collision:f,insideFragmentType:function(t,e){for(var i=SEQ.parser.diagram.fragments,a=0;a<i.length;a++){var n=i[a];if(e==n.type){var r=Q(n);if(t.y>n.startPosition.posY-n.totalHeight&&t.y<n.endPosition.posY+n.topMargin&&t.x>r.minX&&t.x<r.maxX)return!0}}},paintFragment:u,isType:function(e){return null!=t.exec(e)||e===i.GROUP},Type:i,CollisionType:a,groups:e}}(),(SEQ=SEQ||{}).entityEntrySpacing=function(){var t=new RegExp("^\\s{0,100}(entryspacing)\\s?([0-9]{1,2}(?:\\.[0-9]{1})?)$"),e={ENTRY_SPACING:1,SPACING:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.SPACING){var n=a[e.SPACING];return{raw:i,entrySpacing:parseFloat(n)}}},build:function(t){return t<0&&(t=0),"entryspacing "+t.toFixed(1)},regExp:t,groups:e,Type:{ENTRY_SPACING:"entryspacing"}}}(),(SEQ=SEQ||{}).entityParticipantSpacing=function(){var t=new RegExp("^\\s{0,100}(participantspacing)\\s?([0-9]{1,2}(?:\\.[0-9]{1})?|equal)$"),e={PARTICIPANT_SPACING:1,SPACING:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.SPACING)return{raw:i,participantSpacing:a[e.SPACING]}},equal:"equal",regExp:t,groups:e,Type:{PARTICIPANT_SPACING:"participantspacing"}}}(),(SEQ=SEQ||{}).entityParallel=function(){var t=new RegExp("^\\s{0,100}(parallel)\\s?(on|off|end)?$"),e={PARALLEL:1,STATUS:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.STATUS){var n=a[e.STATUS];if("on"===n)var r=!0;else r="off"!==n&&"end"!==n;return{raw:i,enabled:r,parallelEnabled:r}}},regExp:t,groups:e,Type:{PARALLEL:"parallel"}}}(),(SEQ=SEQ||{}).entityActivation=function(){var t=new RegExp("^\\s{0,100}(activate|deactivate|deactivateafter)\\s"+SEQ.entityParticipant.nameGroup+"\\s?"+SEQ.entityParticipant.colorGroup+"$"),e={TYPE:1,PARTICIPANT:2,COLOR_NAME:3,COLOR_HEX:4},i={ACTIVATE:"activate",DEACTIVATE:"deactivate",DEACTIVATE_AFTER:"deactivateafter"};function a(t,e){var a,n=SEQ.parser.diagram.participantsByName[t.fromParticipantName].posX+t.centerDiff;t.deactivate?(a=t.deactivate.position.posY,i.DEACTIVATE_AFTER===t.deactivate.type&&(a+=SEQ.metrics.data.activationAfterHeight)):a=SEQ.parser.diagram.entries[SEQ.parser.diagram.entries.length-1].position.posY+SEQ.metrics.data.diagramMarginBottom-SEQ.metrics.data.baseSpaceMetric;var r=SEQ.metrics.data.activationSideWidth,o=t.position.posY;e.beginPath(),e.moveTo(n-r,o),e.lineTo(n+r,o),e.lineTo(n+r,a),e.lineTo(n-r,a),e.lineTo(n-r,o);var s=e.fillStyle;t.color?e.fillStyle=t.color:e.fillStyle=SEQ.main.getBackgroundColor(),e.fill(),e.stroke(),e.fillStyle=s}function n(t){var e=SEQ.parser.diagram.ongoingActivations[t];return e?0===e.length?0:e.length>=1?e.length*SEQ.metrics.data.activationSideWidth:void 0:0}function r(t){return t<=1?0:(t-1)*SEQ.metrics.data.activationSideWidth}return{parse:function(o){var s=t.exec(o);if(null!=s&&s.length>e.PARTICIPANT){var c=s[e.TYPE],l=s[e.PARTICIPANT],p=s[e.COLOR_NAME],g=s[e.COLOR_HEX],d=p||g,m=SEQ.parser.diagram.ongoingActivations[l];if(c.indexOf(i.DEACTIVATE)>-1){if(m&&m.length){var E={type:c,fromParticipantName:l,totalHeight:0,totalWidth:0,topMargin:0,position:{},activation:!0,raw:o};return m.pop().deactivate=E,E}}else if(c.indexOf(i.ACTIVATE)>-1){m||(SEQ.parser.diagram.ongoingActivations[l]=[],m=SEQ.parser.diagram.ongoingActivations[l]);var u={type:c,fromParticipantName:l,centerDiff:n(l),totalHeight:0,totalWidth:0,topMargin:0,position:{},color:d,activation:!0,raw:o,paint:a};if(m.push(u),SEQ.entityParticipant.storeParticipantWithTimelineWidths(null,l,SEQ.metrics.data.activationSideWidth,r(m.length)+SEQ.metrics.data.activationSideWidth),!u.color){var S=SEQ.parser.diagram.participantsByName[l];u.color=S.activeColor?S.activeColor:SEQ.parser.diagram.participantActiveColor}return u}}},paint:a,build:function(t,e){return t+" "+e},calcActivationCenterDiff:r,isType:function(t){return i.ACTIVATE===t||i.DEACTIVATE===t||i.DEACTIVATE_AFTER===t},activate:function(t){var e=SEQ.parser.diagram.ongoingActivations[t];e||(SEQ.parser.diagram.ongoingActivations[t]=[],e=SEQ.parser.diagram.ongoingActivations[t]);var o=SEQ.parser.diagram.participantsByName[t],s={type:i.ACTIVATE,fromParticipantName:t,centerDiff:n(t),totalHeight:0,totalWidth:0,topMargin:0,position:{},activation:!0,color:o.activeColor?o.activeColor:SEQ.parser.diagram.participantActiveColor,paint:a};e.push(s),SEQ.entityParticipant.storeParticipantWithTimelineWidths(null,t,SEQ.metrics.data.activationSideWidth,r(e.length)+SEQ.metrics.data.activationSideWidth),SEQ.parser.storeEntry(s)},deactivate:function(t){var e=SEQ.parser.diagram.ongoingActivations[t];if(e&&e.length){var a=e.pop();a.deactivate={type:i.DEACTIVATE,fromParticipantName:t,totalHeight:0,totalWidth:0,topMargin:0,position:{},activation:!0},SEQ.parser.storeEntry(a.deactivate)}},Type:i,regExp:t,groups:e}}(),(SEQ=SEQ||{}).entitySpace=function(){var t=new RegExp("^\\s{0,100}(space)\\s?(\\-?[0-9]{1,2}(?:\\.[0-9]{1})?)?$"),e={SPACE:1,VALUE:2},i={SPACE:"space"};function a(t,e){t.position.posY=e}function n(t,e,i,a){if(i||a){var n=r(t).main;e.beginPath(),e.moveTo(n.startX,n.endY),e.lineTo(n.endX,n.endY),e.lineTo(n.endX,n.startY),e.lineTo(n.startX,n.startY),e.lineTo(n.startX,n.endY),e.stroke()}}function r(t){var e=SEQ.parser.diagram.participants,i=e[e.length-1],a=SEQ.metrics.data.entryMarginSide,n=i.width>i.entityRightWidth-SEQ.metrics.data.entryMarginSide?i.width/2:i.entityRightWidth-SEQ.metrics.data.entryMarginSide;return{main:{startX:a,endX:i.posX+i.timelineRightWidth+n,startY:t.position.posY,endY:t.position.posY-t.totalHeight}}}function o(){var t=this.collision(this).main,e=[];return t.startY>t.endY&&e.push({minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"move"}),e}return{parse:function(s){var c=t.exec(s);if(null!=c&&c.length>=e.VALUE){var l=c[e.VALUE];return l||(l=1),{type:i.SPACE,totalHeight:SEQ.metrics.data.baseSpaceMetric*l,topMargin:SEQ.metrics.data.entityMarginTop,position:{},paint:n,collision:r,collisionTypeAreas:o,updatePos:a,raw:s}}},build:function(t){return t},isType:function(t){return i.SPACE===t},Type:i,regExp:t,groups:e}}(),(SEQ=SEQ||{}).entityCreateDestroy=function(){var t=new RegExp("^\\s{0,100}(create|destroy|destroyafter|destroysilent)\\s"+SEQ.entityParticipant.nameGroup+"$"),e={TYPE:1,PARTICIPANT:2},i={CREATE:"create",DESTROY:"destroy",DESTROY_AFTER:"destroyafter",DESTROY_SILENT:"destroysilent"};function a(t){var e=t.totalWidth/2+SEQ.metrics.data.entryMarginSide;SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,e,e,0,0,t.snapshot.ongoingFragments)}function n(t,e,i){t.position.posY=e,t.fromPosX=i}function r(t){var e=t.totalWidth/2;SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,t.fromParticipantName,e,e)}function o(t){var e=t.totalWidth/2;SEQ.entityFragment.storeEnclosedEntriesData(t.fromParticipantName,e,e,0,0,t.snapshot.ongoingFragments)}function s(t){return{fromPosX:SEQ.parser.diagram.participantsByName[t.fromParticipantName].posX}}function c(t,e){SEQ.entityParticipant.paintParticipant(t.participantToCreate,e,t.position.posY-SEQ.parser.diagram.participantMaxHeight)}function l(t,e){if(-1===t.type.indexOf("silent")){var a=s(t).fromPosX,n=t.position.posY;t.type===i.DESTROY_AFTER&&(n-=SEQ.metrics.data.participantDestroySize/2),e.save(),e.lineWidth=SEQ.metrics.data.participantDestroyLineWeight,e.beginPath();var r=SEQ.metrics.data.participantDestroySize/2;e.moveTo(a-r,n-r),e.lineTo(a+r,n+r),e.moveTo(a+r,n-r),e.lineTo(a-r,n+r),e.stroke(),e.restore()}}function p(t){var e=s(t).fromPosX;return{participantToCreate:{startX:e-t.participantToCreate.width/2,endX:e+t.participantToCreate.width/2,startY:t.position.posY,endY:t.position.posY-t.totalHeight}}}function g(t){var e,a,n=s(t).fromPosX,r=SEQ.metrics.data.participantDestroySize/2;return t.type===i.DESTROY_AFTER?(e=t.position.posY,a=t.position.posY-SEQ.metrics.data.participantDestroySize):(e=t.position.posY+r,a=t.position.posY-r),{main:{startX:n-t.totalWidth/2,endX:n+t.totalWidth/2,startY:e,endY:a}}}function d(){var t=this.collision(this).participantToCreate,e=[];return e.push({minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"move"}),e}function m(){var t=this.collision(this).main,e=[];return e.push({minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"move"}),e}return{parse:function(s){var E=t.exec(s);if(null!=E&&E.length>e.PARTICIPANT){var u=E[e.TYPE],S=E[e.PARTICIPANT];if(u===i.CREATE){var f=SEQ.parser.diagram.participantsByName[S];f||(SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,S),f=SEQ.parser.diagram.participantsByName[S]);var h={};return f.createPositions.push(h),{type:i.CREATE,fromParticipantName:S,participantToCreate:f,totalHeight:f.height,totalWidth:f.width,topMargin:SEQ.metrics.data.entityMarginTop,position:h,lockedPosX:!0,updateEnclosingFragments:a,paint:c,updatePos:n,collision:p,collisionTypeAreas:d,raw:s}}if(u===i.DESTROY||u===i.DESTROY_SILENT){var y=SEQ.parser.diagram.participantsByName[S];y||(y=SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,S));var Q={};return y.destroyPositions.push(Q),{type:u,fromParticipantName:S,participantToDestroy:y,totalHeight:0,totalWidth:SEQ.metrics.data.participantDestroySize,topMargin:0,position:Q,lockedPosX:!0,paint:l,updatePos:n,collision:g,collisionTypeAreas:m,updateEnclosingFragments:o,updateParticipantWidths:r,raw:s}}if(u===i.DESTROY_AFTER){var v=SEQ.parser.diagram.participantsByName[S];if(v){var T=SEQ.metrics.data.participantDestroySize,A={lifeLinePosYDiff:SEQ.metrics.data.participantDestroySize/2};return v.destroyPositions.push(A),{type:u,fromParticipantName:S,participantToDestroy:v,totalHeight:T,totalWidth:SEQ.metrics.data.participantDestroySize,topMargin:SEQ.metrics.data.entityMarginTop,position:A,lockedPosX:!0,paint:l,updatePos:n,collision:g,collisionTypeAreas:m,updateEnclosingFragments:o,updateParticipantWidths:r,raw:s}}}}},paint:l,createdParticipant:function(a){var n=t.exec(a);if(null!=n&&n.length>e.PARTICIPANT&&n[e.TYPE]===i.CREATE)return n[e.PARTICIPANT]},Type:i,regExp:t,groups:e}}(),(SEQ=SEQ||{}).entityActiveColor=function(){var t=new RegExp("^\\s{0,100}(activecolor)\\s"+SEQ.entityParticipant.nameGroup+"?\\s?"+SEQ.entityParticipant.colorGroupMandatory+"$"),e={ACTIVE_COLOR:1,PARTICIPANT:2,COLOR_NAME:3,COLOR_HEX:4};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.COLOR_NAME){var n=a[e.PARTICIPANT],r=a[e.COLOR_NAME],o=a[e.COLOR_HEX],s=r||o;if(n){var c=SEQ.parser.diagram.participantsByName[n];return c||(c=SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,n)),c.activeColor=s,{raw:i}}return SEQ.parser.diagram.participantActiveColor=s,{raw:i}}},regExp:t,groups:e,Type:{ACTIVE_COLOR:"activecolor"}}}(),(SEQ=SEQ||{}).entityLifeLineStyle=function(){var t=new RegExp("^\\s{0,100}(lifelinestyle)\\s"+SEQ.entityParticipant.nameGroup+"?\\s?"+SEQ.entityParticipant.colorGroup+SEQ.entityMessage.lineWeightGroup+"(?:::?(solid|dashed))?$"),e={LIFE_LINE_COLOR:1,PARTICIPANT:2,COLOR_NAME:3,COLOR_HEX:4,WEIGHT:5,STYLE:6};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.STYLE){var n=a[e.PARTICIPANT],r=a[e.COLOR_NAME],o=a[e.COLOR_HEX],s=r||o,c=a[e.WEIGHT],l=a[e.STYLE];if(n){var p=SEQ.parser.diagram.participantsByName[n];return p||(p=SEQ.entityParticipant.storeParticipantWithDefinedWidths(null,n)),p.lifeLineColor=s,p.lifeLineWeight=c,p.lifeLineStyle=l,{raw:i}}return SEQ.parser.diagram.participantLifeLineColor=s,SEQ.parser.diagram.participantLifeLineWeight=c,SEQ.parser.diagram.participantLifeLineStyle=l,{raw:i}}},regExp:t,groups:e,Type:{LIFE_LINE_COLOR:"lifelinestyle"}}}(),(SEQ=SEQ||{}).entityBottomParticipants=function(){var t=new RegExp("^\\s{0,100}(bottomparticipants)\\s?$"),e={BOTTOM_PARTICIPANTS:1};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.BOTTOM_PARTICIPANTS)return SEQ.parser.diagram.bottomParticipants=!0,{raw:i}},regExp:t,groups:e,Type:{BOTTOM_PARTICIPANTS:"bottomparticipants"}}}(),(SEQ=SEQ||{}).entityParticipantGroup=function(){var t=new RegExp("^\\s{0,100}(participantgroup)"+SEQ.entityParticipant.colorGroup+SEQ.entityParticipant.colorGroup+"(?:\\s?:([0-9]{1}(?:\\.[0-9]{1})?))?(?:$|\\s(.{0,500}))|^\\s{0,100}(end)$"),e={PARTICIPANT_GROUP:1,COLOR_HEX:2,COLOR_NAME:3,LINE_COLOR_HEX:4,LINE_COLOR_NAME:5,LINE_WEIGHT:6,TITLE:7,END:8},i={PARTICIPANT_GROUP:"participantgroup",END:"end"};function a(t,e,i){if(t.participantGroup.ended){var a,n,r=i.height,o=0;t.participantGroup.enclosedParticipants.forEach(function(t){(!a||t.posX<a.posX)&&(a=t),(!n||t.posX>n.posX)&&(n=t),t.height>o&&(o=t.height)}),e.save(),e.beginPath();var s=a.posX-a.width/2-t.participantGroup.outerLeftWidth,c=n.posX+n.width/2+t.participantGroup.outerRightWidth,l=SEQ.metrics.data.participantMarginTop;SEQ.parser.diagram.title&&(l+=SEQ.parser.diagram.title.totalHeight),SEQ.parser.diagram.frame&&(l+=SEQ.parser.diagram.frame.totalHeight),l+=SEQ.metrics.data.participantTypeLineWeight/2,l+=SEQ.parser.diagram.maxParticipantGroupHeight,l-=t.participantGroup.calcHeight(),l+=SEQ.parser.diagram.participantMaxHeight-o;var p=r;SEQ.parser.diagram.frame&&(p-=SEQ.metrics.data.frameMargin+SEQ.metrics.data.frameMarginCanvas),e.rect(s,l,c-s,p-l);var g=e.fillStyle;if(t.participantGroup.color&&(e.fillStyle=t.participantGroup.color,e.fill()),t.participantGroup.lineWeight?e.lineWidth=SEQ.main.getLineWeightParticipantGroup(t.participantGroup.lineWeight):e.lineWidth=SEQ.metrics.data.participantGroupLineWeight,t.participantGroup.lineColor&&(e.strokeStyle=t.participantGroup.lineColor),0!=t.participantGroup.lineWeight&&e.stroke(),e.fillStyle=g,e.restore(),t.participantGroup.textData){var d=(s+c)/2-t.participantGroup.textData.width/2,m=l+SEQ.metrics.data.participantGroupPadding;SEQ.textUtil.fillText(e,!1,t.participantGroup.textData.parsedLines,d,s+SEQ.metrics.data.textPadding,c-SEQ.metrics.data.textPadding,m)}}}return{parse:function(n){var r=t.exec(n);if(null!=r&&r.length>e.PARTICIPANT_GROUP){var o=r[e.PARTICIPANT_GROUP]?r[e.PARTICIPANT_GROUP]:r[e.END],s=SEQ.parser.diagram.ongoingParticipantGroups;if(i.END===o){if(s.length>0){var c=s.pop(),l=c.enclosedParticipants[0],p=c.enclosedParticipants[c.enclosedParticipants.length-1];if(l&&p)return SEQ.entityParticipant.updateParticipantOuterWidths(l,SEQ.metrics.data.participantMarginSide,0),SEQ.entityParticipant.updateParticipantOuterWidths(p,0,SEQ.metrics.data.participantMarginSide),c.ended=!0,c.outerLeftWidth=l.outerLeftWidth,c.outerRightWidth=p.outerRightWidth,SEQ.parser.diagram.participantGroups.push(c),{type:o,participantGroup:c,totalHeight:0,totalWidth:0,topMargin:0,position:{},raw:n}}}else if(i.PARTICIPANT_GROUP===o){var g=r[e.COLOR_NAME]?r[e.COLOR_NAME]:r[e.COLOR_HEX],d=r[e.LINE_COLOR_NAME]?r[e.LINE_COLOR_NAME]:r[e.LINE_COLOR_HEX],m=r[e.LINE_WEIGHT];if(r[e.TITLE])var E=SEQ.textUtil.parseTextData(r[e.TITLE]);var u=SEQ.metrics.data.participantGroupPadding;E&&(u+=E.height+SEQ.metrics.data.participantGroupPadding);var S={textData:E,height:u,color:g,lineColor:d,lineWeight:m,enclosedParticipants:[],enclosedParticipantGroups:[],raw:n,calcHeight:function(){var t=0;return this.enclosedParticipantGroups.forEach(function(e){var i=e.calcHeight();i>t&&(t=i)}),this.height+t}};return s.forEach(function(t){t.enclosedParticipantGroups.push(S)}),s.push(S),{type:o,participantGroup:S,totalHeight:0,totalWidth:0,topMargin:0,position:{},raw:n,paintLayer1:a}}}},paintLayer1:a,regExp:t,build:function(t,e){var a=t+" "+e;return i.ELSE!=t&&(a+="\nend"),a},isType:function(e){return null!=t.exec(e)},Type:i,groups:e}}(),(SEQ=SEQ||{}).entityFrame=function(){var t=new RegExp("^\\s{0,100}(frame)"+SEQ.entityParticipant.colorGroup+SEQ.entityParticipant.colorGroup+"\\s(.{0,500})$"),e={FRAME:1,COLOR_HEX_FRAGMENT:2,COLOR_NAME_FRAGMENT:3,COLOR_HEX_LABEL:4,COLOR_NAME_LABEL:5,TEXT:6},i={FRAME:"frame"};function a(t,e){return e+i.FRAME+" "+t}function n(t,e){return t||e}function r(t,e,i){if(t.backgroundColor){var a=e.fillStyle;e.fillStyle=t.backgroundColor;var n=SEQ.metrics.data.frameMarginCanvas;e.fillRect(n,n,i.width-2*n,i.height-2*n),e.fillStyle=a}}function o(t,e,i,a,n){var r=SEQ.metrics.data.frameMarginCanvas;e.save();var o=SEQ.metrics.calcWidth("sd ",t.sdFont),s=o+SEQ.metrics.calcWidth(t.text,t.nameFont),c=r+2*SEQ.metrics.data.frameLabelSidePadding+s+SEQ.metrics.data.frameLabelEdgeLength,l=e.fillStyle;t.colorFragment?e.fillStyle=t.colorFragment:e.fillStyle=SEQ.main.getBackgroundColor(),e.beginPath(),e.rect(r,r,n.width-2*r,n.height-2*r),e.stroke(),e.beginPath(),e.moveTo(r,r),e.lineTo(r,r+t.labelHeight),e.lineTo(r+2*SEQ.metrics.data.frameLabelSidePadding+s,r+t.labelHeight),e.lineTo(c,r+SEQ.metrics.data.frameLabelSmallHeight),e.lineTo(c,r),e.lineTo(r,r),e.fill(),e.stroke(),t.colorLabel?e.fillStyle=t.colorLabel:e.fillStyle=l,e.font=t.sdFont;var p=r+SEQ.metrics.data.frameLabelSidePadding,g=r+t.labelHeight-SEQ.metrics.data.frameTextPosYOffset;e.fillText("sd",p,g),e.font=t.nameFont,e.fillText(t.text,p+o,g),e.fillStyle=l,e.restore()}function s(){return{main:{startX:0,endX:Number.MAX_VALUE,startY:SEQ.metrics.data.frameMarginCanvas+this.labelHeight,endY:SEQ.metrics.data.frameMarginCanvas}}}function c(){var t=this.collision().main,e=[];return e.push({minX:t.startX,maxX:t.endX,minY:t.endY,maxY:t.startY,type:"pointer"}),e}return{parse:function(l){var p,g,d=t.exec(l);if(null!=d&&d.length>e.TEXT){var m=n(d[e.COLOR_NAME_FRAGMENT],d[e.COLOR_HEX_FRAGMENT]);m||(m=n(d[e.COLOR_NAME_FRAGMENT_GROUP],d[e.COLOR_HEX_FRAGMENT_GROUP]));var E=n(d[e.COLOR_NAME_LABEL],d[e.COLOR_HEX_LABEL]);if(E||(E=n(d[e.COLOR_NAME_LABEL_GROUP],d[e.COLOR_HEX_LABEL_GROUP])),m){var u=SEQ.main.getMeasurementContext(),S=u.fillStyle;u.fillStyle=m;var f=function(t,e){var i=e<0?0:255,a=e<0?-1*e:e,n=parseInt(t[0]),r=parseInt(t[1]),o=parseInt(t[2]);return"rgb("+(Math.round((i-n)*a)+n)+","+(Math.round((i-r)*a)+r)+","+(Math.round((i-o)*a)+o)+")"}((p=u.fillStyle,[(16711680&(g=parseInt(p.substring(1),16)))>>16,(65280&g)>>8,255&g]),.8);u.fillStyle=S}return{type:i.FRAME,text:d[e.TEXT],colorFragment:m,colorLabel:E,backgroundColor:f,sdFont:"bold "+SEQ.main.getFontNormal(),nameFont:SEQ.main.getFontNormal(),topMargin:0,totalHeight:SEQ.metrics.data.frameHeight+SEQ.metrics.data.frameMargin,labelHeight:SEQ.metrics.data.frameHeight,position:{},paint:o,paintLayer0:r,collision:s,collisionTypeAreas:c,build:a,raw:l}}},paint:o,isType:function(t){return t===i.FRAME},Type:i,regExp:t,groups:e}}(),(SEQ=SEQ||{}).entityAutoActivation=function(){var t=new RegExp("^\\s{0,100}(autoactivation)\\s?(on|off)?$"),e={AUTO_ACTIVATION:1,STATUS:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.STATUS){var n=a[e.STATUS];if("on"===n)var r=!0;else r="off"!==n&&(isNaN(n),!0);return{raw:i,enabled:r}}},regExp:t,groups:e,Type:{AUTO_ACTIVATION:"autoactivation"}}}(),(SEQ=SEQ||{}).entityStyle=function(){var t=new RegExp("^\\s{0,100}(participantstyle|notestyle|messagestyle|dividerstyle|boxstyle|aboxstyle|rboxstyle|aboxrightstyle|aboxleftstyle)\\s((?:"+SEQ.textUtil.textStyleRegExpStr+"){1,500})$"),e={ENTITY:1,TEXT_STYLE:2};return{parse:function(i){var a=t.exec(i);if(null!=a&&a.length>e.TEXT_STYLE)return{entityTypeStyle:a[e.ENTITY],style:{text:a[e.TEXT_STYLE]},raw:i}},regExp:t,groups:e,Type:{PARTICIPANT_STYLE:"participantstyle",NOTE_STYLE:"notestyle",MESSAGE_STYLE:"messagestyle",DIVIDER_STYLE:"dividerstyle",BOX_STYLE:"boxstyle",A_BOX_STYLE:"aboxstyle",R_BOX_STYLE:"rboxstyle",A_BOX_RIGHT_STYLE:"aboxrightstyle",A_BOX_LEFT_STYLE:"aboxleftstyle"},lookUpStyle:function(t){var e=SEQ.parser.diagram.entityStyles[t+"style"];return e||{}}}}(),(SEQ=SEQ||{}).painter=function(){return{paint:function(){var t=SEQ.parser.diagram,e=SEQ.metrics.getCanvasSize();!function(t){var e=t.width,i=t.height;SEQ.parser.diagram.participantGroups.length&&!SEQ.parser.diagram.frame&&(i+=SEQ.metrics.data.participantGroupPadding);var a=t.heightParticipant;SEQ.main.getDiagramCanvas(e,i);var n=SEQ.main.getDiagramContext();if(n.font=SEQ.main.getFontNormal(),n.lineWidth=SEQ.metrics.data.diagramLineWeight,n.fillStyle=SEQ.main.getForegroundColor(),n.strokeStyle=SEQ.main.getForegroundColor(),!SEQ.main.isRunningNode()){var r=SEQ.main.getInteractionCanvas();if(r){r.width=e,r.height=i;var o=SEQ.main.getInteractionContext();o.font=SEQ.main.getFontNormal(),o.lineWidth=SEQ.metrics.data.diagramLineWeight,o.fillStyle=SEQ.main.getForegroundColor(),o.strokeStyle=SEQ.main.getForegroundColor()}var s=SEQ.main.getParticipantCanvas();if(s){s.width=e,s.height=a;var c=SEQ.main.getParticipantContext();c.font=SEQ.main.getFontNormal(),c.lineWidth=SEQ.metrics.data.diagramLineWeight,c.fillStyle=SEQ.main.getForegroundColor(),c.strokeStyle=SEQ.main.getForegroundColor()}var l=document.getElementById("scrollBox");if(l){var p=l.style;p.width=e+"px",p.height=i+"px"}}}(e);var i=SEQ.main.getDiagramContext();i.save(),i.fillStyle=SEQ.main.getBackgroundColor();var a=SEQ.main.getDiagramCanvas();if(i.fillRect(0,0,a.width,a.height),i.restore(),t.participants.length>0){if(i.save(),function(t){var e=SEQ.parser.diagram,i=SEQ.main.getDiagramContext(),a=[],n=[],r=[];e.entries.forEach(function(t){t.enclosingCollapsedFragment||(t.paintLayer0&&a.push(t),t.paintLayer1&&n.push(t),t.paintLayer2&&r.push(t))}),a.forEach(function(e){e.paintLayer0(e,i,t)}),n.forEach(function(e){e.paintLayer1(e,i,t)}),r.forEach(function(e){e.paintLayer2(e,i,t)})}(e),i.restore(),i.save(),function(t,e){var i=SEQ.parser.diagram;i.participants.forEach(function(a){if(!SEQ.entityParticipant.isSpecialParticipantName(a.name)){var n,r;a.lifeLineWeight?e.lineWidth=SEQ.metrics.data.diagramLifeLineWeight*a.lifeLineWeight:i.participantLifeLineWeight?e.lineWidth=SEQ.metrics.data.diagramLifeLineWeight*i.participantLifeLineWeight:e.lineWidth=SEQ.metrics.data.diagramLifeLineWeight,a.lifeLineColor?e.strokeStyle=a.lifeLineColor:i.participantLifeLineColor?e.strokeStyle=i.participantLifeLineColor:e.strokeStyle=SEQ.main.getForegroundColor(),void 0!==e.setLineDash&&(a.lifeLineStyle?c(a.lifeLineStyle):i.participantLifeLineStyle?c(i.participantLifeLineStyle):e.setLineDash([SEQ.metrics.data.diagramLifeLineDashSize,SEQ.metrics.data.diagramLifeLineSpaceSize]));var o=a.destroyPositions.slice();if(a.createPositions.length)a.createPositions.forEach(function(s){if(n=s.posY,o.length){var c=o.shift();r=c.posY,c.lifeLinePosYDiff&&(r-=c.lifeLinePosYDiff)}else r=t.height,i.bottomParticipants&&(r-=t.heightBottomParticipant),i.frame&&(r-=SEQ.metrics.data.frameMargin+SEQ.metrics.data.frameMarginCanvas);e.beginPath(),e.moveTo(a.posX,n),e.lineTo(a.posX,r),e.stroke()});else{if(n=SEQ.metrics.data.participantMarginTop+i.participantMaxHeight,i.title&&(n+=SEQ.parser.diagram.title.totalHeight),i.frame&&(n+=SEQ.parser.diagram.frame.totalHeight),n+=SEQ.parser.diagram.maxParticipantGroupHeight,a.destroyPositions.length){var s=a.destroyPositions.pop();r=s.posY,s.lifeLinePosYDiff&&(r-=s.lifeLinePosYDiff)}else r=t.height,i.bottomParticipants&&(r-=t.heightBottomParticipant),i.frame&&(r-=SEQ.metrics.data.frameMargin+SEQ.metrics.data.frameMarginCanvas);e.beginPath(),e.moveTo(a.posX,n),e.lineTo(a.posX,r),e.stroke()}}function c(t){"solid"==t?e.setLineDash([]):"dashed"==t&&e.setLineDash([SEQ.metrics.data.diagramLifeLineDashSize,SEQ.metrics.data.diagramLifeLineSpaceSize])}})}(e,i),i.restore(),i.save(),function(){var t=SEQ.parser.diagram,e=SEQ.main.getDiagramContext();if(t.participants.forEach(function(t){SEQ.entityParticipant.paint(t,e)}),t.bottomParticipants){var i=SEQ.metrics.getCanvasSize();t.participants.forEach(function(a){var n=i.height-i.heightBottomParticipant;t.frame&&(n-=SEQ.metrics.data.frameMargin+SEQ.metrics.data.frameMarginCanvas),SEQ.entityParticipant.paint(a,e,null,null,n)})}}(),i.restore(),i.save(),function(t){var e=SEQ.parser.diagram,i=SEQ.main.getDiagramContext(),a=[],n=[],r=[];e.entries.forEach(function(t){t.paint&&!t.enclosingCollapsedFragment&&(t.fragment?r.push(t):t.activation?a.push(t):n.push(t))}),a.forEach(function(e){e.paint(e,i,!1,!1,t)}),n.forEach(function(e){e.paint(e,i,!1,!1,t)}),r.forEach(function(e){e.paint(e,i,!1,!1,t)})}(e),i.restore(),!SEQ.main.isRunningNode()){var n=SEQ.main.getParticipantContext();n&&t.participants.forEach(function(t){SEQ.entityParticipant.paint(t,n,!0)})}}else t.title&&(i.save(),SEQ.entityTitle.paint(t.title,i,!1),i.restore())}}}(),(SEQ=SEQ||{}).interactor=function(){var t,e,i,a,n,r,o,s,c,l=0,p=0,g=!1,d=!1,m=!1,E=!1;function u(t){var e=SEQ.main.getInteractionCanvas(),i=e.getBoundingClientRect(),a=t.clientX-i.left,n=t.clientY-i.top;return{x:a=Math.ceil(a*(e.width/e.clientWidth)),y:n=Math.ceil(n*(e.height/e.clientHeight))}}function S(t,e){var i;if(i=e||"info",SEQ.main.isIntellijIntegration())SEQ.javaBridge.displayEntryEditor(i);else{var a=document.getElementById("entryEditor");a.style.top=t.pageY+"px",a.style.left=t.pageX-100+"px",a.style.display="block";var n=document.getElementById("entryEditorTextArea");n.value=i,n.setSelectionRange(0,n.value.length),n.focus()}}function f(t,e,i){if(SEQ.main.isIntellijIntegration())i?SEQ.javaBridge.displayParticipantEditor(e+","+SEQ.textUtil.buildInputBoxText(i)):SEQ.javaBridge.displayParticipantEditor(e);else{var a=document.getElementById("entryEditor");a.style.top=t.pageY+"px",a.style.left=t.pageX-100+"px",a.style.display="block",document.getElementById("participantEdit").style.display="block";var n=document.getElementById("participantAliasInput");n.value=e;var r=document.getElementById("entryEditorTextArea");i?(r.value=SEQ.textUtil.buildInputBoxText(i),r.setSelectionRange(0,r.value.length),r.focus()):(r.value=null,n.setSelectionRange(0,n.value.length),n.focus())}}function h(t,e,i){if(i&&(i=i.replace(/\n/g,"\\n")),new RegExp("^"+SEQ.entityParticipant.nameGroup+"$").exec(e)){var a=[];SEQ.parser.diagram.participants.forEach(function(t){t.declared||a.push(t)});for(var n=!1,r=SEQ.parser.diagram.entries,o="",s=0;s<r.length;s++){var c,l=r[s];if(!l.type||SEQ.entityTitle.isType(l.type)||SEQ.entityParticipant.isType(l.type)||n||(a.forEach(function(a){a.name==t.name?o+=SEQ.entityParticipant.build(SEQ.entityParticipant.Type.PARTICIPANT,e,i)+"\n":o+=SEQ.entityParticipant.build(SEQ.entityParticipant.Type.PARTICIPANT,a.name)+"\n"}),a.length>0&&(o+="\n"),n=!0),SEQ.entityParticipant.isType(l.type))c=l.fromParticipantName==t.name?t.image?SEQ.entityParticipant.build(l.participantType,e,i,t.styling,t.iconUnicodeString,t.image.src):SEQ.entityParticipant.build(l.participantType,e,i,t.styling,t.iconUnicodeString):l.raw;else{var p=t.name.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),g=new RegExp("(^|[^\\w\\d]|x)"+p+"([^\\w\\d]|x|$)","g");c=l.raw?l.raw.replace(g,"$1"+e+"$2"):l.raw}o=V(s,r,o,c)}SEQ.main.updateSource(o)}else SEQ.menu.displayNotification("Illegal character in participant alias, use long name instead.",!1,"notificationError","notificationCenter");y(),SEQ.parser.parse()}function y(){SEQ.main.isIntellijIntegration()&&SEQ.javaBridge.clearSelectedEntry(),SEQ.main.isRenderPngImageOnly()||SEQ.main.isRenderInteractiveCanvasOnly()||(SEQ.contextMenu.cancel(),SEQ.messageCreator.cancel(),SEQ.entryMover.cancel(),SEQ.saveAndOpen.cancelActiveFileNameChange(),document.getElementById("entryEditor").style.display="none",document.getElementById("participantEdit").style.display="none",t=null,e=null,i=null,k(),m=!1)}function Q(){var t=SEQ.main.validateSource(document.getElementById("entryEditorTextArea").value);(document.getElementById("entryEditor").style.display="none",e&&(e.type==SEQ.entityParticipant.Type.PARTICIPANT||i))?v(t,SEQ.main.validateParticipantAlias(document.getElementById("participantAliasInput").value)):v(t)}function v(a,n){if(e){var r=e.raw,o=/^[\s]{0,100}/.exec(r)[0];if(e.type==SEQ.entityParticipant.Type.PARTICIPANT)h(e,n,a);else if(i)h(i,n,a);else if(SEQ.entityFragment.regExp.exec(e.type)){var s=r.indexOf(" ");e.raw=s>-1?r.substring(0,r.indexOf(" ")+1)+a.replace(/\n/g,"\\n"):r+" "+a.replace(/\n/g,"\\n"),O()}else if(SEQ.entityDivider.Type.DIVIDER===e.type)e.raw=SEQ.entityDivider.build(a.replace(/\n/g,"\\n")),O();else if(SEQ.entityFrame.isType(e.type))e.raw=e.build(a,o),O();else if(SEQ.entityMessage.isType(e.type)){var c=X(e);e.raw=r.substring(0,c+1)+a.replace(/\n/g,"\\n"),O()}else SEQ.entityTitle.isType(e.type)?(e.raw=e.build(a),O()):(e.raw=r.substring(0,r.indexOf(":")+1)+a.replace(/\n/g,"\\n"),O())}else t&&(t.text=a,N(t))}function T(t){if(!SEQ.parser.parsingState.ongoing){var i=t.target.tagName;27==t.keyCode&&(y(),SEQ.main.closePopups(),t.stopPropagation()),P()||(46==t.keyCode?e&&function(t,e){P()||(t.preventDefault(),R(e))}(t,e):187==t.keyCode||171==t.keyCode||107==t.keyCode?"TEXTAREA"!=i&&"INPUT"!=i&&A(.1):189==t.keyCode||173==t.keyCode||109==t.keyCode?"TEXTAREA"!=i&&"INPUT"!=i&&A(-.1):90==t.keyCode&&(t.ctrlKey||t.metaKey)&&t.shiftKey?(t.preventDefault(),SEQ.main.redoChange()):90==t.keyCode&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),SEQ.main.undoChange()):89==t.keyCode&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),SEQ.main.redoChange()):83==t.keyCode&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),SEQ.saveAndOpen.saveDirectly()):79==t.keyCode&&(t.ctrlKey||t.metaKey)?(t.preventDefault(),SEQ.saveAndOpen.showDefaultStorageOpen()):77==t.keyCode&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),SEQ.menu.togglePresentationMode()))}}function A(t){for(var e=!1,i=SEQ.parser.diagram.entries,a="",n=0;n<i.length;n++){var r=i[n];null!=r.entrySpacing&&(e=!0,r.raw=SEQ.entityEntrySpacing.build(r.entrySpacing+t)),!e&&r.type&&r.type!=SEQ.entityParticipant.Type.PARTICIPANT&&r.type!=SEQ.entityTitle.Type.TITLE&&(a+=SEQ.entityEntrySpacing.build(SEQ.metrics.constants.entrySpacingRatio+t)+"\n",e=!0),a=V(n,i,a,r.raw)}SEQ.main.updateSource(a),SEQ.parser.parse()}function P(){if(!SEQ.main.isRenderInteractiveCanvasOnly())return"block"==document.getElementById("entryEditor").style.display}function x(t){var e=document.getElementById("entryEditor"),i=t.clientX-a,s=t.clientY-n;e.style.top=o+s+"px",e.style.left=r+i+"px",t.preventDefault()}function C(t){document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",C),t.preventDefault()}function R(t){var e,i=SEQ.parser.diagram.entries;e=SEQ.entityParticipant.isType(t.type)?function(t,e){return t.name===e.fromParticipantName||t.name===e.toParticipantName}:SEQ.entityFragment.isType(t.type)&&SEQ.entityFragment.Type.ELSE!=t.type?t.fragment.type===SEQ.entityFragment.Type.EXPANDABLE_PLUS?function(t,e){return t.fragment==e.fragment||t.fragment==e.enclosingCollapsedFragment}:function(t,e){return t.fragment==e.fragment}:function(t,e){return t===e};for(var a="",n=0;n<i.length;n++){var r=i[n];e(t,r)||(a=V(n,i,a,r.raw))}SEQ.main.updateSource(a),SEQ.parser.parse()}function O(){for(var t=SEQ.parser.diagram.entries,e="",i=0;i<t.length;i++){e=V(i,t,e,t[i].raw)}SEQ.main.updateSource(e),SEQ.parser.parse()}function N(t){for(var e=SEQ.parser.diagram.entries,i=!1,a="",n=0;n<e.length;n++){var r=e[n];!i&&r.type&&t.posY<r.position.posY&&(a+=o()+"\n",i=!0),a=V(n,e,a,r.raw)}function o(){return SEQ.entityMessage.regExpArrow.exec(t.type)?SEQ.entityMessage.build(t.type,t.fromParticipantName,t.toParticipantName,t.text):SEQ.entityNoteBoxLeftRight.isType(t.type)?t.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER?SEQ.entityNoteBoxOver.build(t.type,t.participants,t.text):SEQ.entityNoteBoxLeftRight.build(t.type,t.notePosition,t.participants,t.text):SEQ.entityDivider.isType(t.type)?SEQ.entityDivider.build(t.text):SEQ.entityFragment.isType(t.type)?SEQ.entityFragment.build(t.type,t.text):SEQ.entityActivation.isType(t.type)?SEQ.entityActivation.build(t.type,t.participants):SEQ.entitySpace.isType(t.type)?SEQ.entitySpace.build(t.type):void 0}i||(a+="\n"+o()),t=null,SEQ.main.updateSource(a),SEQ.parser.parse()}var M=!1;function L(t){if(t.stopPropagation(),SEQ.main.isIntellijIntegration()&&e&&"block"!=document.getElementById("entryEditor").style.display&&SEQ.javaBridge.focusEditor(),d)return t.preventDefault(),M=!1,void w(t);P()||g||(m=!1,SEQ.messageCreator.finishMessage(t),SEQ.entryMover.finishMove(t)),_(t)}function I(){m&&(m=!1,y())}function D(t){if(d){t.preventDefault();var a=u(t);if(!B(a)&&H(a.x,a.y)!=SEQ.entityFragment.CollisionType.TOGGLE){SEQ.main.getInteractionCanvas().style.cursor="grabbing";var n=document.documentElement;s=t.clientX+n.scrollLeft,c=t.clientY+n.scrollTop,M=!0}}else if(P()&&Q(),g=function(t){if(t.buttons)return 1!=t.buttons;if(t.which)return 1!=t.which;return!1}(t),!P()&&!g){SEQ.main.blurEditor();var r=(new Date).getTime();if(r-p<400){var o,l=u(t);if(W(l))o=SEQ.entityParticipant.findParticipantXCollision(l.x,l.y);else{var m=H(l.x,l.y);m!=SEQ.entityFragment.CollisionType.TOGGLE&&(o=m)}e==o?function(t){if(t.preventDefault(),e&&!E)if(e.type==SEQ.entityParticipant.Type.PARTICIPANT)f(t,e.name,e.longNameTextData);else if(SEQ.entityFragment.regExp.exec(e.type))SEQ.entityFragment.Type.END!=e.type&&(e.elseGuard?S(t,e.elseGuard.text):S(t,e.fragment.text));else if(i)f(t,i.name,i.longNameTextData);else if(e.textData){var a=SEQ.textUtil.buildInputBoxText(e.textData);S(t,a)}else e.text&&S(t,e.text)}(t):(p=r,b(t))}else p=r,b(t);t.preventDefault()}}function w(t){if(!t.buttons&&SEQ.parser&&SEQ.parser.diagram.collisionTypeAreas){var e,i=SEQ.main.getInteractionCanvas().style,a=SEQ.interactor.getMousePosInCanvas(t),n=SEQ.parser.diagram.collisionTypeAreas.search({minX:a.x,maxX:a.x,minY:a.y,maxY:a.y});if(n.length)n.forEach(function(t){t.type.indexOf("pointer")>-1&&(e=t.type)}),e?i.cursor=e:"grab"!=i.cursor&&(i.cursor="grab");else"grab"!=i.cursor&&(i.cursor="grab")}}function F(t){if(d)if(M&&!t.buttons&&(M=!1,SEQ.main.getInteractionCanvas().style.cursor="grab"),M){var e=document.documentElement;t.preventDefault();var i=s-(t.clientX+e.scrollLeft),a=c-(t.clientY+e.scrollTop);e.scrollLeft+=i,e.scrollTop+=a}else w(t);else P()||g||(SEQ.messageCreator.paintMessage(t),SEQ.entryMover.continueMove(t)),_(t)}function _(t){if(!t.buttons&&SEQ.parser&&SEQ.parser.diagram.collisionTypeAreas){var e,i=SEQ.interactor.getMousePosInCanvas(t),a=SEQ.parser.diagram.collisionTypeAreas.search({minX:i.x,maxX:i.x,minY:i.y,maxY:i.y}),n=SEQ.main.getInteractionCanvas().style;if(a.length)a.forEach(function(t){"pointer"===t.type&&(e=t.type)}),n.cursor=e||a[0].type;else"auto"!=n.cursor&&(n.cursor="auto")}}function W(t){var e=K()+SEQ.metrics.data.participantMarginTop+SEQ.parser.diagram.maxParticipantGroupHeight;return t.y>e&&t.y<e+SEQ.parser.diagram.participantMaxHeight}function B(t){var e;return SEQ.parser.diagram.collisionTypeAreas.search({minX:t.x,maxX:t.x,minY:t.y,maxY:t.y}).forEach(function(t){t.link&&(e=t.link)}),e&&window.open(e),!!e}function b(t){y();var i=SEQ.main.getInteractionContext();i.save(),i.fillStyle=SEQ.main.getHighlightColor(),i.strokeStyle=SEQ.main.getHighlightColor();var a=u(t);if(!B(a))if(W(a)){var n=SEQ.entityParticipant.findParticipantXCollision(a.x,a.y);n&&(e=n,SEQ.entityParticipant.paint(n,i,!1,!0),e.entry&&Y(e.entry),n.updatePos&&!E&&(m=!0,SEQ.entryMover.startParticipantMove(t,n)))}else{var r=H(a.x,a.y);if(r&&r!=SEQ.entityFragment.CollisionType.TOGGLE)r.paint(r,i,!0,!1,SEQ.metrics.getCanvasSize()),Y(r),e=r,r.updatePos&&!E&&(m=!0,SEQ.entryMover.startMove(t,r));else if(!E){var o=SEQ.entityParticipant.findParticipantXCollision(a.x,a.y);o&&(m=!0,SEQ.messageCreator.startMessage(t,o))}}i.restore()}function X(t){var e,i;return t.directionForward?(e=t.raw.indexOf(t.fromParticipantName),(i=t.raw.indexOf(t.toParticipantName,e+1))+t.toParticipantName.length):(i=t.raw.indexOf(t.toParticipantName),(e=t.raw.indexOf(t.fromParticipantName,i+1))+t.fromParticipantName.length)}function Y(t){var e=[];SEQ.parser.diagram.entries.forEach(function(t){void 0!==t.raw&&e.push(t)});var i,a=e.indexOf(t),n=/^[\s]{0,100}/.exec(t.raw)[0].length;if(SEQ.entityDivider.isType(t.type))i={start:t.raw.indexOf("==")+2,end:t.raw.length-2};else if(SEQ.entityFragment.isType(t.type))i={start:t.type.length+n+1,end:t.raw.length};else if(SEQ.entityParticipant.isType(t.type))if(t.longName){var r=t.raw.indexOf('"')+1;i={start:r,end:t.raw.indexOf(" as ",r)-1}}else i={start:0,end:0};else if(SEQ.entityFrame.isType(t.type))i={start:t.type.length+n+1,end:t.raw.length};else if(SEQ.entityMessage.isType(t.type)){i={start:X(t)+1,end:t.raw.length}}else if(SEQ.entityNoteBoxLeftRight.isType(t.type)){i={start:t.raw.indexOf(":")+1,end:t.raw.length}}else i=SEQ.entityTitle.isType(t.type)?{start:t.type.length+n+1,end:t.raw.length}:{start:0,end:t.raw.length};if(SEQ.main.isIntellijIntegration()){var o=a+"|"+i.start+"|"+i.end;t.textData&&t.textData.meta&&(o+="|"+t.textData.meta),SEQ.javaBridge.selectInSource(o)}else SEQ.main.selectInSource(a,i.start,i.end),SEQ.main.focusEditor()}function H(t,e){for(var a=SEQ.parser.diagram.entries,n=0;n<a.length;n++){var r=a[n];if(!r.enclosingCollapsedFragment)if(r.collisionV2){var o=r.collisionV2(t,e);if(o)return o.participantToCreate&&(i=r.participantToCreate),r}else if(r.collision){var s=r.collision(r,t,e);if(s){if(s===SEQ.entityFragment.CollisionType.TOGGLE)return G(r),SEQ.entityFragment.CollisionType.TOGGLE;if(s.participantToCreate&&c(s.participantToCreate)&&(i=r.participantToCreate),s.main&&c(s.main)||s.participantToCreate&&c(s.participantToCreate))return r}}}function c(i){return e<i.startY&&e>i.endY&&t>i.startX&&t<i.endX}}function G(t){for(var e=SEQ.parser.diagram.entries,i="",a=0;a<e.length;a++){var n=e[a];if(n===t)i=V(a,e,i,n.raw.indexOf(SEQ.entityFragment.Type.EXPANDABLE_PLUS)>-1?n.raw.replace(SEQ.entityFragment.Type.EXPANDABLE_PLUS,SEQ.entityFragment.Type.EXPANDABLE_MINUS):n.raw.indexOf(SEQ.entityFragment.Type.EXPANDABLE_MINUS)>-1?n.raw.replace(SEQ.entityFragment.Type.EXPANDABLE_MINUS,SEQ.entityFragment.Type.EXPANDABLE_PLUS):n.raw.replace(SEQ.entityFragment.Type.EXPANDABLE_DASH,SEQ.entityFragment.Type.EXPANDABLE_PLUS));else i=V(a,e,i,n.raw)}SEQ.main.updateSource(i),SEQ.parser.parse()}function k(){if(!SEQ.main.isRenderInteractiveCanvasOnly()){var t=SEQ.main.getInteractionContext();return t.clearRect(0,0,t.canvas.width,t.canvas.height),t}}function U(t){var a=t.target;SEQ.main.getInteractionCanvas().contains(a)||(P()?document.getElementById("entryEditor").contains(a)||Q():(e=null,i=null,k()));var n=document.getElementById("contextMenu");n&&!n.contains(a)&&y(),SEQ.menu.onDocumentMouseDown(t)}function V(t,e,i,a){if(void 0!==a){for(var n=0,r=t+1;r<e.length;r++)void 0!==e[r].raw&&n++;i+=0===n?a:a+"\n"}return i}function z(){var t,e;SEQ.main.isRenderInteractiveCanvasOnly()||SEQ.main.isIntellijIntegration()||SEQ.main.isOfficeIntegration()||document.getElementById("top")&&"none"==document.getElementById("top").style.display?(t=0,e=0):(t=40,e=10),e+=K(),e+=SEQ.parser.diagram.maxParticipantGroupHeight;var i=SEQ.main.getParticipantCanvas();window.pageYOffset>e&&SEQ.menu.isParticipantOverlay()?i.style.display="block":i.style.display="none",i.style.top=window.pageYOffset+t+"px"}function K(){return(SEQ.parser.diagram.frame?SEQ.parser.diagram.frame.totalHeight:0)+(SEQ.parser.diagram.title?SEQ.parser.diagram.title.totalHeight:0)}return{init:function(){var t=SEQ.main.getInteractionCanvas();t.addEventListener("mouseup",L,!1),t.addEventListener("mousedown",D,!1),t.addEventListener("mousemove",F,!1),document.addEventListener("keydown",T,!1),document.addEventListener("mousedown",U,!1),document.addEventListener("mouseup",I,!1),window.addEventListener("scroll",z,!1)},prependParticipant:function(){for(var t=SEQ.parser.diagram.entries,e=!1,i="",a="participant ChangeMe"+ ++l,n=0;n<t.length;n++){var r=t[n];!r.type||SEQ.entityTitle.isType(r.type)||SEQ.entityParticipant.isType(r.type)||e||(i+=a+"\n",e=!0),i=V(n,t,i,r.raw)}e||(i+="\n"+a),SEQ.main.updateSource(i),SEQ.parser.parse()},cancelAllInteraction:y,editEntryTextAreaActive:P,getMousePosInCanvas:u,displayInputBox:S,setNewEntryData:function(e){t=e},createEntry:N,clearInteractionContext:k,onWindowScroll:z,onEntryEditorTextAreaKeyDown:function(t){(t.ctrlKey||t.metaKey)&&13==t.keyCode&&(t.preventDefault(),Q())},saveEditEntryResult:Q,entryEditorMouseDown:function(t){var e=document.getElementById("entryEditor");a=t.clientX,n=t.clientY,o=parseInt(e.style.top,10),r=parseInt(e.style.left,10),document.addEventListener("mousemove",x),document.addEventListener("mouseup",C),t.preventDefault()},setReadOnly:function(t){d=t},appendEntry:V,saveEditEntryResultFromIntellij:function(t,a){var n=decodeURIComponent(t),r=SEQ.main.validateSource(n);if(e&&(e.type==SEQ.entityParticipant.Type.PARTICIPANT||i)){var o=decodeURIComponent(a);v(r,SEQ.main.validateParticipantAlias(o))}else v(r);SEQ.javaBridge.selectInSource("none")},deleteEntryForIntellij:function(){e&&R(e)},setIntellijGeneratorMode:function(t){E=t}}}(),(SEQ=SEQ||{}).contextMenu=function(){var t,e;function i(i){if(!SEQ.interactor.editEntryTextAreaActive()){SEQ.interactor.cancelAllInteraction(!0);var s=SEQ.interactor.getMousePosInCanvas(i),c=SEQ.entityParticipant.findParticipantXCollision(s.x,s.y);e={event:i,posY:s.y},(t=document.createElement("div")).id="contextMenu",document.body.appendChild(t);var l=document.createElement("ul");l.className="contextMenuPart",l.style.width="160px",l.style.top=Math.ceil(i.pageY)+2+"px",l.style.left=Math.ceil(i.pageX)+2+"px",l.onmouseup=o,t.appendChild(l),c&&(n(l,"note",a(SEQ.entityNoteBoxOver.Type.NOTE,c)),n(l,"box",a(SEQ.entityNoteBoxOver.Type.BOX,c)),n(l,"round box",a(SEQ.entityNoteBoxOver.Type.RBOX,c)),n(l,"angular box",a(SEQ.entityNoteBoxOver.Type.ABOX,c)),n(l,"reference",a(SEQ.entityNoteBoxOver.Type.REF,c)),n(l,"activation",function(e){var i=document.createElement("ul");return i.className="contextMenuPart contextSubMenuPart",r(i,SEQ.entityActivation.Type.ACTIVATE,null,e.name),r(i,SEQ.entityActivation.Type.DEACTIVATE,null,e.name),r(i,SEQ.entityActivation.Type.DEACTIVATE_AFTER,null,e.name),t.appendChild(i),i}(c))),n(l,"fragment",function(e){var i=document.createElement("ul");i.className="contextMenuPart contextSubMenuPart",r(i,SEQ.entityFragment.Type.ALT),SEQ.entityFragment.insideFragmentType(e,SEQ.entityFragment.Type.ALT)&&r(i,SEQ.entityFragment.Type.ELSE);r(i,SEQ.entityFragment.Type.OPT),r(i,SEQ.entityFragment.Type.LOOP),r(i,SEQ.entityFragment.Type.PAR),SEQ.entityFragment.insideFragmentType(e,SEQ.entityFragment.Type.PAR)&&r(i,SEQ.entityFragment.Type.THREAD);return r(i,SEQ.entityFragment.Type.GROUP),r(i,SEQ.entityFragment.Type.EXPANDABLE_MINUS),r(i,SEQ.entityFragment.Type.ASSERT),r(i,SEQ.entityFragment.Type.BREAK),r(i,SEQ.entityFragment.Type.CONSIDER),r(i,SEQ.entityFragment.Type.CRITICAL),r(i,SEQ.entityFragment.Type.IGNORE),r(i,SEQ.entityFragment.Type.NEG),r(i,SEQ.entityFragment.Type.SEQ),r(i,SEQ.entityFragment.Type.STRICT),t.appendChild(i),i}(s)),n(l,"divider",null,SEQ.entityDivider.Type.DIVIDER),n(l,"space",null,SEQ.entitySpace.Type.SPACE)}return i.preventDefault(),!1}function a(e,i){var a=document.createElement("ul");return a.className="contextMenuPart contextSubMenuPart",e!==SEQ.entityNoteBoxOver.Type.REF&&(r(a,e,SEQ.entityNoteBoxLeftRight.NotePosition.LEFT,i.name),r(a,e,SEQ.entityNoteBoxLeftRight.NotePosition.RIGHT,i.name)),r(a,e,SEQ.entityNoteBoxOver.NotePosition.OVER,i.name),SEQ.parser.diagram.participants.forEach(function(t){t.name!==i.name&&r(a,e,SEQ.entityNoteBoxOver.NotePosition.OVER,i.name+","+t.name)}),t.appendChild(a),a}function n(t,e,i,a){var n=document.createElement("li");if(t.appendChild(n),n.className="mainMenuListElement",i){var r=document.createTextNode(e),s=document.createElement("span");s.textContent=">",s.style.float="right",n.appendChild(s),n.appendChild(r),i.style.top=Math.ceil(n.getBoundingClientRect().top+window.pageYOffset)-2+"px",i.style.left=Math.ceil(t.getBoundingClientRect().right+window.pageXOffset)-2+"px",i.onmouseup=o}else n.textContent=e;a&&n.setAttribute("data-entry-type",a),n.onmouseover=function(){for(var t=document.getElementsByClassName("contextSubMenuPart"),e=0;e<t.length;e++)t[e].style.display="none";for(var a=document.getElementsByClassName("mainMenuListElement"),r=0;r<a.length;r++)a[r].style.backgroundColor="#ffffff";n.style.backgroundColor="#eeeeee",i&&(i.style.display="block")}}function r(t,e,i,a){var n=document.createElement("li");n.setAttribute("data-entry-type",e),a&&n.setAttribute("data-entry-participants",a),i&&n.setAttribute("data-entry-note-position",i),n.textContent=i&&a?e+" "+i+" "+a:a?e+" "+a:e,t.appendChild(n)}function o(i){var a=i.target,n=a.getAttribute("data-entry-type"),r=a.getAttribute("data-entry-note-position"),o=a.getAttribute("data-entry-participants");if(n){document.body.removeChild(t),t=null;var s={participants:o,posY:e.posY,type:n,notePosition:r};SEQ.interactor.setNewEntryData(s),SEQ.entityActivation.isType(n)||SEQ.entitySpace.isType(n)?SEQ.interactor.createEntry(s):SEQ.interactor.displayInputBox(e.event),e=null}}function s(t){if(!SEQ.interactor.editEntryTextAreaActive()){SEQ.interactor.cancelAllInteraction(!0);var i=SEQ.interactor.getMousePosInCanvas(t),a=SEQ.entityParticipant.findParticipantXCollision(i.x,i.y);e={event:t,posY:i.y};var n=!1;SEQ.entityFragment.insideFragmentType(i,SEQ.entityFragment.Type.ALT)&&(n=!0);var r=!1;SEQ.entityFragment.insideFragmentType(i,SEQ.entityFragment.Type.PAR)&&(r=!0);var o=SEQ.main.getDiagramCanvas().getBoundingClientRect();Math.ceil(i.x+o.x),Math.ceil(i.y+o.y);a?SEQ.javaBridge.createDiagramContextMenu(n+","+r+","+a.name):SEQ.javaBridge.createDiagramContextMenu(n+","+r)}return t.preventDefault(),!1}return{init:function(){SEQ.main.getInteractionCanvas().addEventListener("contextmenu",i,!1)},initIntellij:function(){SEQ.main.getInteractionCanvas().addEventListener("contextmenu",s,!1)},contextMenuActionForIntellij:function(t,i,a){var n;i&&(n=i.replaceAll(":",'"'));var r={participants:n,posY:e.posY,type:t,notePosition:a};SEQ.interactor.setNewEntryData(r),SEQ.entityActivation.isType(t)||SEQ.entitySpace.isType(t)?SEQ.interactor.createEntry(r):SEQ.interactor.displayInputBox(e.event),e=null},active:function(){return null!=t},cancel:function(){t&&document.body.removeChild(t),e=null,t=null}}}(),(SEQ=SEQ||{}).messageCreator=function(){var t,e,i,a=!1;function n(n){t&&(e=0,i=0,n.clientY<50?i=-20:n.clientY>window.innerHeight-50&&(i=20),n.clientX<50?e=-20:n.clientX>window.innerWidth-50&&(e=20),0!=e||0!=i?a||(a=!0,r()):a=!1)}var r=function(){0==e&&0==i||!t||(window.scrollBy(e,i),setTimeout(r,40))};function o(e){return Math.abs(t.participant.posX-e.x)<SEQ.metrics.data.messageSelfRefMessageCreatorThreshold&&Math.abs(e.y-t.y)>SEQ.metrics.data.messageCreatorPosDiffThreshold}return{init:function(){SEQ.main.getInteractionCanvas().addEventListener("contextmenu",onCanvasContextMenu,!1)},cancel:function(){t=null,window.removeEventListener("mousemove",n,!1)},creationOngoing:function(){return null!=t},startMessage:function(e,i){var a=SEQ.interactor.getMousePosInCanvas(e);t={shift:e.shiftKey,ctrl:e.ctrlKey||e.metaKey,x:a.x,y:a.y,participant:i},window.addEventListener("mousemove",n,!1)},finishMessage:function(e){var i=SEQ.interactor.getMousePosInCanvas(e);if(t){var a=SEQ.entityParticipant.findParticipantXCollision(t.x,t.y),n=SEQ.entityParticipant.findParticipantXCollision(i.x,i.y);if(a&&n&&(o(i)||Math.abs(i.x-t.x)>SEQ.metrics.data.messageCreatorInteractionMargin&&a!=n)){var r;r=n.posX>=a.posX?t.shift?t.ctrl?SEQ.entityMessage.Type.RESP_FORWARD_ASYNC:SEQ.entityMessage.Type.RESP_FORWARD_SYNC:t.ctrl?SEQ.entityMessage.Type.REQ_FORWARD_ASYNC:SEQ.entityMessage.Type.REQ_FORWARD_SYNC:t.shift?t.ctrl?SEQ.entityMessage.Type.RESP_BACKWARD_ASYNC:SEQ.entityMessage.Type.RESP_BACKWARD_SYNC:t.ctrl?SEQ.entityMessage.Type.REQ_BACKWARD_ASYNC:SEQ.entityMessage.Type.REQ_BACKWARD_SYNC;var s=(t.y+i.y)/2,c={fromParticipantName:a.name,toParticipantName:n.name,posY:s,type:r};return SEQ.interactor.setNewEntryData(c),SEQ.interactor.displayInputBox(e),!0}SEQ.interactor.cancelAllInteraction(),t=null}},paintMessage:function(e){t&&(e.preventDefault(),function(e){var i=SEQ.interactor.clearInteractionContext();if(t){var a,n=SEQ.interactor.getMousePosInCanvas(e);if(i.save(),t.shift&&void 0!==i.setLineDash&&i.setLineDash([SEQ.metrics.data.messageLineDashWidth]),o(n)){a=!1,i.beginPath();var r=SEQ.metrics.data.messageSelfRefWidth,s=t.participant.posX;i.moveTo(t.participant.posX,t.y),i.lineTo(s+r,t.y),i.lineTo(s+r,n.y),i.lineTo(n.x,n.y),i.stroke()}else{var c=t.participant.posX,l=n.x>t.participant.posX?-1*SEQ.metrics.data.messageArrowWidth:SEQ.metrics.data.messageArrowWidth;a=t.participant.posX<n.x,i.beginPath(),i.moveTo(c,t.y),i.lineTo(n.x+l,n.y),i.stroke()}i.restore(),SEQ.entityMessage.paintArrowHead(n.y,a,n.x,i,t.ctrl)}}(e))}}}(),(SEQ=SEQ||{}).entryMover=function(){var t,e,i,a,n,r,o,s,c,l,p,g,d=!1;function m(e){t&&(p=0,g=0,e.clientY<50?g=-20:e.clientY>window.innerHeight-50&&(g=20),e.clientX<50?p=-20:e.clientX>window.innerWidth-50&&(p=20),0!=p||0!=g?d||(d=!0,E()):d=!1)}var E=function(){0==p&&0==g||!t||(window.scrollBy(p,g),setTimeout(E,40))};function u(t){return Math.abs(r.y-t.y)>SEQ.metrics.data.entryMoverThreshold||Math.abs(r.x-t.x)>SEQ.metrics.data.entryMoverThreshold}function S(){e=null,t=null,o=!1,s=!1,c=!1,l=!1,d=!1,p=0,g=0,window.removeEventListener("mousemove",m,!1)}function f(t){return t.declared?t.entry.raw:SEQ.entityParticipant.build(SEQ.entityParticipant.Type.PARTICIPANT,t.name)}function h(t,e,i){return void 0!==i&&(e+=0===t?i:"\n"+i),e}return{cancel:function(){S()},moveOngoing:function(){return null!=t},startMove:function(t,c){if(c.calcPosX){var p=c.calcPosX(c);i=p.fromX,a=p.toX}S(),e=c;var g=SEQ.interactor.getMousePosInCanvas(t);c.toParticipantName?(!c.participantToCreate&&Math.abs(g.x-a)<SEQ.metrics.data.entryMoverXCollisionWidth&&(s=!0),Math.abs(g.x-i)<SEQ.metrics.data.entryMoverXCollisionWidth&&(o=!0),o&&s&&(Math.abs(g.x-a)>Math.abs(g.x-i)?(s=!1,o=!0):(s=!0,o=!1))):c.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER?Math.abs(g.x-i)>c.totalWidth/2-1.5*SEQ.metrics.data.entryMoverXCollisionWidth?(a=i,l=!0,g.x>i?s=!0:o=!0):o=!0:c.fromParticipantName&&!c.lockedPosX&&(o=!0),n=e.position.posY-g.y,r=g},finishMove:function(i){var a,r=SEQ.interactor.getMousePosInCanvas(i);t&&u(r)&&(a=c?function(e){var i=[];SEQ.parser.diagram.participants.forEach(function(t){t.declared||i.push(t)});for(var a=SEQ.parser.diagram.entries,n="",r=!1,o=!1,s=0;s<a.length;s++){var c=a[s];SEQ.entityParticipant.isType(c.type)&&e.x<c.posX&&!o&&(n+="\n"+f(t)+"\n",o=!0),!c.type||SEQ.entityTitle.isType(c.type)||SEQ.entityParticipant.isType(c.type)||SEQ.entityParticipantGroup.isType(c.type)||r||(i.forEach(function(i){e.x<i.posX&&!o&&(n+="\n"+f(t)+"\n",o=!0),i.name!=t.name&&(n+="\n"+SEQ.entityParticipant.build(SEQ.entityParticipant.Type.PARTICIPANT,i.name))}),r=!0,o||(n+="\n"+f(t)+"\n"),i.length&&(n+="\n")),SEQ.entityParticipant.isType(c.type)&&c.fromParticipantName==t.name||(n=h(s,n,c.raw))}return n}(r):function(i){var a=t.raw;if(o){var r=SEQ.entityParticipant.findParticipantXCollision(i.x,i.y);r&&(t.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER&&t.toParticipantName===r.name?(t.fromParticipantName=r.name,t.toParticipantName=null):t.fromParticipantName=r.name,a=t.buildRaw(t))}else if(s){var c=SEQ.entityParticipant.findParticipantXCollision(i.x,i.y);c&&(t.notePosition===SEQ.entityNoteBoxOver.NotePosition.OVER&&t.fromParticipantName===c.name?(t.fromParticipantName=c.name,t.toParticipantName=null):t.toParticipantName=c.name,a=t.buildRaw(t))}for(var l=SEQ.parser.diagram.entries,p=!1,g="",d=0;d<l.length;d++){var m=l[d];!p&&m.type&&i.y+n<m.position.posY&&(g=h(d,g,a),p=!0,0===d&&(g+="\n")),m!=e&&(g=h(d,g,m.raw))}return p||(g+="\n"+a),g}(r),SEQ.main.updateSource(a),SEQ.parser.parse()),t&&SEQ.interactor.clearInteractionContext(),S()},continueMove:function(r){r.preventDefault(),e&&!t?u(SEQ.interactor.getMousePosInCanvas(r))&&(window.addEventListener("mousemove",m,!1),(t=SEQ.main.clone(e)).paint=e.paint,e.participantToCreate&&(t.participantToCreate=e.participantToCreate),t.updatePos=e.updatePos,t.buildRaw=e.buildRaw,l&&(t.toParticipantName=t.fromParticipantName),e.participantType&&(t.participantType=e.participantType),e.image&&(t.image=e.image)):t&&function(e){var r=SEQ.interactor.clearInteractionContext();if(t){var l=SEQ.interactor.getMousePosInCanvas(e);r.save(),r.globalAlpha=.5,o?t.updatePos(t,l.y+n,l.x,a):s?t.updatePos(t,l.y+n,i,l.x):c?t.updatePos(t,l.x):t.updatePos(t,l.y+n,i,a),t.paint(t,r,!1,!0,SEQ.metrics.getCanvasSize()),r.restore()}}(r)},startParticipantMove:function(t,i){S(),c=!0;var a=SEQ.interactor.getMousePosInCanvas(t);n=(e=i).posX-a.x,r=a}}}(),(SEQ=SEQ||{}).participantTypes=function(){function t(t,e,i,a,n,r,o,s){for(var c=o;c<s;c+=.01){var l=e-n*Math.sin(c)*Math.sin(r)+a*Math.cos(c)*Math.cos(r),p=i+a*Math.cos(c)*Math.sin(r)+n*Math.sin(c)*Math.cos(r);0==c?t.moveTo(l,p):t.lineTo(l,p)}}function e(t,e){t.styling&&t.styling.fillColor?e.fillStyle=t.styling.fillColor:e.fillStyle=SEQ.main.getBackgroundColor(),e.fill()}function i(t,e){0!=t.styling.lineWeight&&(t.styling.lineWeight?e.lineWidth=SEQ.main.getLineWeightParticipantType(t.styling.lineWeight):e.lineWidth=SEQ.metrics.data.participantTypeLineWeight,t.styling.lineColor&&(e.strokeStyle=t.styling.lineColor),e.stroke())}function a(){return 3.14*SEQ.metrics.data.baseSpaceMetric-SEQ.metrics.data.participantTypeLineWeight}function n(t,e,i){var a;return t>(a=i?i.width:SEQ.metrics.calcWidth(e))?t:a}function r(t,e){return e?t+e.height:t+SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding}return{fontawesome:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;if(n){var s=SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize());r=n+o+SEQ.metrics.data.baseSpaceMetric/3+s}else r=i+a-o-SEQ.metrics.data.baseSpaceMetric/3;t.save(),t.font=SEQ.main.getFontFontAwesome();var c=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontFontAwesome());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-c/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontFontAwesome()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),t,SEQ.main.getFontIconSize()),i)}},materialdesignicons:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;n?r=n+o+SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize()):r=i+a-o-SEQ.metrics.data.baseSpaceMetric/5;t.save(),t.font=SEQ.main.getFontMaterialDesignIcons();var s=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontMaterialDesignIcons());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-s/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontMaterialDesignIcons()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontMaterialDesignIcons(),t,SEQ.main.getFontIconSize()),i)}},fontawesome5brands:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;n?r=n+o+SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize()):r=i+a-o-SEQ.metrics.data.baseSpaceMetric/2;t.save(),t.font=SEQ.main.getFontFontAwesome5Brands();var s=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontFontAwesome5Brands());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-s/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontFontAwesome5Brands()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome5Brands(),t,SEQ.main.getFontIconSize()),i)}},fontawesome5regular:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;n?r=n+o+SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize()):r=i+a-o-SEQ.metrics.data.baseSpaceMetric/2;t.save(),t.font=SEQ.main.getFontFontAwesome5Regular();var s=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontFontAwesome5Regular());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-s/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontFontAwesome5Regular()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome5Regular(),t,SEQ.main.getFontIconSize()),i)}},fontawesome5solid:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;n?r=n+o+SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize()):r=i+a-o-SEQ.metrics.data.baseSpaceMetric/2;t.save(),t.font=SEQ.main.getFontFontAwesome5Solid();var s=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontFontAwesome5Solid());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-s/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontFontAwesome5Solid()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome5Solid(),t,SEQ.main.getFontIconSize()),i)}},fontawesome6brands:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;n?r=n+o+SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize()):r=i+a-o-SEQ.metrics.data.baseSpaceMetric/2;t.save(),t.font=SEQ.main.getFontFontAwesome6Brands();var s=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontFontAwesome6Brands());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-s/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontFontAwesome6Brands()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome6Brands(),t,SEQ.main.getFontIconSize()),i)}},fontawesome6regular:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;n?r=n+o+SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize()):r=i+a-o-SEQ.metrics.data.baseSpaceMetric/2;t.save(),t.font=SEQ.main.getFontFontAwesome6Regular();var s=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontFontAwesome6Regular());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-s/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontFontAwesome6Regular()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome6Regular(),t,SEQ.main.getFontIconSize()),i)}},fontawesome6solid:{paint:function(t,e,i,a,n){var r,o=e.longNameTextData?e.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding;n?r=n+o+SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome(),e.iconUnicode,SEQ.main.getFontIconSize()):r=i+a-o-SEQ.metrics.data.baseSpaceMetric/2;t.save(),t.font=SEQ.main.getFontFontAwesome6Solid();var s=SEQ.metrics.calcWidth(e.iconUnicode,SEQ.main.getFontFontAwesome6Solid());e.styling.fillColor&&(t.fillStyle=e.styling.fillColor),t.fillText(e.iconUnicode,e.posX-s/2,r),t.restore()},width:function(t,e,i){return n(SEQ.metrics.calcWidth(t,SEQ.main.getFontFontAwesome6Solid()),e,i)},height:function(t,e,i){return r(SEQ.metrics.calcHeight(SEQ.main.getFontFontAwesome6Solid(),t,SEQ.main.getFontIconSize()),i)}},actor:{paint:function(t,a,n,r,o){var s,c=a.longNameTextData?a.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,l=SEQ.metrics.data.baseSpaceMetric,p=3.5*l,g=.57*l,d=1.22*l,m=.72*l,E=.44*l+2*g;s=o?o+c+p+SEQ.metrics.data.participantTypeLineWeight/2:n+r-c,t.save(),t.beginPath(),t.arc(a.posX,s-p+g,g,0,2*Math.PI),t.moveTo(a.posX,s-p+2*g),t.lineTo(a.posX,s-p+2*g+d),t.moveTo(a.posX-m,s-p+E),t.lineTo(a.posX+m,s-p+E),t.moveTo(a.posX,s-p+2*g+d),t.lineTo(a.posX-m,s),t.moveTo(a.posX,s-p+2*g+d),t.lineTo(a.posX+m,s),e(a,t),i(a,t),t.restore()},width:function(t,e,i){return n(.72*SEQ.metrics.data.baseSpaceMetric*2,e,i)},height:function(t,e,i){return r(3.5*SEQ.metrics.data.baseSpaceMetric+SEQ.metrics.data.participantTypeLineWeight/2,i)}},boundary:{paint:function(t,n,r,o,s){var c,l=n.styling.lineWeight?SEQ.main.getLineWeightParticipantType(n.styling.lineWeight):SEQ.metrics.data.participantTypeLineWeight,p=n.longNameTextData?n.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,g=a();c=s?s+p+g/2+SEQ.metrics.data.participantTypeLineWeight/2+SEQ.metrics.data.participantTypeLineWeight/2:o+r-p-g/2-SEQ.metrics.data.participantTypeLineWeight/2;var d=g/2,m=SEQ.metrics.data.baseSpaceMetric/2;t.save(),t.beginPath(),t.arc(n.posX+m,c,d,0,2*Math.PI),t.moveTo(n.posX-d-m+l/2,c-d-l/2),t.lineTo(n.posX-d-m+l/2,c+d+l/2),t.moveTo(n.posX-d-m,c),t.lineTo(n.posX-d+m,c),e(n,t),i(n,t),t.restore()},width:function(t,e,i){return n(a()+SEQ.metrics.data.baseSpaceMetric/2+SEQ.metrics.data.participantTypeLineWeight,e,i)},height:function(t,e,i){return r(a()+SEQ.metrics.data.participantTypeLineWeight,i)}},control:{paint:function(t,n,r,o,s){var c,l=n.longNameTextData?n.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,p=a(),g=p/2,d=.6*SEQ.metrics.data.baseSpaceMetric,m=SEQ.metrics.data.baseSpaceMetric/2,E=n.posX-.2*SEQ.metrics.data.baseSpaceMetric;c=s?s+l+p/2+SEQ.metrics.data.participantTypeLineWeight/2+m:o+r-l-p/2-SEQ.metrics.data.participantTypeLineWeight/2,t.save(),t.beginPath(),t.arc(n.posX,c,g,0,2*Math.PI),t.moveTo(E,c-g),t.lineTo(E+d,c-g-m),t.moveTo(E,c-g),t.lineTo(E+d,c-g+m),e(n,t),i(n,t),t.restore()},width:function(t,e,i){return n(a()+SEQ.metrics.data.participantTypeLineWeight,e,i)},height:function(t,e,i){return r(a()+SEQ.metrics.data.participantTypeLineWeight+SEQ.metrics.data.baseSpaceMetric/2,i)}},entity:{paint:function(t,n,r,o,s){var c,l=n.styling.lineWeight?SEQ.main.getLineWeightParticipantType(n.styling.lineWeight):SEQ.metrics.data.participantTypeLineWeight,p=n.longNameTextData?n.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,g=a();c=s?s+p+g/2+SEQ.metrics.data.participantTypeLineWeight/2+SEQ.metrics.data.participantTypeLineWeight:o+r-p-g/2-SEQ.metrics.data.participantTypeLineWeight/2;var d=g/2;t.save(),t.beginPath(),t.arc(n.posX,c-.8*l,d,0,2*Math.PI),t.moveTo(n.posX-d-l/2,c+d),t.lineTo(n.posX+d+l/2,c+d),e(n,t),i(n,t),t.restore()},width:function(t,e,i){return n(a()+SEQ.metrics.data.participantTypeLineWeight,e,i)},height:function(t,e,i){return r(a()+1.8*SEQ.metrics.data.participantTypeLineWeight,i)}},database:{paint:function(a,n,r,o,s){var c,l=n.longNameTextData?n.longNameTextData.height:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding,p=SEQ.metrics.data.baseSpaceMetric,g=3.42*p,d=.66*p,m=2.92*p,E=1.46*p;c=s?s+l+g+SEQ.metrics.data.participantTypeLineWeight:r+o-l;var u=.073*p;a.save(),a.beginPath(),a.moveTo(n.posX-m/2,c-d),a.lineTo(n.posX-m/2,c-g+d),a.lineTo(n.posX+m/2,c-g+d),a.lineTo(n.posX+m/2,c-d),e(n,a),i(n,a),a.beginPath(),t(a,n.posX,c-g+d-u,E,d,0,0,2*Math.PI),t(a,n.posX,c-d-u,E,d,0,0,Math.PI),e(n,a),i(n,a),a.restore()},width:function(t,e,i){return n(4*SEQ.metrics.data.baseSpaceMetric,e,i)},height:function(t,e,i){return r(3.42*SEQ.metrics.data.baseSpaceMetric+SEQ.metrics.data.participantTypeLineWeight,i)}},rparticipant:{paint:function(t,a,n,r,o){var s;s=o||r+n-a.height+SEQ.metrics.data.participantTypeLineWeight;var c=a.width,l=a.posX-c/2,p=a.height-SEQ.metrics.data.participantTypeLineWeight,g=s+p,d=SEQ.metrics.data.boxBleed;t.beginPath(),t.save(),t.moveTo(l,g-p+d),t.arc(l+d,g-p+d,d,Math.PI,-Math.PI/2),t.lineTo(l+c-d,g-p),t.arc(l+c-d,g-p+d,d,-Math.PI/2,0),t.lineTo(l+c,g-d),t.arc(l+c-d,g-d,d,0,Math.PI/2),t.lineTo(l+d,g),t.arc(l+d,g-d,d,Math.PI/2,Math.PI),t.lineTo(l,g-p+d),e(a,t),i(a,t),t.restore()},width:function(t,e,i){return(i?i.width:SEQ.metrics.calcWidth(e))+2*SEQ.metrics.data.participantPadding+SEQ.metrics.data.participantTypeLineWeight},height:function(t,e,i){return i?i.height+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantBoxLineWeight:SEQ.metrics.data.textLineHeight+SEQ.metrics.data.textTopBottomPadding+2*SEQ.metrics.data.participantTopBottomPadding+SEQ.metrics.data.participantTypeLineWeight},rparticipant:!0}}}(),(SEQ=SEQ||{}).googleDrive=function(){const t="128530462773-5utfp5o2q8tt52ctbod1snqs8l509rkg.apps.googleusercontent.com",e="https://www.googleapis.com/auth/drive.file",i="AIzaSyCQ7DbuqBVp2WoBgS4AX64N2g5PbtYUSjc",a="https://www.googleapis.com/drive/v3/files",n="https://www.googleapis.com/upload/drive/v3/files";var r=null,o=null,s=null,c=null,l=null,p=t=>{console.log("got unexpected callback")},g=t=>{SEQ.menu.displayNotification("Got unexpected error callback",!1,"notificationError","notificationCenter"),console.log("got unexpected error callback",t)};function d(t){t.action==google.picker.Action.PICKED?(SEQ.menu.displayNotification("Connecting to Google Drive",!0,"notificationInfo","notificationRight"),u(function(e){SEQ.menu.displayNotification("Loading file",!0);var i={method:"GET",headers:new Headers({Authorization:"Bearer "+e})},r=SEQ.main.validateName(t.docs[0].name),o=a+"/"+t.docs[0].id+"?alt=media&supportsTeamDrives=true";fetch(o,i).then(function(e){e.ok?e.text().then(function(e){var i=SEQ.main.validateSource(e),a=r.replace(".txt","").replace(".sduml",""),o=n+"/"+t.docs[0].id+"?supportsTeamDrives=true";SEQ.menu.clearNotification(),SEQ.saveAndOpen.newActiveFile(a,SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE,o,i)}):(404===e.status?SEQ.menu.displayNotification("No permission to open file "+r+", only files you created with the tool may be opened",!1,"notificationError","notificationCenter"):SEQ.menu.displayNotification("Failed to open ("+e.status+") "+r,!1,"notificationError","notificationCenter"),console.log(e))})})):SEQ.menu.clearNotification()}function m(t){t.action==google.picker.Action.PICKED?(u(function(e){E(e,r,t.docs[0].id)}),r=null):SEQ.menu.clearNotification()}function E(t,e,i){var a=SEQ.main.validateName(e);SEQ.menu.clearNotification(),SEQ.saveAndOpen.displaySaving(a,SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE);var r=[];i&&r.push(i);var o={method:"POST",headers:new Headers({Authorization:"Bearer "+t,"Content-Type":"application/json; charset=UTF-8","X-Upload-Content-Type":"text/plain"}),body:JSON.stringify({name:a+".txt",mimeType:"text/plain",parents:r})};fetch(n+"?uploadType=resumable&supportsTeamDrives=true",o).then(function(e){if(e.ok){var i=e.headers.get("Location"),a=SEQ.main.getSourceValue(),r={method:"PUT",headers:new Headers({Authorization:"Bearer "+t,"Content-Type":"plain/text","Content-Length":a.length}),body:a};fetch(i,r).then(function(t){t.ok?t.json().then(function(t){var e=SEQ.main.validateName(t.name.replace(".txt","").replace(".sduml","")),i=n+"/"+t.id+"?supportsTeamDrives=true";SEQ.saveAndOpen.newActiveFile(e,SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE,i)}):(SEQ.saveAndOpen.displaySavingFailed(t.status+" "+t.statusText),console.log(t))})}else SEQ.saveAndOpen.displaySavingFailed(e.status+" "+e.statusText),console.log(e)})}function u(t){(c?c.expires_in-Math.floor((Date.now()-l)/1e3):0)>=60?t(c.access_token):(s.callback=function(e){c=e,l=Date.now(),t(c.access_token)},s.requestAccessToken())}function S(){o=null}function f(i){if("undefined"!=typeof google&&"undefined"!=typeof gapi)i();else{SEQ.menu.displayNotification("Loading Google APIs...",!0,"notificationInfo","notificationCenter");var a=[];a.push(SEQ.main.require("https://accounts.google.com/gsi/client")),a.push(SEQ.main.require("https://apis.google.com/js/api.js")),Promise.all(a).then(function(){s=google.accounts.oauth2.initTokenClient({client_id:t,scope:e,callback:p,error_callback:g}),gapi.load("picker",function(){}),SEQ.menu.clearNotification(),i()}).catch(function(){SEQ.menu.displayNotification("Failed to load Google APIs",!1,"notificationError","notificationCenter")})}}return{loadGoogleDrive:function(){f(function(){var t=SEQ.main.getUrlVars(),e=t.googleDriveAction;e&&("open"===e?function(t){SEQ.menu.displayNotification("Connecting to Google Drive",!0,"notificationInfo","notificationRight");var e=a+"/"+t+"?supportsTeamDrives=true";u(function(i){SEQ.menu.displayNotification("Loading file",!0);var r={method:"GET",headers:new Headers({Authorization:"Bearer "+i})};fetch(e,r).then(function(e){e.ok?e.text().then(function(e){var i=JSON.parse(e),o=SEQ.main.validateName(i.name.replace(".txt","").replace(".sduml",""));fetch(a+"/"+t+"?alt=media&supportsTeamDrives=true",r).then(function(e){e.ok?e.text().then(function(e){var i=SEQ.main.validateSource(e),a=n+"/"+t+"?supportsTeamDrives=true";SEQ.menu.clearNotification(),SEQ.saveAndOpen.newActiveFile(o,SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE,a,i)}):(404===e.status?SEQ.menu.displayNotification("No permission to open file "+o+", only files you created with the tool may be opened",!1,"notificationError","notificationCenter"):SEQ.menu.displayNotification("Failed to open ("+e.status+") "+o,!1,"notificationError","notificationCenter"),console.log(e))})}):(404===e.status?SEQ.menu.displayNotification("No permission to open file "+t+", only files you created with the tool may be opened",!1,"notificationError","notificationCenter"):SEQ.menu.displayNotification("Failed to open ("+e.status+") "+t,!1,"notificationError","notificationCenter"),console.log(e))})})}(t.googleDriveFileId):"create"===e&&(o=t.googleDriveFolderId,document.getElementById("activeFileStorageStatus").textContent=SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE))})},open:function(){f(function(){SEQ.menu.displayNotification("Connecting to Google Drive",!0,"notificationInfo","notificationRight"),u(function(t){!function(t){const e=new google.picker.DocsView(google.picker.ViewId.DOCUMENTS).setIncludeFolders(!0).setSelectFolderEnabled(!1),a=new google.picker.DocsView(google.picker.ViewId.DOCUMENTS).setIncludeFolders(!0).setSelectFolderEnabled(!1).setEnableTeamDrives(!0);(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.SUPPORT_TEAM_DRIVES).addView(e).addView(a).setOAuthToken(t).setDeveloperKey(i).setCallback(d).setOrigin(window.location.protocol+"//"+window.location.host).build().setVisible(!0)}(t)})})},saveInRoot:function(t){f(function(){S(),SEQ.menu.displayNotification("Connecting to Google Drive",!0,"notificationInfo","notificationRight"),u(function(e){E(e,t)})})},saveAs:function(t){f(function(){SEQ.menu.displayNotification("Connecting to Google Drive",!0,"notificationInfo","notificationRight"),r=t,u(function(t){!function(t){const e=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setIncludeFolders(!0).setSelectFolderEnabled(!0),a=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setIncludeFolders(!0).setSelectFolderEnabled(!0).setEnableTeamDrives(!0);(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.SUPPORT_TEAM_DRIVES).addView(e).addView(a).setTitle('Select a folder (or Cancel and click "Save in Root Folder" button instead)').setOAuthToken(t).setDeveloperKey(i).setCallback(m).setOrigin(window.location.protocol+"//"+window.location.host).build().setVisible(!0)}(t)})})},saveDirectly:function(t){SEQ.saveAndOpen.displaySaving(t.diagramName,SEQ.saveAndOpen.StorageProvider.GOOGLE_DRIVE);var e=SEQ.main.getSourceValue();u(function(i){!function(i){var a={method:"PATCH",body:e,headers:new Headers({Authorization:"Bearer "+i,"Content-Type":"text/plain"})};fetch(t.resourceUrl,a).then(function(t){t.ok?SEQ.saveAndOpen.displaySaved():(SEQ.saveAndOpen.displaySavingFailed(t.status+" "+t.statusText),console.log(t))})}(i)})},saveDirectlyInPreSelectedFolder:function(t){SEQ.menu.displayNotification("Connecting to Google Drive",!0,"notificationInfo","notificationRight"),u(function(e){E(e,t,o)}),S()},preSelectedFolder:function(){return!!o},clearPreSelectedFolder:S}}(),(SEQ=SEQ||{}).oneDrive=function(){const t="57e1591f-d474-4b1b-90ca-53897268b441",e="9188040d-6c67-4c5b-b112-36a304b66dad",i=["User.Read","Files.ReadWrite.All"];var a;function n(i,n){var r=SEQ.main.validateName(n),s=a.getUser().idToken,c={clientId:t,action:"save",accountSwitchEnabled:!1,sourceUri:"data:text/plain;base64,"+btoa(SEQ.main.getSourceValue()),fileName:r+".txt",advanced:{accessToken:i,loginHint:s.preferred_username,isConsumerAccount:s.iss.indexOf(e)>-1},success:function(t){var e=o(t);SEQ.saveAndOpen.newActiveFile(r,SEQ.saveAndOpen.StorageProvider.ONE_DRIVE,e)},cancel:function(){SEQ.menu.displayNotification("Cancelled",!1,"notificationInfo","notificationRight")},error:function(t){SEQ.saveAndOpen.displaySavingFailed(t),console.log(t)}};OneDrive.save(c),SEQ.menu.clearNotification()}function r(t,e){a.acquireTokenSilent(i).then(function(i){t(i,e)},function(n){console.log("AcquireTokenSilent Failure, trying interactive",n),a.acquireTokenPopup(i).then(function(i){t(i,e)},function(t){SEQ.menu.displayNotification(t,!1,"notificationError","notificationCenter"),console.log(t)})})}function o(t){return t.apiEndpoint+"/me/drive/items/"+t.value[0].id+"/content"}function s(i){var n=a.getUser().idToken,r={clientId:t,action:"query",accountSwitchEnabled:!1,advanced:{accessToken:i,loginHint:n.preferred_username,isConsumerAccount:n.iss.indexOf(e)>-1,filter:".txt,.sduml"},success:function(t){SEQ.menu.displayNotification("Loading file",!0,"notificationInfo","notificationRight");var e={method:"GET",headers:new Headers({Authorization:"Bearer "+i})},a=o(t);fetch(a,e).then(function(t){t.ok?t.text().then(function(e){var i=SEQ.main.validateSource(e);SEQ.menu.clearNotification();var n=t.url.split("/"),r=n[n.length-1],o=decodeURIComponent(r.replace(".txt","").replace(".sduml","")),s=SEQ.main.validateName(o);SEQ.menu.clearNotification(),SEQ.saveAndOpen.newActiveFile(s,SEQ.saveAndOpen.StorageProvider.ONE_DRIVE,a,i)}):(SEQ.menu.displayNotification("Failed to load selected file: "+t.status+" "+t.statusText,!1,"notificationError","notificationCenter"),console.log(t))})},cancel:function(){SEQ.menu.displayNotification("Cancelled",!1,"notificationInfo","notificationRight")},error:function(t){SEQ.menu.displayNotification(t,!1,"notificationError","notificationCenter"),console.log(t)}};OneDrive.open(r),SEQ.menu.clearNotification()}function c(e){if(void 0!==a)e();else{SEQ.menu.displayNotification("Loading OneDrive APIs...",!0,"notificationInfo","notificationCenter");var i=[];i.push(SEQ.main.require("https://alcdn.msauth.net/lib/0.2.4/js/msal.min.js")),i.push(SEQ.main.require("https://js.live.net/v7.2/OneDrive.js")),Promise.all(i).then(function(){a=new Msal.UserAgentApplication(t,null,null),SEQ.menu.clearNotification(),e()}).catch(function(){SEQ.menu.displayNotification("Failed to load OneDrive APIs",!1,"notificationError","notificationCenter")})}}return{loadOneDrive:function(){c(function(){})},init:function(){a=new Msal.UserAgentApplication(t,null,null)},open:function(){c(function(){SEQ.menu.displayNotification("Connecting to OneDrive",!0,"notificationInfo","notificationRight"),a.getUser()?r(s):a.loginPopup(i).then(function(){r(s)},function(t){SEQ.menu.displayNotification(t,!1,"notificationError","notificationCenter"),console.log(t)})})},saveAs:function(t){c(function(){SEQ.menu.displayNotification("Connecting to OneDrive",!0,"notificationInfo","notificationRight"),a.getUser()?r(n,t):a.loginPopup(i).then(function(){r(n,t)},function(t){SEQ.menu.displayNotification(t,!1,"notificationError","notificationCenter"),console.log(t)})})},saveDirectly:function(t){SEQ.saveAndOpen.displaySaving(t.diagramName,SEQ.saveAndOpen.StorageProvider.ONE_DRIVE);var e=SEQ.main.getSourceValue();r(function(i){var a={method:"PUT",body:e,headers:new Headers({Authorization:"Bearer "+i,"Content-Type":"text/plain"})};fetch(t.resourceUrl,a).then(function(t){t.ok?SEQ.saveAndOpen.displaySaved():(SEQ.saveAndOpen.displaySavingFailed(t.status+" "+t.statusText),console.log(t))})})}}}(),(SEQ=SEQ||{}).webStorage=function(){const t="SAVED_DIAGRAMS";function e(){for(var t=document.getElementById("webStorageDiagramTableTBody");t.firstChild;)t.removeChild(t.firstChild);var e=a();e.length&&e.forEach(function(e){var i=SEQ.main.validateName(e.name),a=r(i),n=SEQ.main.validateSource(a.source),o=document.createElement("tr"),c=document.createElement("td");c.className="webStorageCheckbox",c.textContent="☐",c["data-diagram-name"]=i,o.appendChild(c),o.onclick=function(){"☐"==c.textContent?c.textContent="☑":c.textContent="☐",s()},o.addEventListener("dblclick",function(){SEQ.saveAndOpen.newActiveFile(e.name,SEQ.saveAndOpen.StorageProvider.WEB_STORAGE,null,n),SEQ.main.closePopups()});var l=document.createElement("td");l.textContent=i,o.appendChild(l);var p=document.createElement("td");p.textContent=SEQ.main.validateTimeStamp(e.modified),o.appendChild(p);var g=document.createElement("td");g.textContent=n.length+" bytes",o.appendChild(g),t.appendChild(o)}),s()}function i(t){SEQ.saveAndOpen.displaySaving(t,SEQ.saveAndOpen.StorageProvider.WEB_STORAGE);var e=SEQ.main.getSourceValue(),i=new Date,r=i.toLocaleDateString()+" "+i.toLocaleTimeString(),o=a(),s=null;if(o.forEach(function(e){SEQ.main.validateName(e.name)==t&&(s=e)}),s)s.source=e,s.modified=r;else{var c=SEQ.main.validateName(t);o.unshift({name:c,modified:r,source:e})}n(o)}function a(){var e=localStorage.getItem(t);return JSON.parse(e)}function n(e){localStorage.setItem(t,JSON.stringify(e))}function r(t){var e=null;return a().forEach(function(i){SEQ.main.validateName(i.name)==t&&(e=i)}),e}function o(){for(var t=[],e=document.getElementById("webStorageDiagramTable").getElementsByClassName("webStorageCheckbox"),i=0;i<e.length;i++)if("☑"==e[i].textContent){var a=SEQ.main.validateName(e[i]["data-diagram-name"]);t.push(a)}return t}function s(){var t=o().length;document.getElementById("webStorageOpen").disabled=1!=t,document.getElementById("webStorageDelete").disabled=t<=0}return{init:function(){if(!localStorage.getItem(t)){for(var e=[],i=0;i<localStorage.length;i++){var a=localStorage.key(i);-1===a.indexOf("SEQUENCE_DIAGRAM_ORG_INTERNAL")&&-1===a.indexOf("USER_SETTINGS")&&-1===a.indexOf("odpicker")&&e.push({name:a.replace(".txt",""),modified:"Unknown",source:localStorage.getItem(a)})}localStorage.setItem(t,JSON.stringify(e))}},open:function(){e(),document.getElementById("cover").style.display="flex",document.getElementById("webStoragePopup").style.display="block"},saveAs:function(t){i(t),SEQ.saveAndOpen.newActiveFile(t,SEQ.saveAndOpen.StorageProvider.WEB_STORAGE)},saveDirectly:function(t){i(t.diagramName),SEQ.saveAndOpen.displaySaved()},toggleWebStorageSelection:function(t){var e=document.getElementById("webStorageDiagramTable").getElementsByClassName("webStorageCheckbox");"☐"==t.textContent?t.textContent="☑":t.textContent="☐";for(var i=0;i<e.length;i++)e[i].textContent=t.textContent;s()},openSelected:function(){var t=r(o()[0]),e=SEQ.main.validateSource(t.source),i=SEQ.main.validateName(t.name);SEQ.saveAndOpen.newActiveFile(i,SEQ.saveAndOpen.StorageProvider.WEB_STORAGE,null,e),SEQ.main.closePopups()},deleteSelected:function(){var t,i=o();if(t=1==i.length?"Are you sure you want to delete "+i[0]+"?":"Are you sure you want to delete "+i.length+" diagrams?",confirm(t)){var r=[];a().forEach(function(t){var e=SEQ.main.validateName(t.name);i.indexOf(e)>-1||r.push(t)}),n(r),e()}}}}(),(SEQ=SEQ||{}).localDisk=function(){function t(t){var e=SEQ.main.validateName(t)+".txt",i=SEQ.main.getSourceValue();-1!=navigator.appVersion.indexOf("Win")&&(i=i.replace(/\n/g,"\r\n"));var a=new Blob([i],{type:"text/plain"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,e);else{var n=document.createElement("a");n.download=e,n.textContent="download source",n.onclick=function(t){document.body.removeChild(t.target)};var r=window.URL||window.webkitURL;n.href=r.createObjectURL(a),n.style.display="none",document.body.appendChild(n),n.click()}}return{open:function(t){var e=t.files;if(window.File&&window.FileReader&&window.FileList&&window.Blob){var i=e[0],a=SEQ.main.validateName(i.name),n=new FileReader;n.onload=function(e){var i,n;if(t.form.reset(),a.endsWith(".txt")||a.endsWith(".sduml"))i=a.replace(".txt","").replace(".sduml",""),n=SEQ.main.validateSource(e.target.result);else if(a.endsWith(".svg")){i=a.replace(".svg","");var r=(new DOMParser).parseFromString(e.target.result,"image/svg+xml").firstChild.firstChild;"desc"==r.nodeName&&r.firstChild.nodeValue&&r.firstChild.nodeValue.includes("%")?n=SEQ.main.validateSource(decodeURIComponent(r.firstChild.nodeValue)):SEQ.menu.displayNotification("No source text found. Only image/svg+xml exported from SequenceDiagram.org with source text can be opened.",!1,"notificationError","notificationCenter")}SEQ.saveAndOpen.newActiveFile(i,SEQ.saveAndOpen.StorageProvider.LOCAL_DISK,null,n)},a.endsWith(".txt")||a.endsWith(".sduml")||a.endsWith(".svg")?n.readAsText(i):(SEQ.menu.displayNotification("Only .txt, .sduml, or .svg exported from SequenceDiagram.org with source text can be opened.",!1,"notificationError","notificationCenter"),t.form.reset())}else SEQ.menu.displayNotification("The JavaScript file APIs are not fully supported in this browser.",!1,"notificationError","notificationCenter")},saveAs:function(e){t(e),SEQ.saveAndOpen.newActiveFile(e,SEQ.saveAndOpen.StorageProvider.LOCAL_DISK,"resourceUrl")},saveDirectly:function(e){t(e.diagramName),SEQ.saveAndOpen.displaySaved()}}}(),(SEQ=SEQ||{}).fileSystem=function(){const t={types:[{description:"sequence diagram (.txt, .svg, .sduml)",accept:{"image/svg+xml":[".svg"],"text/plain":[".txt",".sduml"]}}],excludeAcceptAllOption:!0,multiple:!1};function e(){var t=SEQ.main.getSourceValue();return-1!=navigator.appVersion.indexOf("Win")&&(t=t.replace(/\n/g,"\r\n")),t}return{open:async function(){try{let[r]=await window.showOpenFilePicker(t);const o=await r.getFile(),s=await o.text();var e,i,a=SEQ.main.validateName(r.name);if(a.endsWith(".txt"))e=a.replace(".txt",""),i=SEQ.main.validateSource(s);else if(a.endsWith(".sduml"))e=a.replace(".sduml",""),i=SEQ.main.validateSource(s);else if(a.endsWith(".svg")){e=a.replace(".svg","");var n=(new DOMParser).parseFromString(s,"image/svg+xml").firstChild.firstChild;"desc"==n.nodeName&&n.firstChild.nodeValue&&n.firstChild.nodeValue.includes("%")?i=SEQ.main.validateSource(decodeURIComponent(n.firstChild.nodeValue)):SEQ.menu.displayNotification("No diagram source text found. Only image/svg+xml exported from SequenceDiagram.org with diagram source text embedded can be opened.",!1,"notificationError","notificationCenter")}SEQ.saveAndOpen.newActiveFile(e,SEQ.saveAndOpen.StorageProvider.FILE_SYSTEM,null,i,r)}catch(t){console.log(t)}},saveAs:async function(t){let i=e();var a=SEQ.main.validateName(t);try{let t=await window.showSaveFilePicker({suggestedName:a+".txt",types:[{description:"sequence diagram (.txt, .sduml)",accept:{"text/plain":[".txt",".sduml"]}}]});const e=await t.createWritable();await e.write(i),await e.close();let n=SEQ.main.validateName(t.name.replace(".txt","").replace(".sduml",""));SEQ.saveAndOpen.newActiveFile(n,SEQ.saveAndOpen.StorageProvider.FILE_SYSTEM,"resourceUrl",null,t)}catch(t){console.log(t)}},saveDirectly:async function(t,i){var a;let n=t.fileHandle;n.name.indexOf(".txt")>-1||n.name.indexOf(".sduml")>-1?a=e():n.name.indexOf(".svg")>-1&&(a=await SEQ.saveAndOpen.generateSvgData());try{const t=await n.createWritable();await t.write(a),await t.close(),SEQ.saveAndOpen.displaySaved()}catch(t){i&&SEQ.menu.displayNotification("Autosave failed, save once manually after opening the file to grant permission for autosave.",!1,"notificationError","notificationCenter"),console.log(t)}},handleNotSupportNotification:function(t){if(!window.showOpenFilePicker){var e='File System Access API not supported by your browser, use "'+t+'" or switch to Chrome, Edge, or Opera.';throw SEQ.menu.displayNotification(e,!1,"notificationError","notificationCenter"),e}}}}(),(SEQ=SEQ||{}).saveAndOpen=function(){const t={GOOGLE_DRIVE:"Google Drive",GOOGLE_DRIVE_ROOT_FOLDER:"Google Drive Root Folder",ONE_DRIVE:"OneDrive",FILE_SYSTEM:"File System",LOCAL_DISK:"Local Disk",WEB_STORAGE:"Web Storage"};var e,i={};function a(){var t=SEQ.main.validateName(document.getElementById("activeFileNameChange").value);t!=i.diagramName&&o(t),v()}function n(){return SEQ.menu.readAlertForUnsavedChanges()&&(i.hash&&i.hash!=y(SEQ.main.getSourceValue())||!i.hash&&"865703748"!=y(SEQ.main.getSourceValue()))&&!SEQ.main.currentDataIsSameAsInitialDataInUrl()}function r(t,e){document.getElementById("activeFileNameStatus")&&document.getElementById("activeFileStorageStatus")&&(document.getElementById("activeFileNameStatus").textContent=t,document.getElementById("activeFileStorageStatus").textContent=e)}function o(t){i={diagramName:t},document.title=i.diagramName+" - SequenceDiagram.org",r(i.diagramName,"Not saved")}function s(){return i.diagramName?i.diagramName:"Untitled"}function c(){var t=SEQ.main.validateName(document.getElementById("fileName").value);return t||s()}function l(){var t=SEQ.main.validateName(document.getElementById("fileNameExport").value);return t||s()}function p(){SEQ.main.isIntellijIntegration()||SEQ.menu.displayNotification("Generating SVG image",!0,"notificationInfo","notificationRight");var t=SEQ.main.getSourceValue(),e=encodeURIComponent(t),i=SEQ.main.getDiagramCanvas(),a={width:i.width,height:i.height,enableMirroring:!1,desc:e},n=new C2S(a);SEQ.main.setCanvasToSvgContext(n);var r=SEQ.main.getForegroundColor(),o=SEQ.main.getBackgroundColor(),s=SEQ.main.getHighlightColor();SEQ.main.setForegroundColor(null),SEQ.main.setBackgroundColor(null),SEQ.main.setHighlightColor(null);const c=new Promise(t=>{SEQ.parser.registerParseCompletionCallback(function(){var e=n.getSerializedSvg(),i=SEQ.metrics.getCanvasSize();SEQ.main.setCanvasToSvgContext(null),SEQ.main.setForegroundColor(r),SEQ.main.setBackgroundColor(o),SEQ.main.setHighlightColor(s),SEQ.parser.parse();const a=new DOMParser,c=a.parseFromString(e,"image/svg+xml");c.documentElement.setAttribute("width",i.width),c.documentElement.setAttribute("height",i.height),c.querySelectorAll('image[*|href^="data:image/svg+xml"]').forEach(t=>{const e=t.getAttribute("xlink:href"),i=decodeURIComponent(e.split(",")[1]),n=a.parseFromString(i,"image/svg+xml").documentElement;n.setAttribute("width",t.getAttribute("width")),n.setAttribute("height",t.getAttribute("height"));var r=t.getAttribute("transform"),o=new RegExp("^translate\\(([0-9.]{1,100}),\\s?([0-9.]{1,100})\\)$").exec(r);o&&o.length>2&&(n.setAttribute("x",o[1]),n.setAttribute("y",o[2])),t.parentNode.replaceChild(n,t)});var l=(new XMLSerializer).serializeToString(c);SEQ.main.isIntellijIntegration()||SEQ.menu.clearNotification(),t(l)})});return SEQ.parser.parse(null,null,!0),c}function g(t){return function(t){const e=Array.from(t,t=>String.fromCodePoint(t)).join("");return btoa(e)}((new TextEncoder).encode(t))}function d(){var t=SEQ.main.getForegroundColor(),e=SEQ.main.getBackgroundColor(),i=SEQ.main.getHighlightColor();SEQ.main.setForegroundColor(null),SEQ.main.setBackgroundColor(null),SEQ.main.setHighlightColor(null),SEQ.parser.parse();var a=m();return SEQ.main.setForegroundColor(t),SEQ.main.setBackgroundColor(e),SEQ.main.setHighlightColor(i),SEQ.parser.parse(),a}function m(){return SEQ.main.getDiagramCanvas().toDataURL("image/png")}function E(){SEQ.menu.hideAllActionMenus(),SEQ.oneDrive.open()}function u(){SEQ.menu.hideAllActionMenus(),SEQ.googleDrive.open()}function S(){SEQ.menu.hideAllActionMenus(),SEQ.webStorage.open()}function f(){SEQ.fileSystem.handleNotSupportNotification("File Reader (for legacy browsers)"),SEQ.menu.hideAllActionMenus(),SEQ.fileSystem.open()}function h(a){if(e);else if(t.ONE_DRIVE==i.storageProvider)SEQ.oneDrive.saveDirectly(i);else if(SEQ.googleDrive.preSelectedFolder())SEQ.googleDrive.saveDirectlyInPreSelectedFolder(s());else if(t.GOOGLE_DRIVE==i.storageProvider)SEQ.googleDrive.saveDirectly(i);else if(t.WEB_STORAGE==i.storageProvider)SEQ.webStorage.saveDirectly(i);else if(t.FILE_SYSTEM==i.storageProvider)SEQ.fileSystem.handleNotSupportNotification("Download"),SEQ.fileSystem.saveDirectly(i,a);else if(t.LOCAL_DISK==i.storageProvider)a||SEQ.localDisk.saveDirectly(i);else if(!a){var n=SEQ.menu.readDefaultStorageLocation();SEQ.menu.displayNotification("New file default storage: "+n,!1,"notificationInfo","notificationRight"),t.ONE_DRIVE==n?SEQ.oneDrive.saveAs(s()):t.GOOGLE_DRIVE==n?SEQ.googleDrive.saveAs(s()):t.GOOGLE_DRIVE_ROOT_FOLDER==n?SEQ.googleDrive.saveInRoot(s()):t.WEB_STORAGE==n?SEQ.webStorage.saveAs(s()):t.FILE_SYSTEM==n?SEQ.fileSystem.saveAs(s()):t.LOCAL_DISK==n&&SEQ.localDisk.saveAs(s())}}function y(t){var e,i=0;if(0===t.length)return i;for(e=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return i}function Q(){var t=new Date;document.getElementById("activeFileStorageStatus").textContent="Saved to "+i.storageProvider+" - "+t.toLocaleDateString()+" "+t.toLocaleTimeString(),i.hash=y(SEQ.main.getSourceValue())}function v(){document.getElementById("activeFileNameChange")&&document.getElementById("activeFileNameStatus")&&(document.getElementById("activeFileNameChange").style.display="none",document.getElementById("activeFileNameStatus").style.display="inline")}return{init:function(){window.addEventListener("beforeunload",function(t){n()&&(t.preventDefault(),t.returnValue="")}),setInterval(function(){SEQ.menu.readAutosave()&&n()&&h(!0)},6e5),document.addEventListener("mousedown",function(t){var e=document.getElementById("activeFileNameChange");"activeFileNameChange"!=t.target.id&&"none"!=e.style.display&&a()}),document.getElementById("activeFileNameChange").addEventListener("keydown",function(t){13==t.keyCode&&a()})},showOpenMenu:function(t){var e=document.getElementById("openSourceMenu");if("block"==e.style.display)e.style.display="none";else{SEQ.menu.hideAllActionMenus();var i=t.getBoundingClientRect();e.style.top=i.top+"px",e.style.left=i.right+"px",e.style.display="block"}},showSaveMenu:function(t){var e=document.getElementById("saveSourceMenu");if("block"==e.style.display)e.style.display="none";else{SEQ.menu.hideAllActionMenus();var i=t.getBoundingClientRect();e.style.top=i.top+"px",e.style.left=i.right+"px",e.style.display="block",document.getElementById("fileName").value=s()}},showExportMenu:function(t){var e=document.getElementById("exportDiagramMenu");if("block"==e.style.display)e.style.display="none";else{SEQ.menu.hideAllActionMenus();var i=t.getBoundingClientRect();e.style.top=i.top+"px",e.style.left=i.right+"px",e.style.display="block",document.getElementById("fileNameExport").value=s()}},saveDirectly:h,savePngHq:function(){SEQ.menu.hideAllActionMenus();var t=l()+".png",e=SEQ.main.getDiagramCanvas();if(e.msToBlob){var i=e.msToBlob();window.navigator.msSaveBlob(i,t)}else{var a=document.getElementById("downloadButtonPngLink"),n=m();a.download=t,a.href=n}},exportPngHq:async function(){SEQ.fileSystem.handleNotSupportNotification("Download"),SEQ.menu.hideAllActionMenus();var t=l(),e=SEQ.main.getDiagramCanvas();const i=await new Promise(t=>e.toBlob(t));try{var a=await window.showSaveFilePicker({suggestedName:t+".png",types:[{description:"sequence diagram (.png)",accept:{"image/png":[".png"]}}]});const e=await a.createWritable();await e.write(i),await e.close(),SEQ.menu.displayNotification("Exported to "+a.name,!1,"notificationInfo","notificationRight")}catch(t){console.log(t)}},saveSvg:async function(){SEQ.menu.hideAllActionMenus();var t=l()+".svg",e=await async function(){var t=await p();return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t)}();if(SEQ.main.getDiagramCanvas().msToBlob)SEQ.menu.displayNotification("Please use Chrome or Firefox for svg export",!1,"notificationError","notificationCenter");else{var i=document.createElement("a");i.onclick=function(t){document.body.removeChild(t.target)},i.href=e,i.download=t,i.style.display="none",document.body.appendChild(i),i.click()}},exportSvg:async function(){SEQ.fileSystem.handleNotSupportNotification("Download"),SEQ.menu.hideAllActionMenus();var t=l();try{var e=await window.showSaveFilePicker({suggestedName:t+".svg",types:[{description:"sequence diagram (.svg)",accept:{"image/svg+xml":[".svg"]}}]});const a=await e.createWritable();var i=await p();await a.write(i),await a.close(),SEQ.menu.displayNotification("Exported to "+e.name,!1,"notificationInfo","notificationRight")}catch(t){console.log(t)}},getActiveDiagramNameOrTitleName:s,getDiagramNameForExport:l,clearDiagramSaveStateAndSetNewName:o,newActiveFile:function(t,e,a,r,s){var c=!0;r&&n()&&(c=confirm("Open new diagram without saving changes?")),c&&(t&&o(t),i.storageProvider=e,i.resourceUrl=a,i.fileHandle=s,e&&(document.getElementById("activeFileStorageStatus").textContent=i.storageProvider),r?(SEQ.main.updateSource(r),SEQ.main.parse()):a&&Q(),i.hash=y(SEQ.main.getSourceValue()))},displaySaving:function(t,e){r(t,"Saving to "+e+"...")},displaySaved:Q,displaySavingFailed:function(t){document.getElementById("activeFileStorageStatus").textContent="Saving failed! ("+t+")"},StorageProvider:t,openButtonOneDrive:E,saveButtonOneDrive:function(){SEQ.menu.hideAllActionMenus(),t.ONE_DRIVE==i.storageProvider?SEQ.oneDrive.saveDirectly(i):SEQ.oneDrive.saveAs(c())},openButtonGoogleDrive:u,saveButtonGoogleDrive:function(){SEQ.menu.hideAllActionMenus(),SEQ.googleDrive.preSelectedFolder()?SEQ.googleDrive.saveDirectlyInPreSelectedFolder(c()):t.GOOGLE_DRIVE==i.storageProvider?SEQ.googleDrive.saveDirectly(i):SEQ.googleDrive.saveAs(c())},saveInRootButtonGoogleDrive:function(){SEQ.menu.hideAllActionMenus(),t.GOOGLE_DRIVE==i.storageProvider?SEQ.googleDrive.saveDirectly(i):SEQ.googleDrive.saveInRoot(c())},openButtonWebStorage:S,saveButtonWebStorage:function(){SEQ.menu.hideAllActionMenus(),t.WEB_STORAGE==i.storageProvider?SEQ.webStorage.saveDirectly(i):SEQ.webStorage.saveAs(c())},openButtonFileSystem:f,saveButtonFileSystem:function(){SEQ.fileSystem.handleNotSupportNotification("Download"),SEQ.menu.hideAllActionMenus(),t.FILE_SYSTEM==i.storageProvider?SEQ.fileSystem.saveDirectly(i):SEQ.fileSystem.saveAs(c())},saveAsButtonFileSystem:function(){SEQ.fileSystem.handleNotSupportNotification("Download"),SEQ.menu.hideAllActionMenus(),SEQ.fileSystem.saveAs(c())},openButtonLocalDisk:function(t){SEQ.menu.hideAllActionMenus(),SEQ.localDisk.open(t)},saveButtonLocalDisk:function(){SEQ.menu.hideAllActionMenus(),t.LOCAL_DISK==i.storageProvider?SEQ.localDisk.saveDirectly(i):SEQ.localDisk.saveAs(c())},showDefaultStorageOpen:function(){if(!e){var i=SEQ.menu.readDefaultStorageLocation();t.GOOGLE_DRIVE==i||t.GOOGLE_DRIVE_ROOT_FOLDER==i?u():t.ONE_DRIVE==i?E():t.LOCAL_DISK==i?(document.getElementById("openButtonLocalDisk").focus(),document.getElementById("openButtonLocalDisk").click()):t.WEB_STORAGE==i?S():t.FILE_SYSTEM==i&&f()}},newDiagram:function(){var t=!0;n()&&(t=confirm("Create new diagram without saving changes?")),t?(SEQ.googleDrive.clearPreSelectedFolder(),i={},SEQ.main.updateSource(SEQ.main.getDefaultData()),SEQ.main.parse(),document.title="SequenceDiagram.org",r("Untitled","Not saved"),SEQ.menu.displayNotification("New diagram created",!1,"notificationInfo","notificationRight")):SEQ.menu.displayNotification("Cancelled by user",!1,"notificationInfo","notificationRight")},synchronizeFileNameWithTitleIfEnabled:function(){if(SEQ.menu.readSynchronizeFilenameWithTitle()){var t=(e="Untitled",SEQ.parser.diagram.title?e=SEQ.parser.diagram.title.buildFileName():SEQ.parser.diagram.frame&&(e=SEQ.parser.diagram.frame.text),e.replace(/[\/\\?%*:|"<>,()&;#{}\[\]\^~`@=]/g,""));i.diagramName!=t&&o(t)}var e},showActiveFileNameChange:function(){var t=document.getElementById("activeFileNameStatus"),e=t.textContent,i=document.getElementById("activeFileNameChange");i.value=e,t.style.display="none",i.style.display="inline",i.select()},cancelActiveFileNameChange:v,setActiveFile:function(t){(i=t).hash=y(SEQ.main.getSourceValue())},isUnsavedChanges:n,setNoneStorageMode:function(){e=!0},generateSvgData:p,generatePngDataUrlAndCallCopyToClipboardForIntellij:function(){var t=d();SEQ.javaBridge.copyPngDataUrlToClipboard(t)},generateSvgDataUrlAndCallSaveImageForIntellij:function(){p().then(t=>{SEQ.javaBridge.saveSvgDataUrlImage(t)})},generatePngDataUrlAndCallSaveImageForIntellij:function(){var t=d();SEQ.javaBridge.savePngDataUrlImage(t)},createHash:y,generatePngBase64DataUrl:m,generateSvgBase64DataUrl:async function(){return"data:image/svg+xml;base64,"+g(await p())}}}(),(SEQ=SEQ||{}).seqDiaHint=function(){"use strict";var t=[],e=[],i=[];function a(t,e){if(t.NotePosition){for(var i in t.Type)if(t.Type.hasOwnProperty(i))for(var a in t.NotePosition)t.NotePosition.hasOwnProperty(a)&&e.push(t.Type[i]+" "+t.NotePosition[a])}else for(var n in t.Type)if(t.Type.hasOwnProperty(n)){var r=t.Type[n];e.indexOf(r)>-1||r.indexOf("fontawesome5")>-1||"fontawesome"===r||"expandable−"===r||e.push(r)}}function n(a){var n,r=a.getCursor(),o=a.getLine(r.line).substring(0,r.ch),s=[],c=r.ch,l=c;if(a.getLine(r.line).length>r.ch);else if(SEQ.entityMessage.regExpArrow.test(o)){for(;l&&">"!==o.charAt(l-1)&&"-"!==o.charAt(l-1)&&"x"!==o.charAt(l-1);)l--;n=o.slice(l,c).trim(),SEQ.parser.diagram.participants.forEach(function(t){0===t.name.lastIndexOf(n,0)&&s.push(t.name)})}else if(SEQ.parser.diagram.participantsByName[o.trim()])s=i;else{for(l=0;" "===o.charAt(l);)l++;if(0===(n=o.replace(/^\s{1,100}/,"")).length)SEQ.parser.diagram.participants.forEach(function(t){s.push(t.name)}),t.forEach(function(t){s.push(t+" ")}),e.forEach(function(t){"end"===t?s.push(t):s.push(t+" ")});else if("#"===n.charAt(0)||":"===n.charAt(n.length-1));else{var p=function(e){for(var i=0;i<t.length;i++){var a=t[i];if(0===e.replace(/^\s{1,100}/,"").lastIndexOf(a+" "))return{participantPart:e.replace(a,"").trim(),start:e.indexOf(a)+a.length+1}}return!1}(o);p?(l=p.start,SEQ.parser.diagram.participants.forEach(function(t){0===t.name.lastIndexOf(p.participantPart,0)&&s.push(t.name)})):(SEQ.parser.diagram.participants.forEach(function(t){0===t.name.lastIndexOf(n,0)&&s.push(t.name)}),t.forEach(function(t){0===t.indexOf(n.trim(),0)&&s.push(t+" ")}),e.forEach(function(t){0===t.indexOf(n.trim(),0)&&("end"===t?s.push(t):s.push(t+" "))}))}}return{list:s,from:CodeMirror.Pos(r.line,l),to:CodeMirror.Pos(r.line,c)}}return{init:function(){a(SEQ.entityNoteBoxOver,t),a(SEQ.entityNoteBoxLeftRight,t),a(SEQ.entityActivation,t),a(SEQ.entityCreateDestroy,t),a(SEQ.entityDivider,e),a(SEQ.entityParticipant,e),a(SEQ.entityParticipantGroup,e),a(SEQ.entityFragment,e),a(SEQ.entityTitle,e),a(SEQ.entityLinear,e),a(SEQ.entityParallel,e),a(SEQ.entityAutoNumber,e),a(SEQ.entityAutoActivation,e),a(SEQ.entityFontFamily,e),a(SEQ.entitySpace,e),a(SEQ.entityParticipantSpacing,e),a(SEQ.entityEntrySpacing,e),a(SEQ.entityActiveColor,e),a(SEQ.entityLifeLineStyle,e),a(SEQ.entityBottomParticipants,e),a(SEQ.entityFrame,e),a(SEQ.entityStyle,e),a(SEQ.entityMessage,i),CodeMirror.registerHelper("hint","seqdiahint",function(t){return n(t)})}}}(),(SEQ=SEQ||{}).seqDiaMode=function(){"use strict";var t={KEYWORD:"def",ACTOR:"tag",TEXT:"variable",COMMENT:"comment",ERROR:"error",ARROW:"keyword",PARAMETER:"bracket"},e=[];function i(t){if(t.sol()){for(var i=0;i<e.length;i++){var a=e[i],n=t.match(a.regExp,!1,!1);if(n)return t.seqdiaMatch=n,t.currentGroup=0,t.maxGroup=a.maxGroup,t.groupMapping=a.groupMapping,t.progressStream=a.progressStream,t.progressStream(t)}t.skipToEnd()}else{if(t.progressStream)return t.progressStream(t);t.skipToEnd()}}return{init:function(){!function(){var i=function(t){for(var e;!e&&t.currentGroup<t.maxGroup;)t.currentGroup++,e=t.seqdiaMatch[t.currentGroup];if(e)return t.pos=t.string.indexOf(e,t.pos)+e.length,t.groupMapping[t.currentGroup].style;t.skipToEnd()},a={};a.regExp=SEQ.entityMessage.regExp,a.maxGroup=SEQ.entityMessage.groups.TEXT,a.handlePartOfType=!1,a.groupMapping={},a.groupMapping[SEQ.entityMessage.groups.PARTICIPANT_1]={style:t.ACTOR},a.groupMapping[SEQ.entityMessage.groups.TYPE_RIGHT]={style:t.ARROW},a.groupMapping[SEQ.entityMessage.groups.COLOR_HEX_1]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.COLOR_NAME_1]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.WEIGHT_1]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.DELAY_RIGHT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.CREATE_RIGHT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.CREATE_LEFT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.DELAY_LEFT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.TYPE_LEFT]={style:t.ARROW},a.groupMapping[SEQ.entityMessage.groups.COLOR_HEX_2]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.COLOR_NAME_2]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.WEIGHT_2]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.CREATE_DUAL_LEFT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.TYPE_DUAL]={style:t.ARROW},a.groupMapping[SEQ.entityMessage.groups.COLOR_HEX_3]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.COLOR_NAME_3]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.WEIGHT_3]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.CREATE_DUAL_RIGHT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.PARTICIPANT_2]={style:t.ACTOR},a.groupMapping[SEQ.entityMessage.groups.TEXT]={style:t.TEXT},a.groupMapping[SEQ.entityMessage.groups.DELAY_LEFT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.DELAY_RIGHT]={style:t.PARAMETER},a.groupMapping[SEQ.entityMessage.groups.COLOR_NAME_3]={style:t.PARAMETER},a.progressStream=function(t){for(var e;!e&&t.currentGroup<t.maxGroup;)t.currentGroup++,e=t.seqdiaMatch[t.currentGroup];var i=t.groupMapping[t.currentGroup];if(t.ongoingTypeWithAttributesLength){if(t.currentGroup===SEQ.entityMessage.groups.COLOR_HEX_1||t.currentGroup===SEQ.entityMessage.groups.COLOR_NAME_1||t.currentGroup===SEQ.entityMessage.groups.COLOR_HEX_2||t.currentGroup===SEQ.entityMessage.groups.COLOR_NAME_2||t.currentGroup===SEQ.entityMessage.groups.COLOR_HEX_3||t.currentGroup===SEQ.entityMessage.groups.COLOR_NAME_3){var n=e.length;return-1===e.indexOf("#")&&(n+=1),t.pos+=n,t.ongoingTypeWithAttributesLength-=n,i.style}if(t.currentGroup===SEQ.entityMessage.groups.WEIGHT_1||t.currentGroup===SEQ.entityMessage.groups.WEIGHT_2||t.currentGroup===SEQ.entityMessage.groups.WEIGHT_3){var r=e.length+1;return t.pos+=r,t.ongoingTypeWithAttributesLength-=r,i.style}return t.pos+=t.ongoingTypeWithAttributesLength,t.ongoingTypeWithAttributesLength=null,t.currentGroup--,a.groupMapping[SEQ.entityMessage.groups.TYPE_RIGHT].style}if(e){if(t.currentGroup===SEQ.entityMessage.groups.TYPE_RIGHT||t.currentGroup===SEQ.entityMessage.groups.TYPE_LEFT||t.currentGroup===SEQ.entityMessage.groups.TYPE_DUAL){var o=e.indexOf("#"),s=e.indexOf(":");return o>-1?(t.pos+=o,t.ongoingTypeWithAttributesLength=e.length-o):s>-1?(t.pos+=s,t.ongoingTypeWithAttributesLength=e.length-s):t.pos+=e.length,i.style}return t.currentGroup===SEQ.entityMessage.groups.DELAY_RIGHT||t.currentGroup===SEQ.entityMessage.groups.DELAY_LEFT?(t.pos+=e.length+2,i.style):t.currentGroup===SEQ.entityMessage.groups.PARTICIPANT_1?(t.pos=t.string.indexOf(e,t.pos)+e.length,i.style):(t.pos+=e.length,i.style)}t.skipToEnd()},e.push(a);var n={};n.regExp=SEQ.entityNoteBoxOver.regExp,n.maxGroup=SEQ.entityNoteBoxOver.groups.TEXT,n.groupMapping={},n.groupMapping[SEQ.entityNoteBoxOver.groups.TYPE]={style:t.KEYWORD},n.groupMapping[SEQ.entityNoteBoxOver.groups.SIDE]={style:t.KEYWORD},n.groupMapping[SEQ.entityNoteBoxOver.groups.PARTICIPANT_FROM]={style:t.ACTOR},n.groupMapping[SEQ.entityNoteBoxOver.groups.PARTICIPANT_TO]={style:t.ACTOR},n.groupMapping[SEQ.entityNoteBoxOver.groups.COLOR_HEX]={style:t.PARAMETER},n.groupMapping[SEQ.entityNoteBoxOver.groups.COLOR_NAME]={style:t.PARAMETER},n.groupMapping[SEQ.entityNoteBoxOver.groups.TEXT]={style:t.TEXT},n.progressStream=i,e.push(n);var r={};r.regExp=SEQ.entityNoteBoxLeftRight.regExp,r.maxGroup=SEQ.entityNoteBoxLeftRight.groups.TEXT,r.groupMapping={},r.groupMapping[SEQ.entityNoteBoxLeftRight.groups.TYPE]={style:t.KEYWORD},r.groupMapping[SEQ.entityNoteBoxLeftRight.groups.SIDE]={style:t.KEYWORD},r.groupMapping[SEQ.entityNoteBoxLeftRight.groups.PARTICIPANT_FROM]={style:t.ACTOR},r.groupMapping[SEQ.entityNoteBoxLeftRight.groups.COLOR_HEX]={style:t.PARAMETER},r.groupMapping[SEQ.entityNoteBoxLeftRight.groups.COLOR_NAME]={style:t.PARAMETER},r.groupMapping[SEQ.entityNoteBoxLeftRight.groups.TEXT]={style:t.TEXT},r.progressStream=i,e.push(r);var o={};o.regExp=SEQ.entityFragment.regExp,o.maxGroup=SEQ.entityFragment.groups.GROUP_CONDITION_RIGHT_BRACKET,o.groupMapping={},o.groupMapping[SEQ.entityFragment.groups.OPERATOR]={style:t.KEYWORD},o.groupMapping[SEQ.entityFragment.groups.COLOR_HEX_FRAGMENT]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.COLOR_NAME_FRAGMENT]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.COLOR_HEX_LABEL]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.COLOR_NAME_LABEL]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.TEXT]={style:t.TEXT},o.groupMapping[SEQ.entityFragment.groups.GROUP]={style:t.KEYWORD},o.groupMapping[SEQ.entityFragment.groups.COLOR_HEX_FRAGMENT_GROUP]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.COLOR_NAME_FRAGMENT_GROUP]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.GROUP_LABEL]={style:t.TEXT},o.groupMapping[SEQ.entityFragment.groups.COLOR_HEX_LABEL_GROUP]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.COLOR_NAME_LABEL_GROUP]={style:t.PARAMETER},o.groupMapping[SEQ.entityFragment.groups.GROUP_CONDITION_LEFT_BRACKET]={style:t.KEYWORD},o.groupMapping[SEQ.entityFragment.groups.GROUP_CONDITION]={style:t.TEXT},o.groupMapping[SEQ.entityFragment.groups.GROUP_CONDITION_RIGHT_BRACKET]={style:t.KEYWORD},o.progressStream=i,e.push(o);var s={};s.regExp=SEQ.entityActivation.regExp,s.maxGroup=SEQ.entityActivation.groups.COLOR_NAME,s.groupMapping={},s.groupMapping[SEQ.entityActivation.groups.TYPE]={style:t.KEYWORD},s.groupMapping[SEQ.entityActivation.groups.PARTICIPANT]={style:t.ACTOR},s.groupMapping[SEQ.entityActivation.groups.COLOR_HEX]={style:t.PARAMETER},s.groupMapping[SEQ.entityActivation.groups.COLOR_NAME]={style:t.PARAMETER},s.progressStream=i,e.push(s);var c={};c.regExp=SEQ.entityAutoNumber.regExp,c.maxGroup=SEQ.entityAutoNumber.groups.STATUS,c.groupMapping={},c.groupMapping[SEQ.entityAutoNumber.groups.AUTO_NUMBER]={style:t.KEYWORD},c.groupMapping[SEQ.entityAutoNumber.groups.STATUS]={style:t.PARAMETER},c.progressStream=i,e.push(c);var l={};l.regExp=SEQ.entityAutoActivation.regExp,l.maxGroup=SEQ.entityAutoActivation.groups.STATUS,l.groupMapping={},l.groupMapping[SEQ.entityAutoActivation.groups.AUTO_ACTIVATION]={style:t.KEYWORD},l.groupMapping[SEQ.entityAutoActivation.groups.STATUS]={style:t.PARAMETER},l.progressStream=i,e.push(l);var p={};p.regExp=SEQ.entityDivider.regExp,p.maxGroup=SEQ.entityDivider.groups.COLOR_NAME,p.groupMapping={},p.groupMapping[SEQ.entityDivider.groups.EQUALS_1]={style:t.KEYWORD},p.groupMapping[SEQ.entityDivider.groups.TEXT]={style:t.TEXT},p.groupMapping[SEQ.entityDivider.groups.EQUALS_2]={style:t.KEYWORD},p.groupMapping[SEQ.entityDivider.groups.COLOR_HEX]={style:t.PARAMETER},p.groupMapping[SEQ.entityDivider.groups.COLOR_NAME]={style:t.PARAMETER},p.progressStream=i,e.push(p);var g={};g.regExp=SEQ.entityEntrySpacing.regExp,g.maxGroup=SEQ.entityEntrySpacing.groups.SPACING,g.groupMapping={},g.groupMapping[SEQ.entityEntrySpacing.groups.ENTRY_SPACING]={style:t.KEYWORD},g.groupMapping[SEQ.entityEntrySpacing.groups.SPACING]={style:t.PARAMETER},g.progressStream=i,e.push(g);var d={};d.regExp=SEQ.entityFontFamily.regExp,d.maxGroup=SEQ.entityFontFamily.groups.NAME,d.groupMapping={},d.groupMapping[SEQ.entityFontFamily.groups.FONT_FAMILY]={style:t.KEYWORD},d.groupMapping[SEQ.entityFontFamily.groups.NAME]={style:t.PARAMETER},d.progressStream=i,e.push(d);var m={};m.regExp=SEQ.entityLinear.regExp,m.maxGroup=SEQ.entityLinear.groups.STATUS,m.groupMapping={},m.groupMapping[SEQ.entityLinear.groups.LINEAR]={style:t.KEYWORD},m.groupMapping[SEQ.entityLinear.groups.STATUS]={style:t.PARAMETER},m.progressStream=i,e.push(m);var E={};E.regExp=SEQ.entityParallel.regExp,E.maxGroup=SEQ.entityParallel.groups.STATUS,E.groupMapping={},E.groupMapping[SEQ.entityParallel.groups.PARALLEL]={style:t.KEYWORD},E.groupMapping[SEQ.entityParallel.groups.STATUS]={style:t.PARAMETER},E.progressStream=i,e.push(E);var u={};u.regExp=SEQ.entityParticipant.regExp,u.maxGroup=SEQ.entityParticipant.groups.FILL_COLOR_NAME,u.groupMapping={},u.groupMapping[SEQ.entityParticipant.groups.TYPE]={style:t.KEYWORD},u.groupMapping[SEQ.entityParticipant.groups.LINE_COLOR_HEX]={style:t.PARAMETER},u.groupMapping[SEQ.entityParticipant.groups.LINE_COLOR_NAME]={style:t.PARAMETER},u.groupMapping[SEQ.entityParticipant.groups.LINE_WEIGHT]={style:t.PARAMETER},u.groupMapping[SEQ.entityParticipant.groups.ICON_FONT_TYPE]={style:t.KEYWORD},u.groupMapping[SEQ.entityParticipant.groups.ICON_UNICODE]={style:t.PARAMETER},u.groupMapping[SEQ.entityParticipant.groups.IMAGE_TYPE]={style:t.KEYWORD},u.groupMapping[SEQ.entityParticipant.groups.IMAGE_DATA_URL]={style:t.PARAMETER},u.groupMapping[SEQ.entityParticipant.groups.QUOTE_1]={style:t.KEYWORD},u.groupMapping[SEQ.entityParticipant.groups.LONG_NAME]={style:t.TEXT},u.groupMapping[SEQ.entityParticipant.groups.QUOTE_2]={style:t.KEYWORD},u.groupMapping[SEQ.entityParticipant.groups.AS]={style:t.KEYWORD},u.groupMapping[SEQ.entityParticipant.groups.ALIAS]={style:t.ACTOR},u.groupMapping[SEQ.entityParticipant.groups.FILL_COLOR_HEX]={style:t.PARAMETER},u.groupMapping[SEQ.entityParticipant.groups.FILL_COLOR_NAME]={style:t.PARAMETER},u.progressStream=i,e.push(u);var S={};S.regExp=SEQ.entityParticipantSpacing.regExp,S.maxGroup=SEQ.entityParticipantSpacing.groups.SPACING,S.groupMapping={},S.groupMapping[SEQ.entityParticipantSpacing.groups.PARTICIPANT_SPACING]={style:t.KEYWORD},S.groupMapping[SEQ.entityParticipantSpacing.groups.SPACING]={style:t.PARAMETER},S.progressStream=i,e.push(S);var f={};f.regExp=SEQ.entitySpace.regExp,f.maxGroup=SEQ.entitySpace.groups.VALUE,f.groupMapping={},f.groupMapping[SEQ.entitySpace.groups.SPACE]={style:t.KEYWORD},f.groupMapping[SEQ.entitySpace.groups.VALUE]={style:t.PARAMETER},f.progressStream=i,e.push(f);var h={};h.regExp=SEQ.entityTitle.regExp,h.maxGroup=SEQ.entityTitle.groups.VALUE,h.groupMapping={},h.groupMapping[SEQ.entityTitle.groups.TITLE]={style:t.KEYWORD},h.groupMapping[SEQ.entityTitle.groups.VALUE]={style:t.TEXT},h.progressStream=i,e.push(h);var y={};y.regExp=SEQ.parser.regExpComment,y.maxGroup=1,y.groupMapping={},y.groupMapping[1]={style:t.COMMENT},y.progressStream=i,e.push(y);var Q={};Q.regExp=SEQ.entityCreateDestroy.regExp,Q.maxGroup=SEQ.entityCreateDestroy.groups.PARTICIPANT,Q.groupMapping={},Q.groupMapping[SEQ.entityCreateDestroy.groups.TYPE]={style:t.KEYWORD},Q.groupMapping[SEQ.entityCreateDestroy.groups.PARTICIPANT]={style:t.ACTOR},Q.progressStream=i,e.push(Q);var v={};v.regExp=SEQ.entityActiveColor.regExp,v.maxGroup=SEQ.entityActiveColor.groups.COLOR_HEX,v.groupMapping={},v.groupMapping[SEQ.entityActiveColor.groups.ACTIVE_COLOR]={style:t.KEYWORD},v.groupMapping[SEQ.entityActiveColor.groups.PARTICIPANT]={style:t.ACTOR},v.groupMapping[SEQ.entityActiveColor.groups.COLOR_NAME]={style:t.PARAMETER},v.groupMapping[SEQ.entityActiveColor.groups.COLOR_HEX]={style:t.PARAMETER},v.progressStream=i,e.push(v);var T={};T.regExp=SEQ.entityLifeLineStyle.regExp,T.maxGroup=SEQ.entityLifeLineStyle.groups.STYLE,T.groupMapping={},T.groupMapping[SEQ.entityLifeLineStyle.groups.LIFE_LINE_COLOR]={style:t.KEYWORD},T.groupMapping[SEQ.entityLifeLineStyle.groups.PARTICIPANT]={style:t.ACTOR},T.groupMapping[SEQ.entityLifeLineStyle.groups.COLOR_NAME]={style:t.PARAMETER},T.groupMapping[SEQ.entityLifeLineStyle.groups.COLOR_HEX]={style:t.PARAMETER},T.groupMapping[SEQ.entityLifeLineStyle.groups.WEIGHT]={style:t.PARAMETER},T.groupMapping[SEQ.entityLifeLineStyle.groups.STYLE]={style:t.PARAMETER},T.progressStream=i,e.push(T);var A={};A.regExp=SEQ.entityBottomParticipants.regExp,A.maxGroup=SEQ.entityBottomParticipants.groups.BOTTOM_PARTICIPANTS,A.groupMapping={},A.groupMapping[SEQ.entityBottomParticipants.groups.BOTTOM_PARTICIPANTS]={style:t.KEYWORD},A.progressStream=i,e.push(A);var P,x={};x.regExp=SEQ.entityParticipantGroup.regExp,x.maxGroup=SEQ.entityParticipantGroup.groups.END,x.groupMapping={},x.groupMapping[SEQ.entityParticipantGroup.groups.PARTICIPANT_GROUP]={style:t.KEYWORD},x.groupMapping[SEQ.entityParticipantGroup.groups.COLOR_HEX]={style:t.PARAMETER},x.groupMapping[SEQ.entityParticipantGroup.groups.COLOR_NAME]={style:t.PARAMETER},x.groupMapping[SEQ.entityParticipantGroup.groups.LINE_COLOR_HEX]={style:t.PARAMETER},x.groupMapping[SEQ.entityParticipantGroup.groups.LINE_COLOR_NAME]={style:t.PARAMETER},x.groupMapping[SEQ.entityParticipantGroup.groups.LINE_WEIGHT]={style:t.PARAMETER},x.groupMapping[SEQ.entityParticipantGroup.groups.TITLE]={style:t.TEXT},x.groupMapping[SEQ.entityParticipantGroup.groups.END]={style:t.KEYWORD},x.progressStream=i,e.push(x),(P={}).regExp=SEQ.entityFrame.regExp,P.maxGroup=SEQ.entityFrame.groups.TEXT,P.groupMapping={},P.groupMapping[SEQ.entityFrame.groups.FRAME]={style:t.KEYWORD},P.groupMapping[SEQ.entityFrame.groups.COLOR_HEX_FRAGMENT]={style:t.PARAMETER},P.groupMapping[SEQ.entityFrame.groups.COLOR_NAME_FRAGMENT]={style:t.PARAMETER},P.groupMapping[SEQ.entityFrame.groups.COLOR_HEX_LABEL]={style:t.PARAMETER},P.groupMapping[SEQ.entityFrame.groups.COLOR_NAME_LABEL]={style:t.PARAMETER},P.groupMapping[SEQ.entityFrame.groups.TEXT]={style:t.TEXT},P.progressStream=i,e.push(P),(P={}).regExp=SEQ.entityStyle.regExp,P.maxGroup=SEQ.entityStyle.groups.TEXT_STYLE,P.groupMapping={},P.groupMapping[SEQ.entityStyle.groups.ENTITY]={style:t.KEYWORD},P.groupMapping[SEQ.entityStyle.groups.TEXT_STYLE]={style:t.PARAMETER},P.progressStream=i,e.push(P)}(),CodeMirror.defineMode("seqdiamode",function(){return{token:i}})}}}(),(SEQ=SEQ||{}).api=function(){return{generatePngDataUrl:function(t,e){SEQ.parser.registerParseCompletionCallback(function(){var t=SEQ.saveAndOpen.generatePngBase64DataUrl();e(t)}),SEQ.main.updateSource(t)},generateSvgDataUrl:function(t,e){SEQ.parser.registerParseCompletionCallback(function(){SEQ.saveAndOpen.generateSvgBase64DataUrl().then(t=>{e(t)})}),SEQ.main.updateSource(t)},updateDiagram:function(t){SEQ.main.updateSource(t)},getDiagramSource:function(){return SEQ.main.getSourceValue()}}}();